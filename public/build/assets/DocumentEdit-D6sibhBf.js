import{b as D,j as e,M as y,W as k,n as S,Y as z}from"./app-DHbb7XZB.js";import{u as A,a as E,b as T,A as F}from"./Authenticated-DWZpg9um.js";import{u as O}from"./use-fetch-metadata-CeZqA4Yc.js";import{u as R,C as j}from"./Combobox-Dmw127jY.js";import{S as g}from"./Stack-BnRli6BO.js";import{I as U}from"./InputBase-C-93sqIY.js";import{G as C,A as w}from"./NotificationMenu-DLxJWaSh.js";import{B as _}from"./Button-De38AkdO.js";import{T as b}from"./TextInput-B2cdI1__.js";import{T as v,F as P}from"./OfficeLogo-C6ryGmry.js";import{A as B,I as q}from"./IconAlertCircle-DjVk4jpA.js";import{I as G}from"./IconFile-Ca6f2_vG.js";import{I as N}from"./IconEdit-DkjuZ_wP.js";import{T as L}from"./Textarea-DoT4cs20.js";import{D as V}from"./DatePickerInput-CKZUkAqb.js";import"./IconUser-CvGZT8Us.js";import"./Popover-DHSW6Xue.js";import"./use-uncontrolled-B1gi51Y9.js";import"./get-sorted-breakpoints-BYD2hfL9.js";const W=({onAdd:n})=>{const{modals:p,closeModal:o}=A(),r=p.addDocumentMetadata,{metadataList:l}=O(),[i,m]=D.useState(null),c=R({onDropdownClose:()=>c.resetSelectedOption()}),h=()=>{i&&(n(i),o("addDocumentMetadata"),m(null))},x=l.map(d=>e.jsx(j.Option,{value:d.metadata_id.toString(),children:d.name},d.metadata_id));return e.jsx(y,{opened:r,onClose:()=>o("addDocumentMetadata"),title:"Add Custom Metadata",children:e.jsxs(g,{gap:16,children:[e.jsxs(j,{store:c,onOptionSubmit:d=>{const u=l.find(a=>a.metadata_id.toString()===d)||null;m(u),c.closeDropdown()},children:[e.jsx(j.Target,{children:e.jsx(U,{component:"button",type:"button",rightSection:e.jsx(j.Chevron,{}),onClick:()=>c.toggleDropdown(),children:i?i.name:"Select Metadata"})}),e.jsx(j.Dropdown,{children:e.jsx(j.Options,{children:x})})]}),e.jsxs(C,{justify:"flex-end",children:[e.jsx(_,{variant:"outline",onClick:()=>o("addDocumentMetadata"),children:"Cancel"}),e.jsx(_,{onClick:h,disabled:!i,children:"Add"})]})]})})},Y=({metadata:n,requiredMetadata:p,onAdd:o,onUpdate:r,onChange:l,onDelete:i})=>{const{openModal:m}=A(),c=a=>{o&&o(a)},h=()=>{m("addDocumentMetadata")},x=a=>{const s=n[a],t=n.filter((M,f)=>f!==a);r&&r(t),i&&s.metadata_id!==0&&i(s.metadata_id)},d=(a,s,t)=>{const M=n.map((f,I)=>I===a?{...f,[s]:t}:f);l&&l(M)},u=D.useMemo(()=>{const a=n.map(s=>s.metadata_id);return p.filter(s=>!a.includes(s.metadata_id))},[n,p]);return e.jsxs(g,{children:[n.map((a,s)=>e.jsxs(C,{grow:!0,align:"flex-end",children:[e.jsx(b,{disabled:!0,label:"Name",placeholder:"Metadata name",value:a.name,onChange:t=>d(s,"name",t.target.value)}),e.jsx(b,{label:"Value",placeholder:"Metadata value",value:a.value,onChange:t=>d(s,"value",t.target.value)}),e.jsx(w,{color:"red",onClick:()=>x(s),children:e.jsx(E,{size:16})})]},a.metadata_id||s)),u.length>0&&e.jsxs(g,{gap:"xs",children:[e.jsx(v,{c:"red",size:"sm",children:"Missing Required Metadata:"}),u.map(a=>e.jsx(B,{icon:e.jsx(q,{size:16}),title:`${a.name} is missing`,color:"red",variant:"light"},a.metadata_id))]}),e.jsx(_,{variant:"light",onClick:h,leftSection:e.jsx(T,{size:14}),children:"Add Custom Metadata"}),e.jsx(W,{onAdd:a=>c({metadata_id:a.metadata_id,name:a.name,value:""})})]})};function $({document:n,onSuccess:p}){const{data:o,setData:r,put:l,processing:i,errors:m,reset:c,clearErrors:h}=k({name:n.name,document_number:n.document_number||"",description:n.description||"",due_date:n.due_date||"",update_metadata:n.metadata.map(d=>({metadata_id:d.metadata_id,name:d.name,value:d.value})),delete_metadata:[],related_documents:n.related_documents.map(d=>({item_id:d.item_id,name:d.name}))});return{data:o,setData:r,handleUpdateDocument:d=>{d.preventDefault(),l(route("document.save",n.item_id),{onSuccess:()=>{S.show({message:"Document updated successfully",color:"green"})},onError:u=>{S.show({message:"Failed to update document",color:"red"})},onFinish:()=>h()})},processing:i,errors:m,reset:c}}function pe({document:n,itemAncestors:p}){const{data:o,setData:r,handleUpdateDocument:l,processing:i,errors:m,reset:c}=$({document:n}),[h,x]=D.useState([]),d=t=>{r("update_metadata",[...o.update_metadata||[],t])},u=t=>{o.update_metadata=t},a=t=>{r("update_metadata",t)},s=t=>{x(M=>[...M,t]),r("delete_metadata",[...o.delete_metadata||[],{metadata_id:t}])};return e.jsxs(F,{children:[e.jsx(z,{title:"Document Properties"}),e.jsxs(g,{px:8,py:8,gap:24,w:550,mb:72,children:[e.jsxs(C,{mt:24,align:"center",children:[e.jsx(G,{size:56,stroke:1.5,color:"gray"}),e.jsx(v,{fw:500,children:o.name}),e.jsx(w,{variant:"subtle",color:"gray",children:e.jsx(N,{size:24})})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs(g,{gap:12,children:[e.jsx(b,{label:"Document Number",name:"document_number",value:o.document_number,onChange:t=>r("document_number",t.target.value),placeholder:"Enter document number"}),e.jsx(b,{type:"text",label:"Created At",value:n.created_at,disabled:!0}),e.jsx(L,{label:"Description",autosize:!0,minRows:4,maxRows:6,placeholder:"Enter description",value:o.description,onChange:t=>r("description",t.target.value)}),e.jsx(V,{label:"Due Date",placeholder:"Select due date",value:o.due_date?new Date(o.due_date):void 0,onChange:t=>r("due_date",(t==null?void 0:t.toISOString())??void 0)})]}),e.jsxs(g,{gap:12,children:[e.jsx(v,{size:"sm",fw:500,children:"Custom Metadata Field"}),e.jsx(Y,{metadata:o.update_metadata??[],requiredMetadata:n.required_folder_metadata,onAdd:d,onUpdate:u,onChange:a,onDelete:s})]}),e.jsxs(P,{align:"center",justify:"end",mt:16,children:[e.jsx(_,{variant:"outline",type:"button",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(_,{ml:12,type:"submit",loading:i,children:"Save"})]})]})]})]})}export{pe as default};
