import{w as wo,f as Ze,u as qe,x as Ho,a as Qe,j as o,T as Go,B as eo,L as ko,O as ao,c as Do,o as Vo,d as h,R as Co,z as Xo,A as Jo,k as Zo,b as Qo,D as er,n as E,r as ue,W as P,M as G,P as or,e as Se,h as Ve,y as rr,Y as tr}from"./app-Be6U1Dc8.js";import{u as sr,l as lo}from"./use-select-items-_CZecPgO.js";import{Y as nr}from"./index-CQ_tJ28n.js";import{u as ar,G as O,M as se,I as lr,D as ir,c as So}from"./NotificationMenu-DL9b0tvo.js";import{u as U,a as ae,b as J,T as K,c as cr,A as dr}from"./Authenticated-hQH3hORN.js";import{I as ur}from"./ItemBreadcrumbs-DoEBBp7D.js";import{a as pr}from"./use-resolved-styles-api-D7z3oZkW.js";import{c as V,A as N}from"./IconUser-BfhP9fWZ.js";import{I as fr,u as Fo,R as ve,a as mr,b as hr}from"./use-fetch-users-BOdMNpqA.js";import{T as z,F as H}from"./OfficeLogo-BgjFk65O.js";import{S as Z}from"./Stack-zxFT2Oc1.js";import{T as oo}from"./Textarea-D6Scmjm5.js";import{S as pe}from"./Select-BTO6iZxa.js";import{B as S}from"./Button-D9h5vimS.js";import{U as gr}from"./UpdateNumberingSchemeForm-DmhBmE65.js";import{T as Ne}from"./TextInput-8_pOHK7P.js";import{S as vr,N as xr}from"./Switch-TkHE9BII.js";import{I as yr,u as jr}from"./use-fetch-existing-metadata-column-CEMEwne3.js";import{u as br,I as wr}from"./use-show-items-for-moving-DkTASEA5.js";import{I as kr}from"./IconDownload-BrQLdkbq.js";import{I as Dr}from"./IconArchive-DNHUWJYZ.js";import{u as Cr}from"./use-document-properties-NArnexxB.js";import{A as Sr,I as Fr}from"./IconAlertCircle-GtehlEbF.js";import"./Checkbox-CiTPNHD0.js";import"./InputBase-DUCm8-Wn.js";import"./CheckIcon-RZhGPBCj.js";import"./Popover-DNH91axH.js";import"./get-sorted-breakpoints-CzoFm_tl.js";import"./Anchor-Xqcd2skh.js";import"./OptionsDropdown-C0aY907v.js";import"./Combobox-BzCSAeDM.js";import"./clamp-DTmYCdls.js";function io(e){return typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1)}var _o={root:"m_6e45937b",loader:"m_e8eb006c",overlay:"m_df587f17"};const co={transitionProps:{transition:"fade",duration:0},overlayProps:{backgroundOpacity:.75},zIndex:wo("overlay")},_r=Do((e,{zIndex:r})=>({root:{"--lo-z-index":r==null?void 0:r.toString()}})),ro=Ze((e,r)=>{const t=qe("LoadingOverlay",co,e),{classNames:s,className:n,style:i,styles:l,unstyled:a,vars:c,transitionProps:d,loaderProps:b,overlayProps:y,visible:v,zIndex:D,...k}=t,u=Ho(),j=Qe({name:"LoadingOverlay",classes:_o,props:t,className:n,style:i,classNames:s,styles:l,unstyled:a,vars:c,varsResolver:_r}),g={...co.overlayProps,...y};return o.jsx(Go,{transition:"fade",...d,mounted:!!v,children:f=>o.jsxs(eo,{...j("root",{style:f}),ref:r,...k,children:[o.jsx(ko,{...j("loader"),unstyled:a,...b}),o.jsx(ao,{...g,...j("overlay"),darkHidden:!0,unstyled:a,color:(y==null?void 0:y.color)||u.white}),o.jsx(ao,{...g,...j("overlay"),lightHidden:!0,unstyled:a,color:(y==null?void 0:y.color)||u.colors.dark[5]})]})})});ro.classes=_o;ro.displayName="@mantine/core/LoadingOverlay";var Eo={exports:{}},Er="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ar=Er,zr=Ar;function Ao(){}function zo(){}zo.resetWarningCache=Ao;var Mr=function(){function e(s,n,i,l,a,c){if(c!==zr){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function r(){return e}var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:zo,resetWarningCache:Ao};return t.PropTypes=t,t};Eo.exports=Mr();var Ir=Eo.exports;const A=Vo(Ir);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Or=V("outline","adjustments","IconAdjustments",[["path",{d:"M4 10a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M6 4v4",key:"svg-1"}],["path",{d:"M6 12v8",key:"svg-2"}],["path",{d:"M10 16a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-3"}],["path",{d:"M12 4v10",key:"svg-4"}],["path",{d:"M12 18v2",key:"svg-5"}],["path",{d:"M16 7a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-6"}],["path",{d:"M18 4v1",key:"svg-7"}],["path",{d:"M18 9v11",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var uo=V("outline","article","IconArticle",[["path",{d:"M3 4m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M7 8h10",key:"svg-1"}],["path",{d:"M7 12h10",key:"svg-2"}],["path",{d:"M7 16h10",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ur=V("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rr=V("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Tr=V("outline","dots-vertical","IconDotsVertical",[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nr=V("outline","file-isr","IconFileIsr",[["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-1"}],["path",{d:"M6 8v-3a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-7",key:"svg-2"}],["path",{d:"M3 15l3 -3l3 3",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wr=V("outline","file-report","IconFileReport",[["path",{d:"M17 17m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-0"}],["path",{d:"M17 13v4h4",key:"svg-1"}],["path",{d:"M12 3v4a1 1 0 0 0 1 1h4",key:"svg-2"}],["path",{d:"M11.5 21h-6.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v2m0 3v4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Lr=V("outline","folder-plus","IconFolderPlus",[["path",{d:"M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var $r=V("outline","folder-symlink","IconFolderSymlink",[["path",{d:"M3 21v-4a3 3 0 0 1 3 -3h5",key:"svg-0"}],["path",{d:"M8 17l3 -3l-3 -3",key:"svg-1"}],["path",{d:"M3 11v-5a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Br=V("outline","list-tree","IconListTree",[["path",{d:"M9 6h11",key:"svg-0"}],["path",{d:"M12 12h8",key:"svg-1"}],["path",{d:"M15 18h5",key:"svg-2"}],["path",{d:"M5 6v.01",key:"svg-3"}],["path",{d:"M8 12v.01",key:"svg-4"}],["path",{d:"M11 18v.01",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qr=V("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);function Yr(){return{downloadFiles:({all:r,ids:t,parentId:s})=>{if(!r&&(!t||t.length===0)){alert("Please select items to download.");return}const n=new URLSearchParams;s&&n.append("parent_id",String(s)),r?n.append("all","1"):t&&t.length>0&&t.forEach(a=>n.append("ids[]",a));const i=`${route("item.download")}?${n.toString()}`,l=document.createElement("a");l.href=i,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}const Pr=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function _e(e,r){const t=Kr(e);if(typeof t.path!="string"){const{webkitRelativePath:s}=e;Object.defineProperty(t,"path",{value:typeof r=="string"?r:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return t}function Kr(e){const{name:r}=e;if(r&&r.lastIndexOf(".")!==-1&&!e.type){const s=r.split(".").pop().toLowerCase(),n=Pr.get(s);n&&Object.defineProperty(e,"type",{value:n,writable:!1,configurable:!1,enumerable:!0})}return e}var xe=(e,r,t)=>new Promise((s,n)=>{var i=c=>{try{a(t.next(c))}catch(d){n(d)}},l=c=>{try{a(t.throw(c))}catch(d){n(d)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(i,l);a((t=t.apply(e,r)).next())});const Hr=[".DS_Store","Thumbs.db"];function Gr(e){return xe(this,null,function*(){return We(e)&&Vr(e.dataTransfer)?Qr(e.dataTransfer,e.type):Xr(e)?Jr(e):Array.isArray(e)&&e.every(r=>"getFile"in r&&typeof r.getFile=="function")?Zr(e):[]})}function Vr(e){return We(e)}function Xr(e){return We(e)&&We(e.target)}function We(e){return typeof e=="object"&&e!==null}function Jr(e){return Xe(e.target.files).map(r=>_e(r))}function Zr(e){return xe(this,null,function*(){return(yield Promise.all(e.map(t=>t.getFile()))).map(t=>_e(t))})}function Qr(e,r){return xe(this,null,function*(){if(e.items){const t=Xe(e.items).filter(n=>n.kind==="file");if(r!=="drop")return t;const s=yield Promise.all(t.map(et));return po(Mo(s))}return po(Xe(e.files).map(t=>_e(t)))})}function po(e){return e.filter(r=>Hr.indexOf(r.name)===-1)}function Xe(e){if(e===null)return[];const r=[];for(let t=0;t<e.length;t++){const s=e[t];r.push(s)}return r}function et(e){if(typeof e.webkitGetAsEntry!="function")return fo(e);const r=e.webkitGetAsEntry();return r&&r.isDirectory?Io(r):fo(e)}function Mo(e){return e.reduce((r,t)=>[...r,...Array.isArray(t)?Mo(t):[t]],[])}function fo(e){const r=e.getAsFile();if(!r)return Promise.reject(`${e} is not a File`);const t=_e(r);return Promise.resolve(t)}function ot(e){return xe(this,null,function*(){return e.isDirectory?Io(e):rt(e)})}function Io(e){const r=e.createReader();return new Promise((t,s)=>{const n=[];function i(){r.readEntries(l=>xe(this,null,function*(){if(l.length){const a=Promise.all(l.map(ot));n.push(a),i()}else try{const a=yield Promise.all(n);t(a)}catch(a){s(a)}}),l=>{s(l)})}i()})}function rt(e){return xe(this,null,function*(){return new Promise((r,t)=>{e.file(s=>{const n=_e(s,e.fullPath);r(n)},s=>{t(s)})})})}function tt(e,r){if(e&&r){const t=Array.isArray(r)?r:r.split(","),s=e.name||"",n=(e.type||"").toLowerCase(),i=n.replace(/\/.*$/,"");return t.some(l=>{const a=l.trim().toLowerCase();return a.charAt(0)==="."?s.toLowerCase().endsWith(a):a.endsWith("/*")?i===a.replace(/\/.*$/,""):n===a})}return!0}var st=Object.defineProperty,nt=Object.defineProperties,at=Object.getOwnPropertyDescriptors,mo=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,ho=(e,r,t)=>r in e?st(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,ct=(e,r)=>{for(var t in r||(r={}))lt.call(r,t)&&ho(e,t,r[t]);if(mo)for(var t of mo(r))it.call(r,t)&&ho(e,t,r[t]);return e},dt=(e,r)=>nt(e,at(r));const ut="file-invalid-type",pt="file-too-large",ft="file-too-small",mt="too-many-files",ht=e=>{e=Array.isArray(e)&&e.length===1?e[0]:e;const r=Array.isArray(e)?`one of ${e.join(", ")}`:e;return{code:ut,message:`File type must be ${r}`}},go=e=>({code:pt,message:`File is larger than ${e} ${e===1?"byte":"bytes"}`}),vo=e=>({code:ft,message:`File is smaller than ${e} ${e===1?"byte":"bytes"}`}),gt={code:mt,message:"Too many files"};function Oo(e,r){const t=e.type==="application/x-moz-file"||tt(e,r);return[t,t?null:ht(r)]}function Uo(e,r,t){if(de(e.size))if(de(r)&&de(t)){if(e.size>t)return[!1,go(t)];if(e.size<r)return[!1,vo(r)]}else{if(de(r)&&e.size<r)return[!1,vo(r)];if(de(t)&&e.size>t)return[!1,go(t)]}return[!0,null]}function de(e){return e!=null}function vt({files:e,accept:r,minSize:t,maxSize:s,multiple:n,maxFiles:i,validator:l}){return!n&&e.length>1||n&&i>=1&&e.length>i?!1:e.every(a=>{const[c]=Oo(a,r),[d]=Uo(a,t,s),b=l?l(a):null;return c&&d&&!b})}function Le(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Te(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,r=>r==="Files"||r==="application/x-moz-file"):!!e.target&&!!e.target.files}function xo(e){e.preventDefault()}function xt(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function yt(e){return e.indexOf("Edge/")!==-1}function jt(e=window.navigator.userAgent){return xt(e)||yt(e)}function X(...e){return(r,...t)=>e.some(s=>(!Le(r)&&s&&s(r,...t),Le(r)))}function bt(){return"showOpenFilePicker"in window}function wt(e){return de(e)?[{description:"Files",accept:Object.entries(e).filter(([t,s])=>{let n=!0;return Ro(t)||(console.warn(`Skipped "${t}" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.`),n=!1),(!Array.isArray(s)||!s.every(To))&&(console.warn(`Skipped "${t}" because an invalid file extension was provided.`),n=!1),n}).reduce((t,[s,n])=>dt(ct({},t),{[s]:n}),{})}]:e}function kt(e){if(de(e))return Object.entries(e).reduce((r,[t,s])=>[...r,t,...s],[]).filter(r=>Ro(r)||To(r)).join(",")}function Dt(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Ct(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function Ro(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function To(e){return/^.*\.[\w]+$/.test(e)}var St=Object.defineProperty,Ft=Object.defineProperties,_t=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,No=Object.prototype.hasOwnProperty,Wo=Object.prototype.propertyIsEnumerable,yo=(e,r,t)=>r in e?St(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,B=(e,r)=>{for(var t in r||(r={}))No.call(r,t)&&yo(e,t,r[t]);if($e)for(var t of $e(r))Wo.call(r,t)&&yo(e,t,r[t]);return e},ne=(e,r)=>Ft(e,_t(r)),Be=(e,r)=>{var t={};for(var s in e)No.call(e,s)&&r.indexOf(s)<0&&(t[s]=e[s]);if(e!=null&&$e)for(var s of $e(e))r.indexOf(s)<0&&Wo.call(e,s)&&(t[s]=e[s]);return t};const to=h.forwardRef((e,r)=>{var t=e,{children:s}=t,n=Be(t,["children"]);const i=$o(n),{open:l}=i,a=Be(i,["open"]);return h.useImperativeHandle(r,()=>({open:l}),[l]),Co.createElement(h.Fragment,null,s(ne(B({},a),{open:l})))});to.displayName="Dropzone";const Lo={disabled:!1,getFilesFromEvent:Gr,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0,autoFocus:!1};to.defaultProps=Lo;to.propTypes={children:A.func,accept:A.objectOf(A.arrayOf(A.string)),multiple:A.bool,preventDropOnDocument:A.bool,noClick:A.bool,noKeyboard:A.bool,noDrag:A.bool,noDragEventsBubbling:A.bool,minSize:A.number,maxSize:A.number,maxFiles:A.number,disabled:A.bool,getFilesFromEvent:A.func,onFileDialogCancel:A.func,onFileDialogOpen:A.func,useFsAccessApi:A.bool,autoFocus:A.bool,onDragEnter:A.func,onDragLeave:A.func,onDragOver:A.func,onDrop:A.func,onDropAccepted:A.func,onDropRejected:A.func,onError:A.func,validator:A.func};const Je={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function $o(e={}){const{accept:r,disabled:t,getFilesFromEvent:s,maxSize:n,minSize:i,multiple:l,maxFiles:a,onDragEnter:c,onDragLeave:d,onDragOver:b,onDrop:y,onDropAccepted:v,onDropRejected:D,onFileDialogCancel:k,onFileDialogOpen:u,useFsAccessApi:j,autoFocus:g,preventDropOnDocument:f,noClick:m,noKeyboard:C,noDrag:x,noDragEventsBubbling:_,onError:w,validator:M}=B(B({},Lo),e),I=h.useMemo(()=>kt(r),[r]),T=h.useMemo(()=>wt(r),[r]),ee=h.useMemo(()=>typeof u=="function"?u:jo,[u]),oe=h.useMemo(()=>typeof k=="function"?k:jo,[k]),W=h.useRef(null),q=h.useRef(null),[Ee,$]=h.useReducer(Et,Je),{isFocused:Ye,isFileDialogActive:ye}=Ee,fe=h.useRef(typeof window<"u"&&window.isSecureContext&&j&&bt()),Pe=()=>{!fe.current&&ye&&setTimeout(()=>{if(q.current){const{files:p}=q.current;p.length||($({type:"closeDialog"}),oe())}},300)};h.useEffect(()=>(window.addEventListener("focus",Pe,!1),()=>{window.removeEventListener("focus",Pe,!1)}),[q,ye,oe,fe]);const ie=h.useRef([]),Ae=p=>{W.current&&W.current.contains(p.target)||(p.preventDefault(),ie.current=[])};h.useEffect(()=>(f&&(document.addEventListener("dragover",xo,!1),document.addEventListener("drop",Ae,!1)),()=>{f&&(document.removeEventListener("dragover",xo),document.removeEventListener("drop",Ae))}),[W,f]),h.useEffect(()=>(!t&&g&&W.current&&W.current.focus(),()=>{}),[W,g,t]);const Q=h.useCallback(p=>{w?w(p):console.error(p)},[w]),ze=h.useCallback(p=>{p.preventDefault(),p.persist(),Re(p),ie.current=[...ie.current,p.target],Te(p)&&Promise.resolve(s(p)).then(F=>{if(Le(p)&&!_)return;const R=F.length,L=R>0&&vt({files:F,accept:I,minSize:i,maxSize:n,multiple:l,maxFiles:a,validator:M}),Y=R>0&&!L;$({isDragAccept:L,isDragReject:Y,isDragActive:!0,type:"setDraggedFiles"}),c&&c(p)}).catch(F=>Q(F))},[s,c,Q,_,I,i,n,l,a,M]),Me=h.useCallback(p=>{p.preventDefault(),p.persist(),Re(p);const F=Te(p);if(F&&p.dataTransfer)try{p.dataTransfer.dropEffect="copy"}catch{}return F&&b&&b(p),!1},[b,_]),Ie=h.useCallback(p=>{p.preventDefault(),p.persist(),Re(p);const F=ie.current.filter(L=>W.current&&W.current.contains(L)),R=F.indexOf(p.target);R!==-1&&F.splice(R,1),ie.current=F,!(F.length>0)&&($({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Te(p)&&d&&d(p))},[W,d,_]),ce=h.useCallback((p,F)=>{const R=[],L=[];p.forEach(Y=>{const[we,ke]=Oo(Y,I),[Ke,He]=Uo(Y,i,n),De=M?M(Y):null;if(we&&Ke&&!De)R.push(Y);else{let Ce=[ke,He];De&&(Ce=Ce.concat(De)),L.push({file:Y,errors:Ce.filter(Ge=>Ge)})}}),(!l&&R.length>1||l&&a>=1&&R.length>a)&&(R.forEach(Y=>{L.push({file:Y,errors:[gt]})}),R.splice(0)),$({acceptedFiles:R,fileRejections:L,type:"setFiles"}),y&&y(R,L,F),L.length>0&&D&&D(L,F),R.length>0&&v&&v(R,F)},[$,l,I,i,n,a,y,v,D,M]),me=h.useCallback(p=>{p.preventDefault(),p.persist(),Re(p),ie.current=[],Te(p)&&Promise.resolve(s(p)).then(F=>{Le(p)&&!_||ce(F,p)}).catch(F=>Q(F)),$({type:"reset"})},[s,ce,Q,_]),re=h.useCallback(()=>{if(fe.current){$({type:"openDialog"}),ee();const p={multiple:l,types:T};window.showOpenFilePicker(p).then(F=>s(F)).then(F=>{ce(F,null),$({type:"closeDialog"})}).catch(F=>{Dt(F)?(oe(F),$({type:"closeDialog"})):Ct(F)?(fe.current=!1,q.current?(q.current.value=null,q.current.click()):Q(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Q(F)});return}q.current&&($({type:"openDialog"}),ee(),q.current.value=null,q.current.click())},[$,ee,oe,j,ce,Q,T,l]),he=h.useCallback(p=>{!W.current||!W.current.isEqualNode(p.target)||(p.key===" "||p.key==="Enter"||p.keyCode===32||p.keyCode===13)&&(p.preventDefault(),re())},[W,re]),ge=h.useCallback(()=>{$({type:"focus"})},[]),Oe=h.useCallback(()=>{$({type:"blur"})},[]),je=h.useCallback(()=>{m||(jt()?setTimeout(re,0):re())},[m,re]),te=p=>t?null:p,be=p=>C?null:te(p),Ue=p=>x?null:te(p),Re=p=>{_&&p.stopPropagation()},qo=h.useMemo(()=>(p={})=>{var F=p,{refKey:R="ref",role:L,onKeyDown:Y,onFocus:we,onBlur:ke,onClick:Ke,onDragEnter:He,onDragOver:De,onDragLeave:Ce,onDrop:Ge}=F,Ko=Be(F,["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"]);return B(B({onKeyDown:be(X(Y,he)),onFocus:be(X(we,ge)),onBlur:be(X(ke,Oe)),onClick:te(X(Ke,je)),onDragEnter:Ue(X(He,ze)),onDragOver:Ue(X(De,Me)),onDragLeave:Ue(X(Ce,Ie)),onDrop:Ue(X(Ge,me)),role:typeof L=="string"&&L!==""?L:"presentation",[R]:W},!t&&!C?{tabIndex:0}:{}),Ko)},[W,he,ge,Oe,je,ze,Me,Ie,me,C,x,t]),Yo=h.useCallback(p=>{p.stopPropagation()},[]),Po=h.useMemo(()=>(p={})=>{var F=p,{refKey:R="ref",onChange:L,onClick:Y}=F,we=Be(F,["refKey","onChange","onClick"]);const ke={accept:I,multiple:l,type:"file",style:{display:"none"},onChange:te(X(L,me)),onClick:te(X(Y,Yo)),tabIndex:-1,[R]:q};return B(B({},ke),we)},[q,r,l,me,t]);return ne(B({},Ee),{isFocused:Ye&&!t,getRootProps:qo,getInputProps:Po,rootRef:W,inputRef:q,open:te(re)})}function Et(e,r){switch(r.type){case"focus":return ne(B({},e),{isFocused:!0});case"blur":return ne(B({},e),{isFocused:!1});case"openDialog":return ne(B({},Je),{isFileDialogActive:!0});case"closeDialog":return ne(B({},e),{isFileDialogActive:!1});case"setDraggedFiles":return ne(B({},e),{isDragActive:r.isDragActive,isDragAccept:r.isDragAccept,isDragReject:r.isDragReject});case"setFiles":return ne(B({},e),{acceptedFiles:r.acceptedFiles,fileRejections:r.fileRejections});case"reset":return B({},Je);default:return e}}function jo(){}const[At,zt]=Xo("Dropzone component was not found in tree");function so(e){const r=t=>{const{children:s,...n}=qe(`Dropzone${io(e)}`,{},t),i=zt(),l=Jo(s)?s:o.jsx("span",{children:s});return i[e]?h.cloneElement(l,n):null};return r.displayName=`@mantine/dropzone/${io(e)}`,r}const Mt=so("accept"),It=so("reject"),Ot=so("idle");var Fe={root:"m_d46a4834",inner:"m_b85f7144",fullScreen:"m_96f6e9ad",dropzone:"m_7946116d"};const Ut={loading:!1,multiple:!0,maxSize:1/0,autoFocus:!1,activateOnClick:!0,activateOnDrag:!0,dragEventsBubbling:!0,activateOnKeyboard:!0,useFsAccessApi:!0,variant:"light",rejectColor:"red"},Rt=Do((e,{radius:r,variant:t,acceptColor:s,rejectColor:n})=>{const i=e.variantColorResolver({color:s||e.primaryColor,theme:e,variant:t}),l=e.variantColorResolver({color:n||"red",theme:e,variant:t});return{root:{"--dropzone-radius":Qo(r),"--dropzone-accept-color":i.color,"--dropzone-accept-bg":i.background,"--dropzone-reject-color":l.color,"--dropzone-reject-bg":l.background}}}),le=Ze((e,r)=>{const t=qe("Dropzone",Ut,e),{classNames:s,className:n,style:i,styles:l,unstyled:a,vars:c,radius:d,disabled:b,loading:y,multiple:v,maxSize:D,accept:k,children:u,onDropAny:j,onDrop:g,onReject:f,openRef:m,name:C,maxFiles:x,autoFocus:_,activateOnClick:w,activateOnDrag:M,dragEventsBubbling:I,activateOnKeyboard:T,onDragEnter:ee,onDragLeave:oe,onDragOver:W,onFileDialogCancel:q,onFileDialogOpen:Ee,preventDropOnDocument:$,useFsAccessApi:Ye,getFilesFromEvent:ye,validator:fe,rejectColor:Pe,acceptColor:ie,enablePointerEvents:Ae,loaderProps:Q,inputProps:ze,mod:Me,...Ie}=t,ce=Qe({name:"Dropzone",classes:Fe,props:t,className:n,style:i,classNames:s,styles:l,unstyled:a,vars:c,varsResolver:Rt}),{getRootProps:me,getInputProps:re,isDragAccept:he,isDragReject:ge,open:Oe}=$o({onDrop:j,onDropAccepted:g,onDropRejected:f,disabled:b||y,accept:Array.isArray(k)?k.reduce((te,be)=>({...te,[be]:[]}),{}):k,multiple:v,maxSize:D,maxFiles:x,autoFocus:_,noClick:!w,noDrag:!M,noDragEventsBubbling:!I,noKeyboard:!T,onDragEnter:ee,onDragLeave:oe,onDragOver:W,onFileDialogCancel:q,onFileDialogOpen:Ee,preventDropOnDocument:$,useFsAccessApi:Ye,validator:fe,...ye?{getFilesFromEvent:ye}:null});Zo(m,Oe);const je=!he&&!ge;return o.jsx(At,{value:{accept:he,reject:ge,idle:je},children:o.jsxs(eo,{...me(),...ce("root",{focusable:!0}),...Ie,mod:[{accept:he,reject:ge,idle:je,disabled:b,loading:y,"activate-on-click":w},Me],children:[o.jsx(ro,{visible:y,overlayProps:{radius:d},unstyled:a,loaderProps:Q}),o.jsx("input",{...re(ze),name:C}),o.jsx("div",{...ce("inner"),ref:r,"data-enable-pointer-events":Ae||void 0,children:u})]})})});le.classes=Fe;le.displayName="@mantine/dropzone/Dropzone";le.Accept=Mt;le.Idle=Ot;le.Reject=It;const Tt={loading:!1,maxSize:1/0,activateOnClick:!1,activateOnDrag:!0,dragEventsBubbling:!0,activateOnKeyboard:!0,active:!0,zIndex:wo("max"),withinPortal:!0},no=Ze((e,r)=>{const t=qe("DropzoneFullScreen",Tt,e),{classNames:s,className:n,style:i,styles:l,unstyled:a,vars:c,active:d,onDrop:b,onReject:y,zIndex:v,withinPortal:D,portalProps:k,...u}=t,j=Qe({name:"DropzoneFullScreen",classes:Fe,props:t,className:n,style:i,classNames:s,styles:l,unstyled:a,rootSelector:"fullScreen"}),{resolvedClassNames:g,resolvedStyles:f}=pr({classNames:s,styles:l,props:t}),[m,C]=h.useState(0),[x,{open:_,close:w}]=ar(!1),M=T=>{var ee;(ee=T.dataTransfer)!=null&&ee.types.includes("Files")&&(C(oe=>oe+1),_())},I=()=>{C(T=>T-1)};return h.useEffect(()=>{m===0&&w()},[m]),h.useEffect(()=>{if(d)return document.addEventListener("dragenter",M,!1),document.addEventListener("dragleave",I,!1),()=>{document.removeEventListener("dragenter",M,!1),document.removeEventListener("dragleave",I,!1)}},[d]),o.jsx(er,{...k,withinPortal:D,children:o.jsx(eo,{...j("fullScreen",{style:{opacity:x?1:0,pointerEvents:x?"all":"none",zIndex:v}}),ref:r,children:o.jsx(le,{...u,classNames:g,styles:f,unstyled:a,className:Fe.dropzone,onDrop:T=>{b==null||b(T),w(),C(0)},onReject:T=>{y==null||y(T),w(),C(0)}})})})});no.classes=Fe;no.displayName="@mantine/dropzone/DropzoneFullScreen";le.FullScreen=no;const bo=le;function Nt({onDrop:e,openRef:r,children:t}){return o.jsxs(bo,{openRef:r,onDrop:e,activateOnClick:!1,accept:{"application/pdf":[],"application/msword":[],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[],"image/png":[],"image/jpeg":[]},maxSize:10*1024**2,styles:{root:{border:"none",padding:0}},onReject:()=>{E.show({position:"top-center",title:"Error",message:"File type not supported",color:"red",icon:o.jsx(qr,{})})},children:[o.jsx(bo.Accept,{children:o.jsx(fr,{style:{width:ue(52),height:ue(52),color:"var(--mantine-color-blue-6)",position:"absolute",bottom:ue(16),left:"50%",transform:"translateX(-50%)",zIndex:9999},stroke:1.5})}),t]})}function Wt({itemParentId:e}){const[r,t]=h.useState("reviewal"),{closeModal:s,modals:n}=U(),i=Fo(r,n.createWorkflow),{data:l,setData:a,post:c,processing:d,errors:b,reset:y}=P({folder_item_id:"",resolution:"",destination:"",type:"reviewal",users:[]}),[v,D]=h.useState([]),k=i.length;h.useEffect(()=>{D([])},[r,i]);const u=x=>{x.preventDefault();const _=v.map(w=>parseInt(w.selectedUser)).filter(w=>!isNaN(w));l.folder_item_id=e??"",l.users=_.map(w=>({user_id:w})),c(route("workflows.store"),{preserveScroll:!0,onSuccess:()=>{s("createWorkflow"),E.show({position:"top-center",message:"Approval process created",color:"green"})},onError:()=>{E.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>y()})},j=()=>{v.length<k&&D([...v,{selectedUser:""}])},g=()=>{const x=v.map(M=>M.selectedUser),w=i.filter(M=>!x.includes(M.id.toString())).map(M=>({selectedUser:M.id.toString()}));D([...v,...w])},f=x=>{const _=[...v];_.splice(x,1),D(_)},m=(x,_)=>{const w=[...v];w[x].selectedUser=_||"",D(w)},C=v.map(x=>x.selectedUser).filter(x=>x!=="");return{data:l,setData:a,createApprovalSubmit:u,processing:d,errors:b,users:v,setWorkflowType:t,addUser:j,removeUser:f,handleUserChange:m,addAllUsers:g,maxUsers:k,selectedUserIds:C,fetchedUsers:i}}const Lt=({itemParent:e})=>{const{data:r,setData:t,createApprovalSubmit:s,processing:n,errors:i,users:l,setWorkflowType:a,addUser:c,removeUser:d,handleUserChange:b,addAllUsers:y,maxUsers:v,selectedUserIds:D,fetchedUsers:k}=Wt({itemParentId:e==null?void 0:e.item_id}),{modals:u,closeModal:j}=U(),g=f=>k.filter(m=>!D.includes(m.id.toString())||m.id.toString()===l[f].selectedUser).map(m=>({value:m.id.toString(),label:`${m.name} (${m.email})`}));return o.jsx(G,{opened:u.createWorkflow,onClose:()=>j("createWorkflow"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Create Workflow Process"}),size:550,children:o.jsxs("form",{onSubmit:s,children:[o.jsxs(Z,{gap:16,children:[o.jsx(z,{size:"sm",color:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined approval workflow"}),o.jsx(ve.Group,{name:"status",value:r.type,onChange:f=>{t("type",f),a(f)},children:o.jsxs(O,{mt:"xs",children:[o.jsx(ve,{value:"reviewal",label:"Review"}),o.jsx(ve,{value:"approval",label:"Approval"})]})}),o.jsx(oo,{label:"Resolution",placeholder:"Your resolution for this approval",value:r.resolution??"",onChange:f=>t("resolution",f.target.value),error:i.resolution,autosize:!0,minRows:2,maxRows:4}),o.jsx(z,{size:"sm",fw:500,mb:-8,children:"Users in this workflow"}),l.map((f,m)=>o.jsxs(O,{justify:"space-between",align:"flex-end",children:[o.jsx(pe,{placeholder:"Select a user",data:g(m),value:f.selectedUser,onChange:C=>b(m,C),required:!0,style:{flex:1},allowDeselect:!1}),o.jsx(N,{color:"red",onClick:()=>d(m),title:"Remove User",children:o.jsx(ae,{size:18})})]},m)),o.jsxs(O,{children:[l.length<v&&o.jsx(S,{variant:"subtle",color:"green",leftSection:o.jsx(J,{size:16}),onClick:c,disabled:l.length>=v,children:"Add User"}),D.length<v&&o.jsx(S,{variant:"subtle",color:"blue",leftSection:o.jsx(J,{size:16}),onClick:y,disabled:l.length>=v,children:"Add All Users"})]})]}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"light",onClick:()=>j("createWorkflow"),children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function $t({itemParent:e}){const{data:r,setData:t,post:s,processing:n,errors:i,reset:l}=P({folder_item_id:(e==null?void 0:e.item_id)??"",name:"",prefix:"",next_number:1,reset_frequency:"none",add_if_approved:!1}),{closeModal:a}=U(),c=b=>{b.preventDefault();const y=d(r.prefix);t("prefix",y),s(route("numbering-scheme.store"),{preserveScroll:!0,onSuccess:()=>{a("createNumberingScheme"),E.show({position:"top-center",message:"Numbering scheme created",color:"green"})},onError:v=>{E.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>l()})},d=b=>b;return{data:r,setData:t,handleSubmit:c,processing:n,errors:i}}const Bt=({itemParent:e})=>{const{data:r,setData:t,handleSubmit:s,processing:n,errors:i}=$t({itemParent:e}),{modals:l,closeModal:a}=U(),[c,d]=h.useState([]);h.useEffect(()=>{const u=c.map(j=>j.type==="text"?`{${j.value}}`:`[${j.value}]`).join(" ");t("prefix",u)},[c]);const b=()=>{d([...c,{id:Date.now(),type:"text",value:""}])},y=()=>{d([...c,{id:Date.now(),type:"dynamic",value:""}])},v=(u,j)=>{d(c.map(g=>g.id===u?{...g,value:j}:g))},D=u=>{d(c.filter(j=>j.id!==u))},k=[{value:"YY",label:"Year"},{value:"MM",label:"Month"},{value:"DD",label:"Day"},{value:"INC",label:"Increment"}];return o.jsx(G,{opened:l.createNumberingScheme,onClose:()=>a("createNumberingScheme"),title:o.jsx(z,{size:"lg",children:"Create Numbering Scheme"}),size:600,children:o.jsxs("form",{onSubmit:s,children:[o.jsxs(Z,{gap:16,children:[o.jsx(Ne,{label:"Name",value:r.name,onChange:u=>t("name",u.target.value),error:i.name,required:!0}),o.jsx(vr,{label:"Add Number Only If Approved",checked:r.add_if_approved,onChange:u=>t("add_if_approved",u.currentTarget.checked),mt:"md"}),o.jsx(z,{size:"sm",fw:500,children:"Prefix Builder"}),o.jsxs(O,{children:[o.jsx(S,{variant:"subtle",size:"sm",leftSection:o.jsx(J,{size:16}),onClick:b,children:"Add Text"}),o.jsx(S,{variant:"subtle",size:"sm",leftSection:o.jsx(J,{size:16}),onClick:y,children:"Add Dynamic"})]}),c.map((u,j)=>o.jsxs(O,{align:"flex-end",children:[u.type==="text"?o.jsx(Ne,{placeholder:"Enter text",value:u.value,onChange:g=>v(u.id,g.target.value),required:!0,style:{flex:1}}):o.jsx(pe,{placeholder:"Select dynamic part",data:k,value:u.value,onChange:g=>v(u.id,g||""),required:!0,style:{flex:1}}),o.jsx(N,{color:"red",onClick:()=>D(u.id),children:o.jsx(ae,{size:16})})]},u.id)),o.jsx(z,{size:"sm",fw:500,children:"Preview:"}),o.jsx(or,{withBorder:!0,p:12,bg:"#f9f9f9",children:o.jsx(z,{children:c.map(u=>{if(u.type==="text")return u.value+" ";switch(u.value){case"YY":return new Date().getFullYear().toString().slice(2)+" ";case"MM":return(new Date().getMonth()+1).toString().padStart(2,"0")+" ";case"DD":return new Date().getDate().toString().padStart(2,"0")+" ";case"INC":return r.next_number.toString()+" ";default:return""}}).join("").trim()})}),o.jsx(O,{justify:"space-between",children:o.jsx(xr,{label:"Next Number",value:r.next_number,onChange:u=>t("next_number",Number(u)),min:1,error:i.next_number,required:!0,style:{flex:1}})}),o.jsx(pe,{label:"Reset Frequency",data:[{value:"none",label:"None"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],value:r.reset_frequency,onChange:u=>t("reset_frequency",u??"none"),error:i.reset_frequency,required:!0})]}),o.jsxs(H,{align:"center",justify:"end",mt:24,children:[o.jsx(S,{variant:"light",onClick:()=>a("createNumberingScheme"),children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function qt({itemParent:e,close:r}){const{data:t,setData:s,post:n,processing:i,errors:l,reset:a,clearErrors:c}=P({parent_id:"",name:""}),{closeModal:d}=U();return{data:t,setData:s,submit:y=>{t.parent_id=(e==null?void 0:e.item_id)||"",y.preventDefault(),n(route("folder.create"),{preserveScroll:!0,onSuccess:()=>{E.show({position:"top-center",message:"New folder created",color:"green"})},onError:v=>{let D="";Object.keys(v).length>0?D=v[Object.keys(v)[0]]:D="Error during file upload. Please try again later.",E.show({position:"top-center",message:D,color:"red"})},onFinish:()=>{d("folder"),a(),c()}})},processing:i,errors:l}}const Yt=({itemParent:e})=>{const{data:r,setData:t,submit:s,processing:n,errors:i}=qt({itemParent:e,close}),{modals:l,closeModal:a}=U();return o.jsx(G,{opened:l.folder,onClose:()=>a("folder"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Create Folder"}),size:550,children:o.jsxs("form",{onSubmit:s,children:[o.jsx(Z,{gap:16,children:o.jsx(Ne,{id:"name",type:"text",name:"name",value:r.name,placeholder:"Folder Name",onChange:c=>t("name",c.target.value),error:i.name})}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"outline",onClick:()=>a("folder"),children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function Pt({workflowId:e,isOpen:r}){const[t,s]=h.useState(null);h.useEffect(()=>{e&&r&&n(e)},[e,r]);const n=async i=>{try{const l=await Se.get(`/workflows/${i}`);s(l.data)}catch(l){console.error("Error fetching workflow",l)}};return t}function Kt({itemParent:e,isOpen:r}){const[t,s]=h.useState("reviewal"),n=Pt({workflowId:e==null?void 0:e.workflow_id,isOpen:r}),i=Fo(t,r),{closeModal:l}=U(),{data:a,setData:c,put:d,processing:b,errors:y,reset:v,clearErrors:D}=P({resolution:"",type:"",users:[]}),[k,u]=h.useState([]),j=i.length;h.useEffect(()=>{n&&(s(n.type||""),c({resolution:n.resolution||"",type:n.type||"",users:n.users.map(w=>({user_id:w.id}))}),u(n.users.map(w=>({selectedUser:w.id.toString()}))))},[n,r]),h.useEffect(()=>{u([])},[t]);const g=w=>{w.preventDefault();const M=k.map(I=>parseInt(I.selectedUser)).filter(I=>!isNaN(I));a.users=M.map(I=>({user_id:I})),d(route("workflows.update",e==null?void 0:e.workflow_id),{onSuccess:()=>{l("updateWorkflow"),E.show({position:"top-center",message:"Workflow updated successfully",color:"green"})},onError:I=>{E.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>v()})},f=()=>{k.length<j&&u([...k,{selectedUser:""}])},m=()=>{const w=k.map(T=>T.selectedUser),I=i.filter(T=>!w.includes(T.id.toString())).map(T=>({selectedUser:T.id.toString()}));u([...k,...I])},C=w=>{const M=[...k];M.splice(w,1),u(M)},x=(w,M)=>{const I=[...k];I[w].selectedUser=M||"",u(I)},_=k.map(w=>w.selectedUser).filter(w=>w!=="");return{data:a,setData:c,handleUpdateWorkflow:g,processing:b,errors:y,users:k,setWorkflowType:s,addUser:f,removeUser:C,handleUserChange:x,addAllUsers:m,maxUsers:j,selectedUserIds:_,fetchedUsers:i}}function Ht({workflowId:e,onDeleteSuccess:r}){const{delete:t,processing:s}=P();return{handleDeleteWorkflow:()=>{if(!e){E.show({position:"top-center",message:"Workflow ID is missing.",color:"red"});return}t(route("workflows.destroy",e),{preserveScroll:!0,onSuccess:()=>{E.show({position:"top-center",message:"Workflow deleted successfully.",color:"green"}),r()},onError:i=>{let l="Failed to delete workflow.";i&&Object.keys(i).length>0&&(l=i[Object.keys(i)[0]]),E.show({position:"top-center",message:l,color:"red"})}})},processing:s}}const Gt=({workflowId:e})=>{const{modals:r,closeModal:t,openModal:s}=U(),n=r.confirmDeleteWorkflow,{handleDeleteWorkflow:i,processing:l}=Ht({workflowId:e,onDeleteSuccess:()=>{t("confirmDeleteWorkflow"),t("updateWorkflow")}});return o.jsxs(G,{opened:n,onClose:()=>t("confirmDeleteWorkflow"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[o.jsx(z,{c:"gray.8",children:"Are you sure you want to delete this workflow? This action cannot be undone."}),o.jsxs(H,{align:"center",justify:"flex-end",mt:16,children:[o.jsx(S,{variant:"light",onClick:()=>{t("confirmDeleteWorkflow"),s("updateWorkflow")},children:"Cancel"}),o.jsx(S,{color:"red",ml:12,onClick:i,loading:l,children:"Delete"})]})]})},Vt=({itemParent:e})=>{const{modals:r,closeModal:t,openModal:s}=U(),n=r.updateWorkflow,{data:i,setData:l,handleUpdateWorkflow:a,processing:c,users:d,setWorkflowType:b,addUser:y,removeUser:v,handleUserChange:D,addAllUsers:k,maxUsers:u,selectedUserIds:j,fetchedUsers:g,errors:f}=Kt({itemParent:e,isOpen:n}),m=C=>g.filter(x=>!j.includes(x.id.toString())||x.id.toString()===d[C].selectedUser).map(x=>({value:x.id.toString(),label:`${x.name} (${x.email})`}));return o.jsxs(o.Fragment,{children:[o.jsx(G,{opened:n,onClose:()=>t("updateWorkflow"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Update Workflow Process"}),size:550,children:o.jsxs("form",{onSubmit:a,children:[o.jsxs(Z,{gap:16,children:[o.jsx(z,{size:"sm",c:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined approval workflow"}),o.jsx(ve.Group,{name:"status",value:i.type,onChange:C=>{l("type",C),b(C)},children:o.jsxs(O,{mt:"xs",children:[o.jsx(ve,{value:"reviewal",label:"Review"}),o.jsx(ve,{value:"approval",label:"Approval"})]})}),o.jsx(oo,{label:"Resolution",placeholder:"Your resolution for this approval",value:i.resolution??"",onChange:C=>l("resolution",C.target.value),error:f.resolution,autosize:!0,minRows:2,maxRows:4}),o.jsx(z,{size:"sm",fw:500,mb:-8,children:"Users in this workflow"}),d.map((C,x)=>o.jsxs(O,{justify:"space-between",align:"flex-end",children:[o.jsx(pe,{placeholder:"Select a user",data:m(x),value:C.selectedUser,onChange:_=>D(x,_),required:!0,style:{flex:1},allowDeselect:!1}),o.jsx(N,{color:"red",onClick:()=>v(x),title:"Remove User",children:o.jsx(ae,{size:18})})]},x)),o.jsxs(O,{children:[d.length<u&&o.jsx(S,{variant:"subtle",color:"green",leftSection:o.jsx(J,{size:16}),onClick:y,disabled:d.length>=u,children:"Add User"}),j.length<u&&o.jsx(S,{variant:"subtle",color:"blue",leftSection:o.jsx(J,{size:16}),onClick:k,disabled:d.length>=u,children:"Add All Users"})]})]}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"light",onClick:()=>t("updateWorkflow"),children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:c,children:"Update"}),o.jsx(N,{variant:"transparent",color:"red",onClick:()=>{s("confirmDeleteWorkflow"),t("updateWorkflow")},title:"Delete Workflow",ml:12,children:o.jsx(ae,{size:18})})]})]})}),o.jsx(Gt,{workflowId:e==null?void 0:e.workflow_id})]})};function Xt(){return{generateReport:async t=>{var s;try{const n=await Se.post(route("report.generate"),{folder_item_id:t}),{url:i,filename:l}=n.data;if(i){const a=document.createElement("a");a.href=i,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("No URL returned for the report.")}catch(n){console.error("Error generating report:",((s=n.response)==null?void 0:s.data)||n.message)}},generateDashboardReport:async t=>{var s;try{const n=await Se.post(route("report.generateDashboard"),t),{url:i,filename:l}=n.data;if(i){const a=document.createElement("a");a.href=i,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("No URL returned for the dashboard report.")}catch(n){console.error("Error generating dashboard report:",((s=n.response)==null?void 0:s.data)||n.message)}}}}function Jt({folderId:e,isOpen:r}){const[t,s]=h.useState([]),[n,i]=h.useState(!1),[l,a]=h.useState(null);return h.useEffect(()=>{e&&(async()=>{i(!0);try{const d=await Se.get(route("folder.fetchSharedUsers",{folder:e}));s(d.data),a(null)}catch(d){console.error(d),a("Failed to fetch shared users."),E.show({position:"top-center",title:"Error",message:"Unable to fetch shared users.",color:"red"})}finally{i(!1)}})()},[e,r]),{sharedUsers:t,loading:n,error:l}}function Zt({folderId:e,close:r}){const{modals:t}=U(),s=t.shareFolder,{sharedUsers:n,loading:i,error:l}=Jt({folderId:e,isOpen:s}),{data:a,setData:c,post:d,processing:b,errors:y,reset:v}=P({users:[]});return h.useEffect(()=>{if(n.length>0){const f=n.map(m=>({email:m.email,role:m.role}));c("users",f)}},[n]),{data:a,submit:()=>{d(route("folder.share",{folder:e}),{onSuccess:()=>{r(),E.show({position:"top-center",message:"Folder shared successfully.",color:"green"}),v()},onError:f=>{E.show({position:"top-center",message:"Failed to share the folder.",color:"red"})}})},processing:b,errors:y,addUser:()=>{c("users",[...a.users,{email:"",role:"viewer"}])},removeUser:f=>{const m=a.users.filter((C,x)=>x!==f);c("users",m)},handleUserChange:(f,m,C)=>{const x=a.users.map((_,w)=>w===f?{..._,[m]:C}:_);c("users",x)},handleAddAllUsers:()=>{const f=n.map(m=>({email:m.email,role:"viewer"}));c("users",f)}}}const Qt=({folderId:e})=>{const{modals:r,closeModal:t}=U(),{users:s,loading:n,error:i}=mr(),{data:l,submit:a,processing:c,errors:d,addUser:b,removeUser:y,handleUserChange:v}=Zt({folderId:e,close:()=>t("shareFolder")}),D=()=>{const u=s.map(j=>({email:j.email,role:"viewer"}));k(u)},k=u=>{u.forEach(()=>b())};return o.jsx(G,{opened:r.shareFolder,onClose:()=>t("shareFolder"),title:o.jsx(z,{size:"lg",children:"Share Folder"}),size:"600",children:o.jsxs("form",{onSubmit:u=>{u.preventDefault(),a()},children:[o.jsxs(Z,{children:[l.users.map((u,j)=>o.jsxs(O,{align:"flex-end",children:[o.jsx(pe,{data:s.map(g=>({value:g.email,label:`${g.name} (${g.email})`})),placeholder:"Select a user",value:u.email,onChange:g=>v(j,"email",g||""),style:{flex:1}}),o.jsx(pe,{data:[{value:"viewer",label:"Viewer"},{value:"editor",label:"Editor"}],placeholder:"Select role",value:u.role,onChange:g=>v(j,"role",g||"viewer"),style:{width:120}}),o.jsx(K,{label:"Remove User",withArrow:!0,children:o.jsx(N,{color:"red",onClick:()=>y(j),children:o.jsx(ae,{size:18})})})]},j)),o.jsxs(O,{children:[o.jsx(S,{variant:"subtle",color:"green",leftSection:o.jsx(J,{size:16}),onClick:()=>b(),children:"Add User"}),o.jsx(S,{variant:"subtle",color:"blue",leftSection:o.jsx(J,{size:16}),onClick:D,disabled:l.users.length>=s.length,children:"Add All Users"})]})]}),o.jsxs(O,{mt:"md",children:[o.jsx(S,{variant:"outline",onClick:()=>t("shareFolder"),children:"Cancel"}),o.jsx(S,{type:"submit",loading:c,children:"Save"})]})]})})};function es({itemParent:e}){const{closeModal:r}=U(),{data:t,setData:s,put:n,processing:i,errors:l,reset:a,clearErrors:c}=P({name:(e==null?void 0:e.name)||"",description:(e==null?void 0:e.description)||""});return h.useEffect(()=>{s("name",(e==null?void 0:e.name)||""),s("description",(e==null?void 0:e.description)||"")},[e]),{data:t,setData:s,submit:b=>{b.preventDefault(),n(route("folder.update",{id:(e==null?void 0:e.item_id)||""}),{preserveScroll:!0,onSuccess:()=>{E.show({position:"top-center",message:"Folder properties updated successfully.",color:"green"}),r("folderProperties")},onError:()=>{E.show({position:"top-center",message:"Failed to update folder properties.",color:"red"})},onFinish:()=>{a(),c()}})},processing:i,errors:l}}const os=({itemParent:e})=>{const{data:r,setData:t,submit:s,processing:n,errors:i}=es({itemParent:e}),{modals:l,closeModal:a}=U();return o.jsx(G,{opened:l.folderProperties,onClose:()=>a("folderProperties"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Folder Properties"}),size:"550",children:o.jsxs("form",{onSubmit:s,children:[o.jsxs(Z,{gap:16,children:[o.jsx(Ne,{label:"Folder Name",name:"name",value:r.name,onChange:c=>t("name",c.target.value),error:i.name,required:!0}),o.jsx(oo,{label:"Notes",name:"description",value:r.description,onChange:c=>t("description",c.target.value),error:i.description,autosize:!0,minRows:4})]}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"outline",onClick:()=>a("folderProperties"),children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:n,children:"Save"})]})]})})};function rs({setSelectedRecord:e}){const{data:r,delete:t,processing:s}=P({ids:[],isWorkspace:!1}),{closeModal:n}=U();return{handleDelete:l=>{r.ids=l,t(route("item.delete"),{onSuccess:()=>{n("deleteFiles"),setTimeout(()=>{e([])},100),E.show({position:"top-center",message:"Files deleted",color:"green"})},onError:a=>{let c="Error during file deletion. Please try again later.";Object.keys(a).length>0&&(c=a[Object.keys(a)[0]]),E.show({position:"top-center",message:c,color:"red"})}})},processing:s}}const Bo=({selectedIds:e,setSelectedRecord:r})=>{const{handleDelete:t,processing:s}=rs({setSelectedRecord:r}),{modals:n,closeModal:i}=U();return o.jsx(G,{opened:n.deleteFiles,onClose:()=>i("deleteFiles"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Delete Files"}),size:550,children:o.jsxs("form",{onSubmit:l=>{l.preventDefault(),t(e)},children:[o.jsx(z,{c:"dimmed",children:"Delete selected files?"}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"subtle",onClick:()=>i("deleteFiles"),color:"gray",children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:s,color:"red",children:"Delete"})]})]})})},ts=({uploadFileRef:e,itemParent:r,folderUserRole:t})=>{const{openModal:s,modals:n}=U(),{generateReport:i}=Xt(),[l,a]=h.useState(!1);h.useEffect(()=>{const d=()=>{a(window.innerWidth<=768)};return window.addEventListener("resize",d),d(),()=>window.removeEventListener("resize",d)},[]);const c=()=>{var d;return o.jsxs(o.Fragment,{children:[o.jsx(K,{label:"Properties",position:"bottom",withArrow:!0,children:o.jsx(N,{size:"lg",variant:"transparent",color:"dark.3",onClick:()=>s("folderProperties"),children:o.jsx(Or,{size:18})})}),o.jsx(K,{label:"Workflow",position:"bottom",withArrow:!0,children:o.jsx(N,{variant:"transparent",size:"lg",color:r!=null&&r.workflow_id?"green.8":"dark.3",onClick:()=>s(r!=null&&r.workflow_id?"updateWorkflow":"createWorkflow"),children:o.jsx(hr,{size:18})})}),o.jsx(K,{label:"Share",position:"bottom",withArrow:!0,children:o.jsx(N,{variant:"transparent",size:"lg",color:r!=null&&r.is_shared?"green.8":"dark.3",onClick:()=>s("shareFolder"),children:o.jsx(cr,{size:18})})}),o.jsx(K,{label:"Metadata",position:"bottom",withArrow:!0,children:o.jsx(N,{component:Ve,size:"lg",href:route("folder.showRequiredMetadata",{id:r==null?void 0:r.item_id}),variant:"transparent",color:(d=r==null?void 0:r.required_metadata)!=null&&d.length?"green.8":"dark.3",children:o.jsx(lr,{size:18})})}),o.jsx(K,{label:"Activity",position:"bottom",withArrow:!0,children:o.jsx(N,{component:Ve,size:"lg",href:route("folder.activity-log",{id:r==null?void 0:r.item_id}),variant:"transparent",color:"dark.3",children:o.jsx(uo,{size:18})})}),o.jsx(K,{label:"Numbering",position:"bottom",withArrow:!0,children:o.jsx(N,{size:"lg",variant:"transparent",color:r!=null&&r.numbering_scheme_id?"green.8":"dark.3",onClick:()=>s(r!=null&&r.numbering_scheme_id?"updateNumberingScheme":"createNumberingScheme"),children:o.jsx(Br,{size:18})})}),o.jsx(K,{label:"Column",position:"bottom",withArrow:!0,children:o.jsx(N,{variant:"transparent",color:"dark.3",size:"lg",onClick:()=>s("selectMetadataColumns"),children:o.jsx(yr,{size:18})})}),o.jsx(K,{label:"Report",position:"bottom",withArrow:!0,children:o.jsx(N,{variant:"transparent",color:"dark.3",size:"lg",onClick:()=>i((r==null?void 0:r.item_id)??""),children:o.jsx(Wr,{size:18})})}),o.jsx(K,{label:"Delete Folder",position:"bottom",withArrow:!0,children:o.jsx(N,{variant:"transparent",size:"lg",color:"red",onClick:()=>s("deleteFiles"),children:o.jsx(ae,{size:18})})})]})};return o.jsxs(O,{h:"50%",px:32,align:"center",justify:"space-between",children:[(t==="editor"||t==="admin")&&o.jsxs(O,{gap:"xs",children:[o.jsxs(se,{shadow:"md",width:220,transitionProps:{transition:"pop-top-left"},position:"bottom-start",children:[o.jsx(se.Target,{children:o.jsx(S,{variant:"subtle",color:"dark.3",leftSection:o.jsx(J,{size:18}),rightSection:o.jsx(Rr,{size:12}),children:"New"})}),o.jsxs(se.Dropdown,{children:[o.jsx(se.Item,{leftSection:o.jsx(Lr,{style:{width:ue(14),height:ue(14)}}),onClick:()=>s("folder"),children:"New Folder"}),o.jsx(se.Item,{leftSection:o.jsx(Nr,{style:{width:ue(14),height:ue(14)}}),onClick:()=>{var d;return(d=e==null?void 0:e.current)==null?void 0:d.call(e)},children:"Upload Files"})]})]}),l?o.jsxs(se,{shadow:"md",width:200,children:[o.jsx(se.Target,{children:o.jsx(N,{variant:"transparent",color:"dark.3",size:"lg",children:o.jsx(Tr,{size:18})})}),o.jsx(se.Dropdown,{children:c()})]}):c()]}),t==="viewer"&&o.jsx(O,{gap:"xs",children:o.jsx(K,{label:"Activity",position:"bottom",withArrow:!0,children:o.jsx(N,{component:Ve,size:"lg",href:route("folder.activity-log",{id:r==null?void 0:r.item_id}),variant:"transparent",color:"dark.3",children:o.jsx(uo,{size:18})})})}),o.jsx(Yt,{itemParent:r}),o.jsx(Lt,{itemParent:r}),o.jsx(Vt,{itemParent:r}),o.jsx(Bt,{itemParent:r}),o.jsx(gr,{itemParent:r}),o.jsx(Qt,{folderId:(r==null?void 0:r.item_id)??""}),o.jsx(os,{itemParent:r}),o.jsx(Bo,{selectedIds:[(r==null?void 0:r.item_id)??""],setSelectedRecord:()=>{}})]})};function ss({setSelectedRecord:e}){const{data:r,setData:t,put:s,processing:n,errors:i,reset:l,clearErrors:a}=P({ids:[],destination_folder_id:""});return{data:r,setData:t,moveDocuments:()=>{s(route("document.move"),{onSuccess:()=>{e([]),E.show({position:"top-center",message:"Documents moved successfully",color:"green"}),l()},onError:d=>{E.show({position:"top-center",message:"Failed to move documents",color:"red"})},onFinish:()=>{a()}})},processing:n,errors:i,reset:l}}const ns=({selectedDocumentIds:e,setSelectedRecord:r})=>{const{modals:t,closeModal:s}=U(),n=t.moveModal,[i,l]=h.useState(null),{data:a,loading:c,error:d}=br(i,n),{data:b,setData:y,moveDocuments:v,processing:D}=ss({setSelectedRecord:r}),k=g=>{l(g)},u=()=>{a.itemParent&&a.itemParent.parent_id?l(a.itemParent.parent_id):l(null)},j=()=>{if(!i){E.show({position:"top-center",message:"Please select a destination folder.",color:"red"});return}b.ids=e,b.destination_folder_id=i,v(),s("moveModal")};return o.jsx(G,{opened:n,onClose:()=>s("moveModal"),title:o.jsx(z,{fw:500,children:"Move Documents"}),size:"lg",children:o.jsxs(Z,{gap:"md",children:[o.jsxs(O,{children:[i&&o.jsx(N,{onClick:u,children:o.jsx(wr,{size:16})}),o.jsx(z,{c:"dark.5",fw:500,children:"Choose Destination Folder"})]}),o.jsx(ir,{}),c?o.jsx(z,{children:"Loading..."}):d?o.jsx(z,{c:"red",children:d}):o.jsx(Z,{gap:"sm",style:{maxHeight:400,overflowY:"auto"},children:a.itemContents.map(g=>o.jsxs(O,{gap:"sm",style:{cursor:"pointer"},onClick:()=>k(g.item_id),children:[o.jsx(So,{mime:g.mime??"",isFolder:g.type==="folder"}),o.jsx(z,{children:g.name})]},g.item_id))}),o.jsxs(O,{justify:"flex-end",mt:"md",children:[o.jsx(S,{variant:"outline",onClick:()=>s("moveModal"),children:"Cancel"}),o.jsx(S,{onClick:j,disabled:!i||D,loading:D,children:"Move Here"})]})]})})};function as({selectedIds:e,setSelectedRecord:r}){const{closeModal:t}=U(),{data:s,post:n,processing:i}=P({ids:e});return{data:s,setData:a=>{Object.assign(s,a)},archiveFilesSubmit:a=>{a.preventDefault(),n(route("item.archive"),{onSuccess:()=>{t("archiveFiles"),r([]),E.show({position:"top-center",message:"Files archived successfully",color:"green"})},onError:c=>{let d="";Object.keys(c).length>0?d=c[Object.keys(c)[0]]:d="Error during archiving. Please try again later.",E.show({position:"top-center",message:d,color:"red"})}})},processing:i}}const ls=({selectedIds:e,setSelectedRecord:r})=>{const{archiveFilesSubmit:t,processing:s}=as({selectedIds:e,setSelectedRecord:r}),{modals:n,closeModal:i}=U();return o.jsx(G,{opened:n.archiveFiles,onClose:()=>i("archiveFiles"),title:o.jsx(z,{fw:"bold",size:"lg",children:"Archive Files"}),size:550,children:o.jsxs("form",{onSubmit:t,children:[o.jsx(z,{c:"dimmed",children:"Are you sure you want to archive the selected files?"}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"subtle",onClick:()=>i("archiveFiles"),color:"gray",children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:s,color:"blue.5",children:"Archive"})]})]})})},is=({setSelectedRecord:e,selectedIds:r,parentId:t})=>{const{downloadFiles:s}=Yr(),{openModal:n}=U();return o.jsxs(O,{h:"50%",px:"md",align:"center",justify:"flex-start",children:[o.jsx(S,{onClick:()=>n("deleteFiles"),variant:"subtle",color:"dark.3",leftSection:o.jsx(ae,{size:18}),children:"Delete"}),o.jsx(S,{onClick:()=>s({all:!1,ids:r,parentId:t}),variant:"subtle",color:"dark.3",leftSection:o.jsx(kr,{size:18}),children:"Download"}),o.jsx(S,{onClick:()=>n("moveModal"),variant:"subtle",color:"dark.3",leftSection:o.jsx($r,{size:18}),children:"Move"}),o.jsx(S,{onClick:()=>n("archiveFiles"),variant:"subtle",color:"dark.3",leftSection:o.jsx(Dr,{size:18}),children:"Archive"}),o.jsx(Bo,{selectedIds:r,setSelectedRecord:e}),o.jsx(ns,{selectedDocumentIds:r,setSelectedRecord:e}),o.jsx(ls,{selectedIds:r,setSelectedRecord:e})]})};function cs(e){const{data:r,post:t,reset:s,clearErrors:n}=P({parent_id:"",files:[]});return{uploadFiles:l=>{r.parent_id=e.item_id,r.files=l.map(a=>({file:a})),t(route("document.store"),{onSuccess:()=>{E.show({position:"top-center",message:"Document uploaded",color:"green",icon:Co.createElement(Ur)})},onError:a=>{let c="";Object.keys(a).length>0?c=a[Object.keys(a)[0]]:c="Error during file upload. Please try again later.",E.show({position:"top-center",message:c,color:"red"})},onFinish:()=>{s(),n()}})}}}function ds(){return{openFolder:(r,t)=>{r==="folder"&&rr.visit(route("folder.show",{id:t}))}}}function us(){const[e,r]=h.useState([]);return h.useEffect(()=>{Se.get(route("metadata.fetch-all")).then(t=>{r(t.data.metadata)}).catch(t=>{console.error("Error fetching metadata:",t)})},[]),{metadataList:e}}const ps=({folderId:e})=>{const{modals:r,closeModal:t}=U(),s=r.selectMetadataColumns,{metadataList:n}=us(),{existingMetadataColumns:i,loading:l,error:a}=jr({folderId:e,isOpen:s}),{data:c,setData:d,post:b,processing:y,errors:v,reset:D}=P({metadata_columns:[{id:Date.now(),value:""}],metadata_ids:[]});h.useEffect(()=>{if(i.length>0){const f=i.map(m=>({id:m.metadata_id,value:m.metadata_id.toString()}));d("metadata_columns",f)}},[i]),h.useEffect(()=>{const f=c.metadata_columns.map(m=>parseInt(m.value)).filter(m=>!isNaN(m));d("metadata_ids",f)},[c.metadata_columns]);const k=()=>{d("metadata_columns",[...c.metadata_columns,{id:Date.now(),value:""}])},u=f=>{d("metadata_columns",c.metadata_columns.filter(m=>m.id!==f))},j=(f,m)=>{const C=c.metadata_columns.map(x=>x.id===f?{...x,value:m}:x);d("metadata_columns",C)},g=f=>{f.preventDefault(),c.metadata_columns.map(m=>parseInt(m.value)).filter(m=>!isNaN(m)),b(route("folder.selectMetadataColumn",e),{preserveScroll:!0,onSuccess:()=>{t("selectMetadataColumns"),E.show({position:"top-center",title:"Success",message:"Metadata columns selected successfully",color:"green"}),D()},onError:()=>{E.show({position:"top-center",title:"Error",message:"Failed to select metadata columns",color:"red"})}})};return o.jsx(G,{opened:s,onClose:()=>{t("selectMetadataColumns"),D()},title:o.jsx(z,{fw:"bold",size:"lg",children:"Select Tag Columns"}),size:550,children:l?o.jsx(H,{justify:"center",align:"center",h:"100%",children:o.jsx(ko,{})}):a?o.jsx(Sr,{icon:o.jsx(Fr,{size:16}),title:"Error",color:"red",children:a}):o.jsxs("form",{onSubmit:g,children:[o.jsxs(Z,{gap:16,children:[o.jsx(z,{c:"dimmed",children:"Select the metadata columns you want to display"}),c.metadata_columns.map(f=>o.jsxs(O,{justify:"space-between",align:"flex-end",children:[o.jsx(pe,{placeholder:"Pick a metadata column",data:n.map(m=>({value:m.metadata_id.toString(),label:m.name})),value:f.value,onChange:m=>j(f.id,m||""),w:"90%",required:!0}),c.metadata_columns.length>1&&o.jsx(N,{color:"red",variant:"subtle",onClick:()=>u(f.id),children:o.jsx(ae,{size:18})})]},f.id)),o.jsx(H,{justify:"flex-start",children:o.jsx(S,{variant:"subtle",color:"blue.5",leftSection:o.jsx(J,{size:18}),onClick:k,children:"Add New Column"})})]}),o.jsxs(H,{align:"center",justify:"end",mt:16,children:[o.jsx(S,{variant:"outline",onClick:()=>{t("selectMetadataColumns"),D()},children:"Cancel"}),o.jsx(S,{ml:12,type:"submit",loading:y,children:"Save"})]})]})})};function Ps({itemParent:e,itemAncestors:r,itemContents:t,folderUserRole:s}){var g;const n=h.useRef(null),{uploadFiles:i}=cs(e),{selectedRecord:l,setSelectedRecord:a,ids:c}=sr(),{openFolder:d}=ds(),{openDocument:b}=Cr(),[y,v]=h.useState({columnAccessor:"name",direction:"asc"}),[D,k]=h.useState(lo.sortBy(t,"name"));h.useEffect(()=>{const f=lo.sortBy(t,y.columnAccessor);k(y.direction==="desc"?f.reverse():f)},[y,t]);const u=((g=e.metadata_columns)==null?void 0:g.map(f=>({accessor:`metadata_${f.metadata_id}`,title:f.name,render:m=>{var x;const C=(x=m.metadata)==null?void 0:x.find(_=>_.metadata_id===f.metadata_id);return C?C.value:null},sortable:!0,ellipsis:!0})))??[],j=[{accessor:"name",render:({mime:f,type:m,name:C,approval_status:x,review_status:_,missing_required_metadata:w})=>o.jsxs(O,{align:"center",gap:12,preventGrowOverflow:!0,children:[o.jsx(So,{mime:f??"",isFolder:m==="folder",reviewStatus:_,approvalStatus:x,missingRequiredMetadata:w}),o.jsx("span",{children:C})]}),sortable:!0,ellipsis:!0},{accessor:"updated_at",title:"Last Modified",sortable:!0,ellipsis:!0},...u??[]];return o.jsxs(o.Fragment,{children:[o.jsx(tr,{title:"My Files"}),o.jsx(dr,{toolbar:l.length>0?o.jsx(is,{setSelectedRecord:a,selectedIds:c,parentId:e.item_id}):o.jsx(ts,{itemParent:{...e},folderUserRole:s,uploadFileRef:n}),children:o.jsx(Nt,{onDrop:i,openRef:n,children:o.jsxs(Z,{px:8,gap:24,py:8,style:{pointerEvents:"all"},children:[o.jsx(ur,{ancestors:r}),t.length?o.jsx(nr,{textSelectionDisabled:!0,columns:j,records:D,customRowAttributes:({type:f,id:m})=>({onDoubleClick:C=>{C.button===0&&(f==="folder"?d(f,m):f==="document"&&b(m))}}),highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",selectedRecords:l,onSelectedRecordsChange:a,sortStatus:y,onSortStatusChange:v}):o.jsx(z,{size:"lg",c:"gray.5",children:"This folder is empty"})]})})}),o.jsx(ps,{folderId:e.item_id})]})}export{Ps as default};
