import{c as y,W as A,n as R,b as C,j as t,M as O,Y as z,y as F}from"./app-Dj8oY4Sv.js";import{Y as G}from"./index-bGR0mOy6.js";import{u as w,A as B}from"./Authenticated-CXrFhtgK.js";import{u as L,a as N}from"./use-search-datatable-CoDEtv2_.js";import{S as v}from"./Stack-Ct7A46eR.js";import{T as u,F as Y}from"./OfficeLogo-ClyZGDRI.js";import{C as $}from"./Checkbox-BfT6YYFD.js";import{G as x,d as q}from"./NotificationMenu-Dv2fd-r9.js";import{B as S}from"./Button-DV_DgoO4.js";import{S as U}from"./StateBadge-BZm92o0M.js";import{u as H}from"./use-document-properties-BZjTl5C9.js";import{S as V}from"./Select-D0mBFprC.js";import{D as W}from"./DatePickerInput-tPKNW7Lo.js";import{I as J}from"./IconTable-BcJ9UG5i.js";import{I as K}from"./IconDownload-BxxJIpkQ.js";import"./Popover-Dg2sZB9k.js";import"./use-uncontrolled-B5KzFrsn.js";import"./IconUser-tGMAG_ub.js";import"./TextInput-BAT--W9p.js";import"./InputBase-BqH0PwBP.js";import"./get-sorted-breakpoints-CmPpz3cM.js";import"./CheckIcon-D9bMejXc.js";import"./Badge-rYbW4Q9D.js";import"./Combobox-kEnZwdjW.js";import"./clamp-DTmYCdls.js";function Q(){return{generateReport:async m=>{var s;try{const r=await y.post(route("report.generate"),{folder_item_id:m}),{url:o,filename:l}=r.data;if(o){const a=document.createElement("a");a.href=o,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("No URL returned for the report.")}catch(r){console.error("Error generating report:",((s=r.response)==null?void 0:s.data)||r.message)}},generateDashboardReport:async m=>{var s;try{const r=await y.post(route("report.generateDashboard"),m),{url:o,filename:l}=r.data;if(o){const a=document.createElement("a");a.href=o,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("No URL returned for the dashboard report.")}catch(r){console.error("Error generating dashboard report:",((s=r.response)==null?void 0:s.data)||r.message)}}}}function X({closeModal:p}){const{data:d,setData:m,post:s,processing:r,errors:o,reset:l}=A({metadata_ids:[]});return{data:d,setData:m,handleSubmit:()=>{s(route("dashboard.selectMetadataColumn"),{onSuccess:()=>{R.show({title:"Success",message:"Metadata columns updated successfully",color:"green"}),p(),l()},onError:()=>{R.show({title:"Error",message:"Failed to update metadata columns",color:"red"})}})},processing:r,errors:o}}const Z=({availableMetadata:p,existingMetadataIds:d})=>{const{modals:m,closeModal:s}=w(),r=m.selectDashboardMetadataColumns,{data:o,setData:l,handleSubmit:a,processing:j,errors:h}=X({closeModal:()=>s("selectDashboardMetadataColumns")});C.useEffect(()=>{l("metadata_ids",d)},[d]);const g=n=>{const b=o.metadata_ids;b.includes(n)?l("metadata_ids",b.filter(_=>_!==n)):l("metadata_ids",[...b,n])};return t.jsx(O,{opened:r,onClose:()=>s("selectDashboardMetadataColumns"),title:"Select Metadata Columns",children:t.jsx("form",{onSubmit:n=>{n.preventDefault(),a()},children:t.jsxs(v,{children:[t.jsx(u,{children:"Select the metadata columns you want to display in the dashboard report:"}),p.map(n=>t.jsx($,{label:n.name,checked:o.metadata_ids.includes(n.metadata_id),onChange:()=>g(n.metadata_id)},n.metadata_id)),h.metadata_ids&&t.jsx(u,{c:"red",children:h.metadata_ids}),t.jsxs(x,{gap:"md",mt:"md",children:[t.jsx(S,{variant:"outline",onClick:()=>s("selectDashboardMetadataColumns"),children:"Cancel"}),t.jsx(S,{type:"submit",loading:j,children:"Save"})]})]})})})};function ye({documents:p,filters:d,selectedMetadata:m,availableMetadata:s,existingMetadataIds:r}){const[o,l]=C.useState(d.document_status),[a,j]=C.useState([d.start_date?new Date(d.start_date):null,d.end_date?new Date(d.end_date):null]),{openDocument:h}=H();L("","/dashboard/reports");const{page:g,setPage:n,handlePageChange:b}=N(p.current_page),{generateDashboardReport:_}=Q(),{openModal:M}=w(),D=e=>{const c={document_status:o,start_date:a[0]?a[0].toISOString().split("T")[0]:null,end_date:a[1]?a[1].toISOString().split("T")[0]:null,page:g||void 0,...e};Object.keys(c).forEach(i=>{(c[i]===null||c[i]===void 0)&&delete c[i]}),F.get(route("dashboard.reports"),c,{replace:!0,preserveState:!0})},k=e=>{l(e),D({document_status:e,page:1})},P=e=>{j(e),D({start_date:e[0]?e[0].toISOString().split("T")[0]:null,end_date:e[1]?e[1].toISOString().split("T")[0]:null,page:1})},T=e=>{n(e),D({page:e})},E=()=>{const e={document_status:o,start_date:a[0]?a[0].toISOString().split("T")[0]:null,end_date:a[1]?a[1].toISOString().split("T")[0]:null,metadata_ids:r};_(e)};return t.jsxs(B,{children:[t.jsx(z,{title:"Dashboard Report"}),t.jsxs(v,{px:8,gap:24,py:8,children:[t.jsx(x,{children:t.jsx(u,{component:"h2",size:"xl",fw:600,c:"gray.8",children:"Dashboard Report"})}),t.jsxs(v,{children:[t.jsxs(x,{justify:"space-between",children:[t.jsxs(Y,{gap:"md",justify:"flex-start",align:"flex-end",direction:"row",wrap:"wrap",children:[t.jsx(V,{placeholder:"Select document status",value:o,onChange:k,data:[{value:"reviewal_accepted",label:"Review Accepted"},{value:"reviewal_rejected",label:"Review Rejected"},{value:"reviewal_pending",label:"Review Pending"},{value:"approval_accepted",label:"Approval Accepted"},{value:"approval_rejected",label:"Approval Rejected"},{value:"approval_pending",label:"Approval Pending"}],style:{width:200}}),t.jsx(W,{type:"range",placeholder:"Select date range",value:a,onChange:P,style:{width:300}}),t.jsx(S,{onClick:()=>M("selectDashboardMetadataColumns"),leftSection:t.jsx(J,{size:16}),variant:"subtle",color:"dark.5",children:"Columns"})]}),t.jsx(S,{onClick:E,leftSection:t.jsx(K,{size:16}),color:"blue",variant:"subtle",children:"Generate Report"})]}),t.jsx(Z,{availableMetadata:s,existingMetadataIds:r}),t.jsx(G,{columns:[{accessor:"name",render:({mime:e,type:c,name:i,missing_required_metadata:f})=>t.jsxs(x,{align:"center",gap:12,children:[t.jsx(q,{mime:e??"",isFolder:c==="folder",missingRequiredMetadata:f}),t.jsx("span",{children:i})]})},{accessor:"updated_at",title:"Last Modified"},{accessor:"status",render:({status:e})=>t.jsx(U,{state:e})},{accessor:"due_in",title:"Due in",render:({due_in:e})=>e!=null?e<0?t.jsxs(u,{c:"red",size:"sm",children:[Math.abs(e)," days overdue"]}):t.jsx(u,{size:"sm",children:`${e} day${e!==1?"s":""} remaining`}):"Deadline not set"},...m.map(e=>({accessor:`metadata_${e.metadata_id}`,title:e.name,render:c=>{var f;const i=(f=c.metadata)==null?void 0:f.find(I=>I.metadata_id===e.metadata_id);return i?i.value:"N/A"}}))],records:p.data,totalRecords:p.total,recordsPerPage:p.per_page,page:g,onPageChange:T,highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",customRowAttributes:({type:e,id:c})=>({onDoubleClick:i=>{i.button===0&&h(c)}})})]})]})]})}export{ye as default};
