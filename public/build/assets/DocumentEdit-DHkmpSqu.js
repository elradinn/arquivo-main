import{f as ne,u as de,h as re,a as g,j as e,M as H,b as le,L as ie,W as ce,n as G,Y as ue,B as me,y as pe}from"./app-Dpvel7_R.js";import{u as I,a as W,b as Y,A as he}from"./Authenticated-BPKds3ka.js";import{I as xe}from"./ItemBreadcrumbs-Cy5DOftx.js";import{u as fe}from"./use-fetch-metadata-CN59ydO5.js";import{u as $,C as b}from"./Combobox-Bv-Q1AWj.js";import{S as _}from"./Stack-CoXGQtU9.js";import{I as R}from"./InputBase-CU7iXYHc.js";import{G as C,A as y,c as je}from"./NotificationMenu-iEPQ7dzL.js";import{B as S}from"./Button-TZGTIUZL.js";import{T as z}from"./TextInput-DbIdGEZa.js";import{T as v,F as ge}from"./OfficeLogo-E4GqBOdi.js";import{A as _e,I as ve}from"./IconAlertCircle-CVbQB3JR.js";import{u as De}from"./Popover-C5OanegX.js";import{g as be,a as Me,O as Ce}from"./OptionsDropdown-CShiGJAW.js";import{u as Se}from"./use-uncontrolled-Bhd5DvOC.js";import{u as we,I as Ie}from"./use-show-items-for-moving-DURvPzKW.js";import{I as ye}from"./IconFolder-DNv72V6y.js";import{I as Ae}from"./IconFile-B95I5vhC.js";import{I as Oe}from"./IconEdit-BcaIylS1.js";import{T as Fe}from"./Textarea-6zt3QU5e.js";import{D as Pe}from"./DatePickerInput-QU38311F.js";import"./IconUser-DP139oqx.js";import"./get-sorted-breakpoints-ATetgGJR.js";import"./Anchor-DWIabj4s.js";import"./CheckIcon-ARhSTQwj.js";import"./clamp-DTmYCdls.js";const ke={},E=ne((a,c)=>{const s=de("Autocomplete",ke,a),{classNames:d,styles:i,unstyled:o,vars:n,dropdownOpened:p,defaultDropdownOpened:m,onDropdownClose:x,onDropdownOpen:r,onFocus:h,onBlur:t,onClick:u,onChange:f,data:l,value:M,defaultValue:A,selectFirstOptionOnChange:O,onOptionSubmit:F,comboboxProps:J,readOnly:P,disabled:V,filter:K,limit:Q,withScrollArea:X,maxDropdownHeight:Z,size:T,id:ee,renderOption:te,autoComplete:ae,scrollAreaProps:se,...w}=s,L=re(ee),B=be(l),oe=Me(B),[k,N]=Se({value:M,defaultValue:A,finalValue:"",onChange:f}),D=$({opened:p,defaultOpened:m,onDropdownOpen:r,onDropdownClose:()=>{x==null||x(),D.resetSelectedOption()}}),{resolvedClassNames:U,resolvedStyles:q}=De({props:s,styles:i,classNames:d});return g.useEffect(()=>{O&&D.selectFirstOption()},[O,k]),e.jsxs(b,{store:D,__staticSelector:"Autocomplete",classNames:U,styles:q,unstyled:o,readOnly:P,onOptionSubmit:j=>{F==null||F(j),N(oe[j].label),D.closeDropdown()},size:T,...J,children:[e.jsx(b.Target,{autoComplete:ae,children:e.jsx(R,{ref:c,...w,size:T,__staticSelector:"Autocomplete",disabled:V,readOnly:P,value:k,onChange:j=>{N(j.currentTarget.value),D.openDropdown(),O&&D.selectFirstOption()},onFocus:j=>{D.openDropdown(),h==null||h(j)},onBlur:j=>{D.closeDropdown(),t==null||t(j)},onClick:j=>{D.openDropdown(),u==null||u(j)},classNames:U,styles:q,unstyled:o,id:L})}),e.jsx(Ce,{data:B,hidden:P||V,filter:K,search:k,limit:Q,hiddenWhenEmpty:!0,withScrollArea:X,maxDropdownHeight:Z,unstyled:o,labelId:w.label?`${L}-label`:void 0,"aria-label":w.label?void 0:w["aria-label"],renderOption:te,scrollAreaProps:se})]})});E.classes={...R.classes,...b.classes};E.displayName="@mantine/core/Autocomplete";const ze=({onAdd:a})=>{const{modals:c,closeModal:s}=I(),d=c.addDocumentMetadata,{metadataList:i}=fe(),[o,n]=g.useState(null),p=$({onDropdownClose:()=>p.resetSelectedOption()}),m=()=>{o&&(a(o),s("addDocumentMetadata"),n(null))},x=i.map(r=>e.jsx(b.Option,{value:r.metadata_id.toString(),children:r.name},r.metadata_id));return e.jsx(H,{opened:d,onClose:()=>s("addDocumentMetadata"),title:"Add Custom Metadata",children:e.jsxs(_,{gap:16,children:[e.jsxs(b,{store:p,onOptionSubmit:r=>{const h=i.find(t=>t.metadata_id.toString()===r)||null;n(h),p.closeDropdown()},children:[e.jsx(b.Target,{children:e.jsx(R,{component:"button",type:"button",rightSection:e.jsx(b.Chevron,{}),onClick:()=>p.toggleDropdown(),children:o?o.name:"Select Metadata"})}),e.jsx(b.Dropdown,{children:e.jsx(b.Options,{children:x})})]}),e.jsxs(C,{justify:"flex-end",children:[e.jsx(S,{variant:"outline",onClick:()=>s("addDocumentMetadata"),children:"Cancel"}),e.jsx(S,{onClick:m,disabled:!o,children:"Add"})]})]})})};function Re(a){const[c,s]=g.useState([]),[d,i]=g.useState(!1),[o,n]=g.useState(null);return g.useEffect(()=>{(async()=>{if(a===null){s([]);return}i(!0);try{const m=await le.get(route("metadata.predefined-values",{metadata:a}));s(m.data.predefined_values),n(null)}catch(m){n("Failed to fetch predefined values."),console.error(m)}finally{i(!1)}})()},[a]),{predefinedValues:c,loading:d,error:o}}const Ee=({metadata:a,requiredMetadata:c,onAdd:s,onUpdate:d,onChange:i,onDelete:o})=>{const{openModal:n}=I();g.useState(null);const p=t=>{s&&s(t)},m=()=>{n("addDocumentMetadata")},x=t=>{const u=a[t],f=a.filter((l,M)=>M!==t);d&&d(f),o&&u.metadata_id!==0&&o(u.metadata_id)},r=(t,u,f)=>{const l=a.map((M,A)=>A===t?{...M,[u]:f}:M);i&&i(l)},h=g.useMemo(()=>{const t=a.map(u=>u.metadata_id);return c.filter(u=>!t.includes(u.metadata_id))},[a,c]);return e.jsxs(_,{children:[a.map((t,u)=>e.jsxs(C,{grow:!0,align:"flex-end",children:[e.jsx(z,{disabled:!0,label:"Name",placeholder:"Metadata name",value:t.name,onChange:f=>r(u,"name",f.target.value)}),e.jsx(Ve,{metadataId:t.metadata_id,value:t.value||"",onChange:f=>r(u,"value",f)}),e.jsx(y,{color:"red",onClick:()=>x(u),children:e.jsx(W,{size:16})})]},t.metadata_id||u)),h.length>0&&e.jsxs(_,{gap:"xs",children:[e.jsx(v,{c:"red",size:"sm",children:"Missing Required Metadata:"}),h.map(t=>e.jsx(_e,{icon:e.jsx(ve,{size:16}),title:`${t.name} is missing`,color:"red",variant:"light"},t.metadata_id))]}),e.jsx(S,{variant:"light",onClick:m,leftSection:e.jsx(Y,{size:14}),children:"Add Custom Metadata"}),e.jsx(ze,{onAdd:t=>p({metadata_id:t.metadata_id,name:t.name,value:""})})]})},Ve=({metadataId:a,value:c,onChange:s})=>{const{predefinedValues:d,loading:i,error:o}=Re(a);return console.log(d),i?e.jsx(ie,{size:"sm"}):o?e.jsx(v,{c:"red",size:"sm",children:o}):e.jsx(E,{label:"Value",data:d.map(n=>({value:n.predefined_value,label:n.predefined_value})),value:c,onChange:n=>s(n||"")})},Te=({onAdd:a})=>{const{modals:c,closeModal:s}=I(),d=c.relatedDocumentModal,[i,o]=g.useState(null),{data:n,loading:p,error:m}=we(i,d),x=t=>{o(t)},r=()=>{n.itemParent&&n.itemParent.parent_id?o(n.itemParent.parent_id):o(null)},h=t=>{a(t),s("relatedDocumentModal"),o(null)};return e.jsx(H,{opened:d,onClose:()=>s("relatedDocumentModal"),title:"Select Related Document",size:"lg",children:e.jsxs(_,{gap:"md",children:[e.jsxs(C,{children:[i&&e.jsx(y,{onClick:r,children:e.jsx(Ie,{size:16})}),e.jsx(v,{children:"Select a document to relate"})]}),p?e.jsx(v,{children:"Loading..."}):m?e.jsx(v,{c:"red",children:m}):e.jsx(_,{style:{maxHeight:400,overflowY:"auto"},children:n.itemContents.map(t=>e.jsxs(C,{style:{cursor:"pointer"},onClick:()=>{t.type==="folder"?x(t.item_id):h({item_id:t.item_id,name:t.name})},children:[t.type==="folder"?e.jsx(ye,{}):e.jsx(Ae,{}),e.jsx(v,{children:t.name})]},t.item_id))})]})})},Le=({relatedDocuments:a,onChange:c})=>{const{openModal:s}=I(),d=o=>{const n=[...a,o];c&&c(n)},i=o=>{const n=a.filter((p,m)=>m!==o);c&&c(n)};return e.jsxs(_,{children:[a.map((o,n)=>e.jsxs(C,{grow:!0,align:"center",children:[e.jsx(v,{children:o.name}),e.jsx(y,{color:"red",onClick:()=>i(n),children:e.jsx(W,{size:16})})]},o.item_id)),e.jsx(Te,{onAdd:d}),e.jsx(S,{variant:"light",onClick:()=>s("relatedDocumentModal"),leftSection:e.jsx(Y,{size:14}),children:"Add Related Document"})]})};function Be({document:a,onSuccess:c}){const{data:s,setData:d,put:i,processing:o,errors:n,reset:p,clearErrors:m}=ce({name:a.name,document_number:a.document_number||"",description:a.description||"",due_date:a.due_date||"",update_metadata:a.metadata.map(r=>({metadata_id:r.metadata_id,name:r.name,value:r.value})),delete_metadata:[],related_documents:a.related_documents.map(r=>({item_id:r.item_id,name:r.name}))});return{data:s,setData:d,handleUpdateDocument:r=>{r.preventDefault(),console.log(s),i(route("document.save",a.item_id),{onSuccess:()=>{G.show({message:"Document updated successfully",color:"green"})},onError:h=>{G.show({message:"Failed to update document",color:"red"})},onFinish:()=>m()})},processing:o,errors:n,reset:p}}function pt({document:a,itemAncestors:c}){const{data:s,setData:d,handleUpdateDocument:i,processing:o,errors:n,reset:p}=Be({document:a}),[m,x]=g.useState([]),r=l=>{d("update_metadata",[...s.update_metadata||[],l])},h=l=>{s.update_metadata=l},t=l=>{d("update_metadata",l)},u=l=>{x(M=>[...M,l]),d("delete_metadata",[...s.delete_metadata||[],{metadata_id:l}])},f=l=>{d("related_documents",l)};return e.jsxs(he,{children:[e.jsx(ue,{title:"Document Properties"}),e.jsx(me,{px:8,py:8,children:e.jsx(xe,{ancestors:c})}),e.jsxs(_,{px:8,py:8,gap:24,w:550,mb:72,children:[e.jsxs(C,{mt:24,align:"center",children:[e.jsx(je,{mime:a.mime,isFolder:!1,reviewStatus:a.review_status,approvalStatus:a.approval_status}),e.jsx(v,{fw:500,children:s.name}),e.jsx(y,{variant:"subtle",color:"gray",children:e.jsx(Oe,{size:24})})]}),e.jsxs("form",{onSubmit:i,children:[e.jsxs(_,{gap:12,children:[e.jsx(z,{label:"Document Number",name:"document_number",value:s.document_number,onChange:l=>d("document_number",l.target.value),placeholder:"Enter document number"}),e.jsx(z,{type:"text",label:"Created At",value:a.created_at,disabled:!0}),e.jsx(Fe,{label:"Description",autosize:!0,minRows:4,maxRows:6,placeholder:"Enter description",value:s.description,onChange:l=>d("description",l.target.value)}),e.jsx(Pe,{label:"Due Date",placeholder:"Select due date",value:s.due_date?new Date(s.due_date):void 0,onChange:l=>d("due_date",(l==null?void 0:l.toISOString())??void 0)})]}),e.jsxs(_,{gap:12,mt:16,children:[e.jsx(v,{size:"sm",fw:500,children:"Custom Metadata Field"}),e.jsx(Ee,{metadata:s.update_metadata??[],requiredMetadata:a.required_folder_metadata,onAdd:r,onUpdate:h,onChange:t,onDelete:u})]}),e.jsxs(_,{gap:12,mt:16,children:[e.jsx(v,{size:"sm",fw:500,children:"Related Documents"}),e.jsx(Le,{relatedDocuments:s.related_documents||[],onChange:f})]}),e.jsxs(ge,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>pe.visit(route("document.show",{document:a.item_id})),children:"Cancel"}),e.jsx(S,{ml:12,type:"submit",loading:o,children:"Save Changes"})]})]})]})]})}export{pt as default};
