import{v as xt,f as Ze,u as $e,w as Pt,d as Qe,j as o,T as Bt,B as et,L as yt,O as nt,e as jt,l as qt,b as f,R as Yt,x as Kt,z as Ht,h as Gt,g as Vt,A as Jt,r as Y,W as X,n as O,M as ne,P as Xt,c as bt,a as He,y as Zt,Y as Qt}from"./app-Bi-kKfSQ.js";import{Y as eo}from"./index-BALgSnzC.js";import{u as to,G as U,A as L,M as me,e as oo,I as ro,d as so}from"./NotificationMenu-C937_Mzw.js";import{u as P,a as ge,b as re,T as V,A as no}from"./Authenticated-C_lZwoKT.js";import{I as ao}from"./ItemBreadcrumbs-BJ2dT-ld.js";import{u as lo}from"./Popover-DE1Ul7Ry.js";import{I as io,u as wt,R as he,a as co}from"./use-fetch-users-approval-role-BRZs4JWr.js";import{T as I,F as J}from"./OfficeLogo-2ZaB1g-B.js";import{S as se}from"./Stack-D9KjGeyZ.js";import{T as Dt}from"./Textarea-DetDTP7-.js";import{S as Ce}from"./Select-ChKntED6.js";import{B as F}from"./Button-1yfY3Uus.js";import{N as uo,U as po}from"./UpdateNumberingSchemeForm-456D64BZ.js";import{T as Ve}from"./TextInput-D9HeubEm.js";import{I as fo,u as mo}from"./use-generate-report-BbIWCa2V.js";import{c as H}from"./IconUser-DGEFyDH_.js";import{u as ho,a as go,A as vo,I as xo}from"./use-show-items-for-moving-CJy38cXg.js";import{I as yo}from"./IconFolder-cegEoVYR.js";import{I as jo}from"./IconDownload-C8ZGmfe3.js";import{u as bo}from"./use-document-properties-DK9wXSLN.js";import{u as wo}from"./use-fetch-metadata-CCUa2s-n.js";import"./Checkbox-3zVWk8bN.js";import"./InputBase-UL63YNSc.js";import"./use-uncontrolled-BwiKmmNw.js";import"./CheckIcon-DsGROgfh.js";import"./get-sorted-breakpoints-Cse3ButY.js";import"./Anchor-CbJtCjSK.js";import"./Combobox-BOP9bz1U.js";import"./clamp-DTmYCdls.js";function at(e){return typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1)}var kt={root:"m_6e45937b",loader:"m_e8eb006c",overlay:"m_df587f17"};const lt={transitionProps:{transition:"fade",duration:0},overlayProps:{backgroundOpacity:.75},zIndex:xt("overlay")},Do=jt((e,{zIndex:t})=>({root:{"--lo-z-index":t==null?void 0:t.toString()}})),tt=Ze((e,t)=>{const r=$e("LoadingOverlay",lt,e),{classNames:s,className:n,style:l,styles:a,unstyled:i,vars:c,transitionProps:p,loaderProps:C,overlayProps:D,visible:g,zIndex:h,...v}=r,u=Pt(),x=Qe({name:"LoadingOverlay",classes:kt,props:r,className:n,style:l,classNames:s,styles:a,unstyled:i,vars:c,varsResolver:Do}),j={...lt.overlayProps,...D};return o.jsx(Bt,{transition:"fade",...p,mounted:!!g,children:y=>o.jsxs(et,{...x("root",{style:y}),ref:t,...v,children:[o.jsx(yt,{...x("loader"),unstyled:i,...C}),o.jsx(nt,{...j,...x("overlay"),darkHidden:!0,unstyled:i,color:(D==null?void 0:D.color)||u.white}),o.jsx(nt,{...j,...x("overlay"),lightHidden:!0,unstyled:i,color:(D==null?void 0:D.color)||u.colors.dark[5]})]})})});tt.classes=kt;tt.displayName="@mantine/core/LoadingOverlay";var Ct={exports:{}},ko="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Co=ko,So=Co;function St(){}function _t(){}_t.resetWarningCache=St;var _o=function(){function e(s,n,l,a,i,c){if(c!==So){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:_t,resetWarningCache:St};return r.PropTypes=r,r};Ct.exports=_o();var Fo=Ct.exports;const _=qt(Fo);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Eo=H("outline","adjustments","IconAdjustments",[["path",{d:"M4 10a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M6 4v4",key:"svg-1"}],["path",{d:"M6 12v8",key:"svg-2"}],["path",{d:"M10 16a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-3"}],["path",{d:"M12 4v10",key:"svg-4"}],["path",{d:"M12 18v2",key:"svg-5"}],["path",{d:"M16 7a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-6"}],["path",{d:"M18 4v1",key:"svg-7"}],["path",{d:"M18 9v11",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Mo=H("outline","article","IconArticle",[["path",{d:"M3 4m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M7 8h10",key:"svg-1"}],["path",{d:"M7 12h10",key:"svg-2"}],["path",{d:"M7 16h10",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge=H("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var zo=H("outline","file-isr","IconFileIsr",[["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-1"}],["path",{d:"M6 8v-3a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-7",key:"svg-2"}],["path",{d:"M3 15l3 -3l3 3",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Io=H("outline","file-report","IconFileReport",[["path",{d:"M17 17m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-0"}],["path",{d:"M17 13v4h4",key:"svg-1"}],["path",{d:"M12 3v4a1 1 0 0 0 1 1h4",key:"svg-2"}],["path",{d:"M11.5 21h-6.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v2m0 3v4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ao=H("outline","folder-plus","IconFolderPlus",[["path",{d:"M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Oo=H("outline","folder-symlink","IconFolderSymlink",[["path",{d:"M3 21v-4a3 3 0 0 1 3 -3h5",key:"svg-0"}],["path",{d:"M8 17l3 -3l-3 -3",key:"svg-1"}],["path",{d:"M3 11v-5a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ro=H("outline","folder-up","IconFolderUp",[["path",{d:"M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M19 22v-6",key:"svg-1"}],["path",{d:"M22 19l-3 -3l-3 3",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Uo=H("outline","list-tree","IconListTree",[["path",{d:"M9 6h11",key:"svg-0"}],["path",{d:"M12 12h8",key:"svg-1"}],["path",{d:"M15 18h5",key:"svg-2"}],["path",{d:"M5 6v.01",key:"svg-3"}],["path",{d:"M8 12v.01",key:"svg-4"}],["path",{d:"M11 18v.01",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var To=H("outline","selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);const No=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function _e(e,t){const r=Wo(e);if(typeof r.path!="string"){const{webkitRelativePath:s}=e;Object.defineProperty(r,"path",{value:typeof t=="string"?t:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return r}function Wo(e){const{name:t}=e;if(t&&t.lastIndexOf(".")!==-1&&!e.type){const s=t.split(".").pop().toLowerCase(),n=No.get(s);n&&Object.defineProperty(e,"type",{value:n,writable:!1,configurable:!1,enumerable:!0})}return e}var ve=(e,t,r)=>new Promise((s,n)=>{var l=c=>{try{i(r.next(c))}catch(p){n(p)}},a=c=>{try{i(r.throw(c))}catch(p){n(p)}},i=c=>c.done?s(c.value):Promise.resolve(c.value).then(l,a);i((r=r.apply(e,t)).next())});const Lo=[".DS_Store","Thumbs.db"];function $o(e){return ve(this,null,function*(){return Te(e)&&Po(e.dataTransfer)?Ko(e.dataTransfer,e.type):Bo(e)?qo(e):Array.isArray(e)&&e.every(t=>"getFile"in t&&typeof t.getFile=="function")?Yo(e):[]})}function Po(e){return Te(e)}function Bo(e){return Te(e)&&Te(e.target)}function Te(e){return typeof e=="object"&&e!==null}function qo(e){return Je(e.target.files).map(t=>_e(t))}function Yo(e){return ve(this,null,function*(){return(yield Promise.all(e.map(r=>r.getFile()))).map(r=>_e(r))})}function Ko(e,t){return ve(this,null,function*(){if(e.items){const r=Je(e.items).filter(n=>n.kind==="file");if(t!=="drop")return r;const s=yield Promise.all(r.map(Ho));return it(Ft(s))}return it(Je(e.files).map(r=>_e(r)))})}function it(e){return e.filter(t=>Lo.indexOf(t.name)===-1)}function Je(e){if(e===null)return[];const t=[];for(let r=0;r<e.length;r++){const s=e[r];t.push(s)}return t}function Ho(e){if(typeof e.webkitGetAsEntry!="function")return ct(e);const t=e.webkitGetAsEntry();return t&&t.isDirectory?Et(t):ct(e)}function Ft(e){return e.reduce((t,r)=>[...t,...Array.isArray(r)?Ft(r):[r]],[])}function ct(e){const t=e.getAsFile();if(!t)return Promise.reject(`${e} is not a File`);const r=_e(t);return Promise.resolve(r)}function Go(e){return ve(this,null,function*(){return e.isDirectory?Et(e):Vo(e)})}function Et(e){const t=e.createReader();return new Promise((r,s)=>{const n=[];function l(){t.readEntries(a=>ve(this,null,function*(){if(a.length){const i=Promise.all(a.map(Go));n.push(i),l()}else try{const i=yield Promise.all(n);r(i)}catch(i){s(i)}}),a=>{s(a)})}l()})}function Vo(e){return ve(this,null,function*(){return new Promise((t,r)=>{e.file(s=>{const n=_e(s,e.fullPath);t(n)},s=>{r(s)})})})}function Jo(e,t){if(e&&t){const r=Array.isArray(t)?t:t.split(","),s=e.name||"",n=(e.type||"").toLowerCase(),l=n.replace(/\/.*$/,"");return r.some(a=>{const i=a.trim().toLowerCase();return i.charAt(0)==="."?s.toLowerCase().endsWith(i):i.endsWith("/*")?l===i.replace(/\/.*$/,""):n===i})}return!0}var Xo=Object.defineProperty,Zo=Object.defineProperties,Qo=Object.getOwnPropertyDescriptors,dt=Object.getOwnPropertySymbols,er=Object.prototype.hasOwnProperty,tr=Object.prototype.propertyIsEnumerable,ut=(e,t,r)=>t in e?Xo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,or=(e,t)=>{for(var r in t||(t={}))er.call(t,r)&&ut(e,r,t[r]);if(dt)for(var r of dt(t))tr.call(t,r)&&ut(e,r,t[r]);return e},rr=(e,t)=>Zo(e,Qo(t));const sr="file-invalid-type",nr="file-too-large",ar="file-too-small",lr="too-many-files",ir=e=>{e=Array.isArray(e)&&e.length===1?e[0]:e;const t=Array.isArray(e)?`one of ${e.join(", ")}`:e;return{code:sr,message:`File type must be ${t}`}},pt=e=>({code:nr,message:`File is larger than ${e} ${e===1?"byte":"bytes"}`}),ft=e=>({code:ar,message:`File is smaller than ${e} ${e===1?"byte":"bytes"}`}),cr={code:lr,message:"Too many files"};function Mt(e,t){const r=e.type==="application/x-moz-file"||Jo(e,t);return[r,r?null:ir(t)]}function zt(e,t,r){if(ce(e.size))if(ce(t)&&ce(r)){if(e.size>r)return[!1,pt(r)];if(e.size<t)return[!1,ft(t)]}else{if(ce(t)&&e.size<t)return[!1,ft(t)];if(ce(r)&&e.size>r)return[!1,pt(r)]}return[!0,null]}function ce(e){return e!=null}function dr({files:e,accept:t,minSize:r,maxSize:s,multiple:n,maxFiles:l,validator:a}){return!n&&e.length>1||n&&l>=1&&e.length>l?!1:e.every(i=>{const[c]=Mt(i,t),[p]=zt(i,r,s),C=a?a(i):null;return c&&p&&!C})}function Ne(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Ue(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,t=>t==="Files"||t==="application/x-moz-file"):!!e.target&&!!e.target.files}function mt(e){e.preventDefault()}function ur(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function pr(e){return e.indexOf("Edge/")!==-1}function fr(e=window.navigator.userAgent){return ur(e)||pr(e)}function K(...e){return(t,...r)=>e.some(s=>(!Ne(t)&&s&&s(t,...r),Ne(t)))}function mr(){return"showOpenFilePicker"in window}function hr(e){return ce(e)?[{description:"Files",accept:Object.entries(e).filter(([r,s])=>{let n=!0;return It(r)||(console.warn(`Skipped "${r}" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.`),n=!1),(!Array.isArray(s)||!s.every(At))&&(console.warn(`Skipped "${r}" because an invalid file extension was provided.`),n=!1),n}).reduce((r,[s,n])=>rr(or({},r),{[s]:n}),{})}]:e}function gr(e){if(ce(e))return Object.entries(e).reduce((t,[r,s])=>[...t,r,...s],[]).filter(t=>It(t)||At(t)).join(",")}function vr(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function xr(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function It(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function At(e){return/^.*\.[\w]+$/.test(e)}var yr=Object.defineProperty,jr=Object.defineProperties,br=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,Ot=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable,ht=(e,t,r)=>t in e?yr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$=(e,t)=>{for(var r in t||(t={}))Ot.call(t,r)&&ht(e,r,t[r]);if(We)for(var r of We(t))Rt.call(t,r)&&ht(e,r,t[r]);return e},oe=(e,t)=>jr(e,br(t)),Le=(e,t)=>{var r={};for(var s in e)Ot.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&We)for(var s of We(e))t.indexOf(s)<0&&Rt.call(e,s)&&(r[s]=e[s]);return r};const ot=f.forwardRef((e,t)=>{var r=e,{children:s}=r,n=Le(r,["children"]);const l=Tt(n),{open:a}=l,i=Le(l,["open"]);return f.useImperativeHandle(t,()=>({open:a}),[a]),Yt.createElement(f.Fragment,null,s(oe($({},i),{open:a})))});ot.displayName="Dropzone";const Ut={disabled:!1,getFilesFromEvent:$o,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0,autoFocus:!1};ot.defaultProps=Ut;ot.propTypes={children:_.func,accept:_.objectOf(_.arrayOf(_.string)),multiple:_.bool,preventDropOnDocument:_.bool,noClick:_.bool,noKeyboard:_.bool,noDrag:_.bool,noDragEventsBubbling:_.bool,minSize:_.number,maxSize:_.number,maxFiles:_.number,disabled:_.bool,getFilesFromEvent:_.func,onFileDialogCancel:_.func,onFileDialogOpen:_.func,useFsAccessApi:_.bool,autoFocus:_.bool,onDragEnter:_.func,onDragLeave:_.func,onDragOver:_.func,onDrop:_.func,onDropAccepted:_.func,onDropRejected:_.func,onError:_.func,validator:_.func};const Xe={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Tt(e={}){const{accept:t,disabled:r,getFilesFromEvent:s,maxSize:n,minSize:l,multiple:a,maxFiles:i,onDragEnter:c,onDragLeave:p,onDragOver:C,onDrop:D,onDropAccepted:g,onDropRejected:h,onFileDialogCancel:v,onFileDialogOpen:u,useFsAccessApi:x,autoFocus:j,preventDropOnDocument:y,noClick:m,noKeyboard:S,noDrag:b,noDragEventsBubbling:M,onError:w,validator:E}=$($({},Ut),e),z=f.useMemo(()=>gr(t),[t]),R=f.useMemo(()=>hr(t),[t]),Z=f.useMemo(()=>typeof u=="function"?u:gt,[u]),Q=f.useMemo(()=>typeof v=="function"?v:gt,[v]),T=f.useRef(null),B=f.useRef(null),[Fe,W]=f.useReducer(wr,Xe),{isFocused:Pe,isFileDialogActive:xe}=Fe,de=f.useRef(typeof window<"u"&&window.isSecureContext&&x&&mr()),Be=()=>{!de.current&&xe&&setTimeout(()=>{if(B.current){const{files:d}=B.current;d.length||(W({type:"closeDialog"}),Q())}},300)};f.useEffect(()=>(window.addEventListener("focus",Be,!1),()=>{window.removeEventListener("focus",Be,!1)}),[B,xe,Q,de]);const le=f.useRef([]),Ee=d=>{T.current&&T.current.contains(d.target)||(d.preventDefault(),le.current=[])};f.useEffect(()=>(y&&(document.addEventListener("dragover",mt,!1),document.addEventListener("drop",Ee,!1)),()=>{y&&(document.removeEventListener("dragover",mt),document.removeEventListener("drop",Ee))}),[T,y]),f.useEffect(()=>(!r&&j&&T.current&&T.current.focus(),()=>{}),[T,j,r]);const G=f.useCallback(d=>{w?w(d):console.error(d)},[w]),Me=f.useCallback(d=>{d.preventDefault(),d.persist(),Re(d),le.current=[...le.current,d.target],Ue(d)&&Promise.resolve(s(d)).then(k=>{if(Ne(d)&&!M)return;const A=k.length,N=A>0&&dr({files:k,accept:z,minSize:l,maxSize:n,multiple:a,maxFiles:i,validator:E}),q=A>0&&!N;W({isDragAccept:N,isDragReject:q,isDragActive:!0,type:"setDraggedFiles"}),c&&c(d)}).catch(k=>G(k))},[s,c,G,M,z,l,n,a,i,E]),ze=f.useCallback(d=>{d.preventDefault(),d.persist(),Re(d);const k=Ue(d);if(k&&d.dataTransfer)try{d.dataTransfer.dropEffect="copy"}catch{}return k&&C&&C(d),!1},[C,M]),Ie=f.useCallback(d=>{d.preventDefault(),d.persist(),Re(d);const k=le.current.filter(N=>T.current&&T.current.contains(N)),A=k.indexOf(d.target);A!==-1&&k.splice(A,1),le.current=k,!(k.length>0)&&(W({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Ue(d)&&p&&p(d))},[T,p,M]),ie=f.useCallback((d,k)=>{const A=[],N=[];d.forEach(q=>{const[be,we]=Mt(q,z),[qe,Ye]=zt(q,l,n),De=E?E(q):null;if(be&&qe&&!De)A.push(q);else{let ke=[we,Ye];De&&(ke=ke.concat(De)),N.push({file:q,errors:ke.filter(Ke=>Ke)})}}),(!a&&A.length>1||a&&i>=1&&A.length>i)&&(A.forEach(q=>{N.push({file:q,errors:[cr]})}),A.splice(0)),W({acceptedFiles:A,fileRejections:N,type:"setFiles"}),D&&D(A,N,k),N.length>0&&h&&h(N,k),A.length>0&&g&&g(A,k)},[W,a,z,l,n,i,D,g,h,E]),ue=f.useCallback(d=>{d.preventDefault(),d.persist(),Re(d),le.current=[],Ue(d)&&Promise.resolve(s(d)).then(k=>{Ne(d)&&!M||ie(k,d)}).catch(k=>G(k)),W({type:"reset"})},[s,ie,G,M]),ee=f.useCallback(()=>{if(de.current){W({type:"openDialog"}),Z();const d={multiple:a,types:R};window.showOpenFilePicker(d).then(k=>s(k)).then(k=>{ie(k,null),W({type:"closeDialog"})}).catch(k=>{vr(k)?(Q(k),W({type:"closeDialog"})):xr(k)?(de.current=!1,B.current?(B.current.value=null,B.current.click()):G(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):G(k)});return}B.current&&(W({type:"openDialog"}),Z(),B.current.value=null,B.current.click())},[W,Z,Q,x,ie,G,R,a]),pe=f.useCallback(d=>{!T.current||!T.current.isEqualNode(d.target)||(d.key===" "||d.key==="Enter"||d.keyCode===32||d.keyCode===13)&&(d.preventDefault(),ee())},[T,ee]),fe=f.useCallback(()=>{W({type:"focus"})},[]),Ae=f.useCallback(()=>{W({type:"blur"})},[]),ye=f.useCallback(()=>{m||(fr()?setTimeout(ee,0):ee())},[m,ee]),te=d=>r?null:d,je=d=>S?null:te(d),Oe=d=>b?null:te(d),Re=d=>{M&&d.stopPropagation()},Nt=f.useMemo(()=>(d={})=>{var k=d,{refKey:A="ref",role:N,onKeyDown:q,onFocus:be,onBlur:we,onClick:qe,onDragEnter:Ye,onDragOver:De,onDragLeave:ke,onDrop:Ke}=k,$t=Le(k,["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"]);return $($({onKeyDown:je(K(q,pe)),onFocus:je(K(be,fe)),onBlur:je(K(we,Ae)),onClick:te(K(qe,ye)),onDragEnter:Oe(K(Ye,Me)),onDragOver:Oe(K(De,ze)),onDragLeave:Oe(K(ke,Ie)),onDrop:Oe(K(Ke,ue)),role:typeof N=="string"&&N!==""?N:"presentation",[A]:T},!r&&!S?{tabIndex:0}:{}),$t)},[T,pe,fe,Ae,ye,Me,ze,Ie,ue,S,b,r]),Wt=f.useCallback(d=>{d.stopPropagation()},[]),Lt=f.useMemo(()=>(d={})=>{var k=d,{refKey:A="ref",onChange:N,onClick:q}=k,be=Le(k,["refKey","onChange","onClick"]);const we={accept:z,multiple:a,type:"file",style:{display:"none"},onChange:te(K(N,ue)),onClick:te(K(q,Wt)),tabIndex:-1,[A]:B};return $($({},we),be)},[B,t,a,ue,r]);return oe($({},Fe),{isFocused:Pe&&!r,getRootProps:Nt,getInputProps:Lt,rootRef:T,inputRef:B,open:te(ee)})}function wr(e,t){switch(t.type){case"focus":return oe($({},e),{isFocused:!0});case"blur":return oe($({},e),{isFocused:!1});case"openDialog":return oe($({},Xe),{isFileDialogActive:!0});case"closeDialog":return oe($({},e),{isFileDialogActive:!1});case"setDraggedFiles":return oe($({},e),{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return oe($({},e),{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return $({},Xe);default:return e}}function gt(){}const[Dr,kr]=Kt("Dropzone component was not found in tree");function rt(e){const t=r=>{const{children:s,...n}=$e(`Dropzone${at(e)}`,{},r),l=kr(),a=Ht(s)?s:o.jsx("span",{children:s});return l[e]?f.cloneElement(a,n):null};return t.displayName=`@mantine/dropzone/${at(e)}`,t}const Cr=rt("accept"),Sr=rt("reject"),_r=rt("idle");var Se={root:"m_d46a4834",inner:"m_b85f7144",fullScreen:"m_96f6e9ad",dropzone:"m_7946116d"};const Fr={loading:!1,multiple:!0,maxSize:1/0,autoFocus:!1,activateOnClick:!0,activateOnDrag:!0,dragEventsBubbling:!0,activateOnKeyboard:!0,useFsAccessApi:!0,variant:"light",rejectColor:"red"},Er=jt((e,{radius:t,variant:r,acceptColor:s,rejectColor:n})=>{const l=e.variantColorResolver({color:s||e.primaryColor,theme:e,variant:r}),a=e.variantColorResolver({color:n||"red",theme:e,variant:r});return{root:{"--dropzone-radius":Vt(t),"--dropzone-accept-color":l.color,"--dropzone-accept-bg":l.background,"--dropzone-reject-color":a.color,"--dropzone-reject-bg":a.background}}}),ae=Ze((e,t)=>{const r=$e("Dropzone",Fr,e),{classNames:s,className:n,style:l,styles:a,unstyled:i,vars:c,radius:p,disabled:C,loading:D,multiple:g,maxSize:h,accept:v,children:u,onDropAny:x,onDrop:j,onReject:y,openRef:m,name:S,maxFiles:b,autoFocus:M,activateOnClick:w,activateOnDrag:E,dragEventsBubbling:z,activateOnKeyboard:R,onDragEnter:Z,onDragLeave:Q,onDragOver:T,onFileDialogCancel:B,onFileDialogOpen:Fe,preventDropOnDocument:W,useFsAccessApi:Pe,getFilesFromEvent:xe,validator:de,rejectColor:Be,acceptColor:le,enablePointerEvents:Ee,loaderProps:G,inputProps:Me,mod:ze,...Ie}=r,ie=Qe({name:"Dropzone",classes:Se,props:r,className:n,style:l,classNames:s,styles:a,unstyled:i,vars:c,varsResolver:Er}),{getRootProps:ue,getInputProps:ee,isDragAccept:pe,isDragReject:fe,open:Ae}=Tt({onDrop:x,onDropAccepted:j,onDropRejected:y,disabled:C||D,accept:Array.isArray(v)?v.reduce((te,je)=>({...te,[je]:[]}),{}):v,multiple:g,maxSize:h,maxFiles:b,autoFocus:M,noClick:!w,noDrag:!E,noDragEventsBubbling:!z,noKeyboard:!R,onDragEnter:Z,onDragLeave:Q,onDragOver:T,onFileDialogCancel:B,onFileDialogOpen:Fe,preventDropOnDocument:W,useFsAccessApi:Pe,validator:de,...xe?{getFilesFromEvent:xe}:null});Gt(m,Ae);const ye=!pe&&!fe;return o.jsx(Dr,{value:{accept:pe,reject:fe,idle:ye},children:o.jsxs(et,{...ue(),...ie("root",{focusable:!0}),...Ie,mod:[{accept:pe,reject:fe,idle:ye,disabled:C,loading:D,"activate-on-click":w},ze],children:[o.jsx(tt,{visible:D,overlayProps:{radius:p},unstyled:i,loaderProps:G}),o.jsx("input",{...ee(Me),name:S}),o.jsx("div",{...ie("inner"),ref:t,"data-enable-pointer-events":Ee||void 0,children:u})]})})});ae.classes=Se;ae.displayName="@mantine/dropzone/Dropzone";ae.Accept=Cr;ae.Idle=_r;ae.Reject=Sr;const Mr={loading:!1,maxSize:1/0,activateOnClick:!1,activateOnDrag:!0,dragEventsBubbling:!0,activateOnKeyboard:!0,active:!0,zIndex:xt("max"),withinPortal:!0},st=Ze((e,t)=>{const r=$e("DropzoneFullScreen",Mr,e),{classNames:s,className:n,style:l,styles:a,unstyled:i,vars:c,active:p,onDrop:C,onReject:D,zIndex:g,withinPortal:h,portalProps:v,...u}=r,x=Qe({name:"DropzoneFullScreen",classes:Se,props:r,className:n,style:l,classNames:s,styles:a,unstyled:i,rootSelector:"fullScreen"}),{resolvedClassNames:j,resolvedStyles:y}=lo({classNames:s,styles:a,props:r}),[m,S]=f.useState(0),[b,{open:M,close:w}]=to(!1),E=R=>{var Z;(Z=R.dataTransfer)!=null&&Z.types.includes("Files")&&(S(Q=>Q+1),M())},z=()=>{S(R=>R-1)};return f.useEffect(()=>{m===0&&w()},[m]),f.useEffect(()=>{if(p)return document.addEventListener("dragenter",E,!1),document.addEventListener("dragleave",z,!1),()=>{document.removeEventListener("dragenter",E,!1),document.removeEventListener("dragleave",z,!1)}},[p]),o.jsx(Jt,{...v,withinPortal:h,children:o.jsx(et,{...x("fullScreen",{style:{opacity:b?1:0,pointerEvents:b?"all":"none",zIndex:g}}),ref:t,children:o.jsx(ae,{...u,classNames:j,styles:y,unstyled:i,className:Se.dropzone,onDrop:R=>{C==null||C(R),w(),S(0)},onReject:R=>{D==null||D(R),w(),S(0)}})})})});st.classes=Se;st.displayName="@mantine/dropzone/DropzoneFullScreen";ae.FullScreen=st;const vt=ae;function zr({onDrop:e,openRef:t,children:r}){return o.jsxs(vt,{openRef:t,onDrop:e,activateOnClick:!1,acceptColor:"var(--mantine-color-white)",styles:{root:{border:"none",padding:0}},children:[o.jsx(vt.Accept,{children:o.jsx(io,{style:{width:Y(52),height:Y(52),color:"var(--mantine-color-blue-6)",position:"absolute",bottom:Y(16),left:"50%",transform:"translateX(-50%)",zIndex:9999},stroke:1.5})}),r]})}function Ir({itemParentId:e}){const[t,r]=f.useState("reviewal"),{closeModal:s,modals:n}=P(),l=wt(t,n.createWorkflow),{data:a,setData:i,post:c,processing:p,errors:C,reset:D}=X({folder_item_id:"",resolution:"",destination:"",type:"reviewal",users:[]}),[g,h]=f.useState([]),v=l.length;f.useEffect(()=>{h([])},[t,l]);const u=b=>{b.preventDefault();const M=g.map(w=>parseInt(w.selectedUser)).filter(w=>!isNaN(w));a.folder_item_id=e??"",a.users=M.map(w=>({user_id:w})),c(route("workflows.store"),{preserveScroll:!0,onSuccess:()=>{s("createWorkflow"),O.show({message:"Approval process created",color:"green"})},onError:()=>{O.show({message:"Something went wrong",color:"red"})},onFinish:()=>D()})},x=()=>{g.length<v&&h([...g,{selectedUser:""}])},j=()=>{const b=g.map(E=>E.selectedUser),w=l.filter(E=>!b.includes(E.id.toString())).map(E=>({selectedUser:E.id.toString()}));h([...g,...w])},y=b=>{const M=[...g];M.splice(b,1),h(M)},m=(b,M)=>{const w=[...g];w[b].selectedUser=M||"",h(w)},S=g.map(b=>b.selectedUser).filter(b=>b!=="");return{data:a,setData:i,createApprovalSubmit:u,processing:p,errors:C,users:g,setWorkflowType:r,addUser:x,removeUser:y,handleUserChange:m,addAllUsers:j,maxUsers:v,selectedUserIds:S,fetchedUsers:l}}const Ar=({itemParent:e})=>{const{data:t,setData:r,createApprovalSubmit:s,processing:n,errors:l,users:a,setWorkflowType:i,addUser:c,removeUser:p,handleUserChange:C,addAllUsers:D,maxUsers:g,selectedUserIds:h,fetchedUsers:v}=Ir({itemParentId:e==null?void 0:e.item_id}),{modals:u,closeModal:x}=P(),j=y=>v.filter(m=>!h.includes(m.id.toString())||m.id.toString()===a[y].selectedUser).map(m=>({value:m.id.toString(),label:`${m.name} (${m.email})`}));return o.jsx(ne,{opened:u.createWorkflow,onClose:()=>x("createWorkflow"),title:o.jsx(I,{fw:"bold",size:"lg",children:"Create Workflow Process"}),size:550,children:o.jsxs("form",{onSubmit:s,children:[o.jsxs(se,{gap:16,children:[o.jsx(I,{size:"sm",color:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined approval workflow"}),o.jsx(he.Group,{name:"status",value:t.type,onChange:y=>{r("type",y),i(y)},children:o.jsxs(U,{mt:"xs",children:[o.jsx(he,{value:"reviewal",label:"Review"}),o.jsx(he,{value:"approval",label:"Approval"})]})}),o.jsx(Dt,{label:"Resolution",placeholder:"Your resolution for this approval",value:t.resolution??"",onChange:y=>r("resolution",y.target.value),error:l.resolution,autosize:!0,minRows:2,maxRows:4}),o.jsx(I,{size:"sm",fw:500,mb:-8,children:"Users in this workflow"}),a.map((y,m)=>o.jsxs(U,{justify:"space-between",align:"flex-end",children:[o.jsx(Ce,{placeholder:"Select a user",data:j(m),value:y.selectedUser,onChange:S=>C(m,S),required:!0,style:{flex:1},allowDeselect:!1}),o.jsx(L,{color:"red",onClick:()=>p(m),title:"Remove User",children:o.jsx(ge,{size:18})})]},m)),o.jsxs(U,{children:[a.length<g&&o.jsx(F,{variant:"subtle",color:"green",leftSection:o.jsx(re,{size:16}),onClick:c,disabled:a.length>=g,children:"Add User"}),h.length<g&&o.jsx(F,{variant:"subtle",color:"blue",leftSection:o.jsx(re,{size:16}),onClick:D,disabled:a.length>=g,children:"Add All Users"})]})]}),o.jsxs(J,{align:"center",justify:"end",mt:16,children:[o.jsx(F,{variant:"light",onClick:()=>x("createWorkflow"),children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function Or({itemParent:e}){const{data:t,setData:r,post:s,processing:n,errors:l,reset:a}=X({folder_item_id:(e==null?void 0:e.item_id)??"",name:"",prefix:"",next_number:1,reset_frequency:"none"}),{closeModal:i}=P();return{data:t,setData:r,handleSubmit:p=>{p.preventDefault(),t.folder_item_id=(e==null?void 0:e.item_id)??"",console.log("Submitting data",t),s(route("numbering-scheme.store"),{preserveScroll:!0,onSuccess:()=>{i("createNumberingScheme"),O.show({message:"Numbering scheme created",color:"green"})},onError:C=>{console.log(C),O.show({message:"Something went wrong",color:"red"})},onFinish:()=>a()})},processing:n,errors:l}}const Rr=({itemParent:e})=>{const{data:t,setData:r,handleSubmit:s,processing:n,errors:l}=Or({itemParent:e}),{modals:a,closeModal:i}=P(),[c,p]=f.useState([]);f.useEffect(()=>{const u=c.map(x=>x.type==="text"?x.value:`[${x.value}]`).join(" ");r("prefix",u)},[c]);const C=()=>{p([...c,{id:Date.now(),type:"text",value:""}])},D=()=>{p([...c,{id:Date.now(),type:"dynamic",value:""}])},g=(u,x)=>{p(c.map(j=>j.id===u?{...j,value:x}:j))},h=u=>{p(c.filter(x=>x.id!==u))},v=[{value:"YY",label:"Year"},{value:"MM",label:"Month"},{value:"DD",label:"Day"},{value:"INC",label:"Increment"}];return o.jsx(ne,{opened:a.createNumberingScheme,onClose:()=>i("createNumberingScheme"),title:o.jsx(I,{size:"lg",children:"Create Numbering Scheme"}),size:600,children:o.jsxs("form",{onSubmit:s,children:[o.jsxs(se,{gap:16,children:[o.jsx(Ve,{label:"Name",value:t.name,onChange:u=>r("name",u.target.value),error:l.name,required:!0}),o.jsx(I,{size:"sm",fw:500,children:"Prefix"}),o.jsxs(U,{children:[o.jsx(F,{variant:"subtle",size:"sm",leftSection:o.jsx(re,{size:16}),onClick:C,children:"Add Text"}),o.jsx(F,{variant:"subtle",size:"sm",leftSection:o.jsx(re,{size:16}),onClick:D,children:"Add Dynamic"})]}),c.map((u,x)=>o.jsxs(U,{align:"flex-end",children:[u.type==="text"?o.jsx(Ve,{placeholder:"Enter text",value:u.value,onChange:j=>g(u.id,j.target.value),required:!0,style:{flex:1}}):o.jsx(Ce,{placeholder:"Select dynamic part",data:v,value:u.value,onChange:j=>g(u.id,j||""),required:!0,style:{flex:1}}),o.jsx(L,{color:"red",onClick:()=>h(u.id),children:o.jsx(ge,{size:16})})]},u.id)),o.jsx(I,{size:"sm",fw:500,children:"Preview:"}),o.jsx(Xt,{withBorder:!0,p:12,bg:"#f9f9f9",children:o.jsx(I,{children:c.map(u=>{if(u.type==="text")return u.value+" ";switch(u.value){case"YY":return new Date().getFullYear().toString().slice(2)+" ";case"MM":return(new Date().getMonth()+1).toString()+" ";case"DD":return new Date().getDate().toString()+" ";case"INC":return t.next_number.toString()+" ";default:return""}}).join(" ")})}),o.jsx(U,{justify:"space-between",children:o.jsx(uo,{label:"Next Number",value:t.next_number,onChange:u=>r("next_number",Number(u)),min:1,error:l.next_number,required:!0,style:{flex:1}})}),o.jsx(Ce,{label:"Reset Frequency",data:[{value:"none",label:"None"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],value:t.reset_frequency,onChange:u=>r("reset_frequency",u??"none"),error:l.reset_frequency,required:!0})]}),o.jsxs(J,{align:"center",justify:"end",mt:24,children:[o.jsx(F,{variant:"light",onClick:()=>i("createNumberingScheme"),children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function Ur({itemParent:e,close:t}){const{data:r,setData:s,post:n,processing:l,errors:a,reset:i,clearErrors:c}=X({parent_id:"",name:""}),{closeModal:p}=P();return{data:r,setData:s,submit:D=>{r.parent_id=(e==null?void 0:e.item_id)||"",D.preventDefault(),n(route("folder.create"),{preserveScroll:!0,onSuccess:()=>{O.show({message:"New folder created",color:"green"})},onError:g=>{let h="";Object.keys(g).length>0?h=g[Object.keys(g)[0]]:h="Error during file upload. Please try again later.",O.show({message:h,color:"red"})},onFinish:()=>{p("folder"),i(),c()}})},processing:l,errors:a}}const Tr=({itemParent:e})=>{const{data:t,setData:r,submit:s,processing:n,errors:l}=Ur({itemParent:e,close}),{modals:a,closeModal:i}=P();return o.jsx(ne,{opened:a.folder,onClose:()=>i("folder"),title:o.jsx(I,{fw:"bold",size:"lg",children:"Create Folder"}),size:550,children:o.jsxs("form",{onSubmit:s,children:[o.jsx(se,{gap:16,children:o.jsx(Ve,{id:"name",type:"text",name:"name",value:t.name,placeholder:"Folder Name",onChange:c=>r("name",c.target.value),error:l.name})}),o.jsxs(J,{align:"center",justify:"end",mt:16,children:[o.jsx(F,{variant:"outline",onClick:()=>i("folder"),children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:n,children:"Create"})]})]})})};function Nr({workflowId:e,isOpen:t}){const[r,s]=f.useState(null);f.useEffect(()=>{e&&t&&n(e)},[e,t]);const n=async l=>{try{const a=await bt.get(`/workflows/${l}`);s(a.data)}catch(a){console.error("Error fetching workflow",a)}};return r}function Wr({itemParent:e,isOpen:t}){const[r,s]=f.useState("reviewal"),n=Nr({workflowId:e==null?void 0:e.workflow_id,isOpen:t}),l=wt(r,t),{closeModal:a}=P(),{data:i,setData:c,put:p,processing:C,errors:D,reset:g,clearErrors:h}=X({resolution:"",type:"",users:[]}),[v,u]=f.useState([]),x=l.length;f.useEffect(()=>{n&&(s(n.type||""),c({resolution:n.resolution||"",type:n.type||"",users:n.users.map(w=>({user_id:w.id}))}),u(n.users.map(w=>({selectedUser:w.id.toString()}))))},[n,t]),f.useEffect(()=>{u([])},[r]);const j=w=>{w.preventDefault();const E=v.map(z=>parseInt(z.selectedUser)).filter(z=>!isNaN(z));i.users=E.map(z=>({user_id:z})),p(route("workflows.update",e==null?void 0:e.workflow_id),{onSuccess:()=>{a("updateWorkflow"),O.show({message:"Workflow updated successfully",color:"green"})},onError:z=>{O.show({message:"Something went wrong",color:"red"})},onFinish:()=>g()})},y=()=>{v.length<x&&u([...v,{selectedUser:""}])},m=()=>{const w=v.map(R=>R.selectedUser),z=l.filter(R=>!w.includes(R.id.toString())).map(R=>({selectedUser:R.id.toString()}));u([...v,...z])},S=w=>{const E=[...v];E.splice(w,1),u(E)},b=(w,E)=>{const z=[...v];z[w].selectedUser=E||"",u(z)},M=v.map(w=>w.selectedUser).filter(w=>w!=="");return{data:i,setData:c,handleUpdateWorkflow:j,processing:C,errors:D,users:v,setWorkflowType:s,addUser:y,removeUser:S,handleUserChange:b,addAllUsers:m,maxUsers:x,selectedUserIds:M,fetchedUsers:l}}function Lr({workflowId:e,onDeleteSuccess:t}){const{delete:r,processing:s}=X();return{handleDeleteWorkflow:()=>{if(!e){O.show({message:"Workflow ID is missing.",color:"red"});return}r(route("workflows.destroy",e),{preserveScroll:!0,onSuccess:()=>{O.show({message:"Workflow deleted successfully.",color:"green"}),t()},onError:l=>{let a="Failed to delete workflow.";l&&Object.keys(l).length>0&&(a=l[Object.keys(l)[0]]),O.show({message:a,color:"red"})}})},processing:s}}const $r=({workflowId:e})=>{const{modals:t,closeModal:r,openModal:s}=P(),n=t.confirmDeleteWorkflow,{handleDeleteWorkflow:l,processing:a}=Lr({workflowId:e,onDeleteSuccess:()=>{r("confirmDeleteWorkflow"),r("updateWorkflow")}});return o.jsxs(ne,{opened:n,onClose:()=>r("confirmDeleteWorkflow"),title:o.jsx(I,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[o.jsx(I,{c:"gray.8",children:"Are you sure you want to delete this workflow? This action cannot be undone."}),o.jsxs(J,{align:"center",justify:"flex-end",mt:16,children:[o.jsx(F,{variant:"light",onClick:()=>{r("confirmDeleteWorkflow"),s("updateWorkflow")},children:"Cancel"}),o.jsx(F,{color:"red",ml:12,onClick:l,loading:a,children:"Delete"})]})]})},Pr=({itemParent:e})=>{const{modals:t,closeModal:r,openModal:s}=P(),n=t.updateWorkflow,{data:l,setData:a,handleUpdateWorkflow:i,processing:c,users:p,setWorkflowType:C,addUser:D,removeUser:g,handleUserChange:h,addAllUsers:v,maxUsers:u,selectedUserIds:x,fetchedUsers:j,errors:y}=Wr({itemParent:e,isOpen:n}),m=S=>j.filter(b=>!x.includes(b.id.toString())||b.id.toString()===p[S].selectedUser).map(b=>({value:b.id.toString(),label:`${b.name} (${b.email})`}));return o.jsxs(o.Fragment,{children:[o.jsx(ne,{opened:n,onClose:()=>r("updateWorkflow"),title:o.jsx(I,{fw:"bold",size:"lg",children:"Update Workflow Process"}),size:550,children:o.jsxs("form",{onSubmit:i,children:[o.jsxs(se,{gap:16,children:[o.jsx(I,{size:"sm",c:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined approval workflow"}),o.jsx(he.Group,{name:"status",value:l.type,onChange:S=>{a("type",S),C(S)},children:o.jsxs(U,{mt:"xs",children:[o.jsx(he,{value:"reviewal",label:"Review"}),o.jsx(he,{value:"approval",label:"Approval"})]})}),o.jsx(Dt,{label:"Resolution",placeholder:"Your resolution for this approval",value:l.resolution??"",onChange:S=>a("resolution",S.target.value),error:y.resolution,autosize:!0,minRows:2,maxRows:4}),o.jsx(I,{size:"sm",fw:500,mb:-8,children:"Users in this workflow"}),p.map((S,b)=>o.jsxs(U,{justify:"space-between",align:"flex-end",children:[o.jsx(Ce,{placeholder:"Select a user",data:m(b),value:S.selectedUser,onChange:M=>h(b,M),required:!0,style:{flex:1},allowDeselect:!1}),o.jsx(L,{color:"red",onClick:()=>g(b),title:"Remove User",children:o.jsx(ge,{size:18})})]},b)),o.jsxs(U,{children:[p.length<u&&o.jsx(F,{variant:"subtle",color:"green",leftSection:o.jsx(re,{size:16}),onClick:D,disabled:p.length>=u,children:"Add User"}),x.length<u&&o.jsx(F,{variant:"subtle",color:"blue",leftSection:o.jsx(re,{size:16}),onClick:v,disabled:p.length>=u,children:"Add All Users"})]})]}),o.jsxs(J,{align:"center",justify:"end",mt:16,children:[o.jsx(F,{variant:"light",onClick:()=>r("updateWorkflow"),children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:c,children:"Update"}),o.jsx(L,{variant:"transparent",color:"red",onClick:()=>{s("confirmDeleteWorkflow"),r("updateWorkflow")},title:"Delete Workflow",ml:12,children:o.jsx(ge,{size:18})})]})]})}),o.jsx($r,{workflowId:e==null?void 0:e.workflow_id})]})},Br=({uploadFileRef:e,itemParent:t})=>{var n;const{openModal:r}=P(),{generateReport:s}=mo();return o.jsxs(U,{h:"50%",px:32,align:"center",justify:"space-between",children:[o.jsxs(U,{gap:"xs",children:[o.jsxs(me,{shadow:"md",width:220,transitionProps:{transition:"pop-top-left"},position:"bottom-start",children:[o.jsx(me.Target,{children:o.jsx(F,{variant:"subtle",color:"dark.3",leftSection:o.jsx(re,{size:18}),rightSection:o.jsx(Ge,{size:12}),children:"New"})}),o.jsxs(me.Dropdown,{children:[o.jsx(me.Item,{leftSection:o.jsx(Ao,{style:{width:Y(14),height:Y(14)}}),onClick:()=>r("folder"),children:"New Folder"}),o.jsx(me.Item,{leftSection:o.jsx(zo,{style:{width:Y(14),height:Y(14)}}),onClick:()=>{var l;return(l=e==null?void 0:e.current)==null?void 0:l.call(e)},children:"Upload Files"}),o.jsx(me.Item,{leftSection:o.jsx(Ro,{style:{width:Y(14),height:Y(14)}}),children:"Upload Folder"})]})]}),o.jsx(V,{label:"Properties",position:"bottom",withArrow:!0,children:o.jsx(L,{component:He,size:"lg",href:route("folder.edit",{id:t==null?void 0:t.item_id}),variant:"transparent",color:"dark.3",children:o.jsx(Eo,{size:18})})}),o.jsx(V,{label:"Workflow",position:"bottom",withArrow:!0,children:o.jsx(L,{variant:"transparent",size:"lg",color:t!=null&&t.workflow_id?"green.8":"dark.3",onClick:()=>r(t!=null&&t.workflow_id?"updateWorkflow":"createWorkflow"),children:o.jsx(co,{size:18})})}),o.jsx(V,{label:"Metadata",position:"bottom",withArrow:!0,children:o.jsx(L,{component:He,size:"lg",href:route("folder.showRequiredMetadata",{id:t==null?void 0:t.item_id}),variant:"transparent",color:(n=t==null?void 0:t.required_metadata)!=null&&n.length?"green.8":"dark.3",children:o.jsx(oo,{size:18})})}),o.jsx(V,{label:"Activity",position:"bottom",withArrow:!0,children:o.jsx(L,{component:He,size:"lg",href:route("folder.activity-log",{id:t==null?void 0:t.item_id}),variant:"transparent",color:"dark.3",children:o.jsx(Mo,{size:18})})}),o.jsx(V,{label:"Numbering",position:"bottom",withArrow:!0,children:o.jsx(L,{size:"lg",variant:"transparent",color:t!=null&&t.numbering_scheme_id?"green.8":"dark.3",onClick:()=>r(t!=null&&t.numbering_scheme_id?"updateNumberingScheme":"createNumberingScheme"),children:o.jsx(Uo,{size:18})})}),o.jsx(V,{label:"Column",position:"bottom",withArrow:!0,children:o.jsx(L,{variant:"transparent",color:"dark.3",size:"lg",onClick:()=>r("selectMetadataColumns"),children:o.jsx(fo,{size:18})})}),o.jsx(V,{label:"Report",position:"bottom",withArrow:!0,children:o.jsx(L,{variant:"transparent",color:"dark.3",size:"lg",onClick:()=>s((t==null?void 0:t.item_id)??""),children:o.jsx(Io,{size:18})})})]}),o.jsxs(U,{gap:"xs",children:[o.jsx(V,{label:"Sort",position:"bottom",withArrow:!0,children:o.jsxs(L,{variant:"transparent",color:"dark.3",size:"lg",children:[o.jsx(To,{size:18}),o.jsx(Ge,{size:12,style:{marginLeft:Y(4)}})]})}),o.jsx(V,{label:"View",position:"bottom",withArrow:!0,children:o.jsxs(L,{variant:"transparent",color:"dark.3",size:"lg",children:[o.jsx(ro,{size:18}),o.jsx(Ge,{size:12,style:{marginLeft:Y(4)}})]})})]}),o.jsx(Tr,{itemParent:t}),o.jsx(Ar,{itemParent:t}),o.jsx(Pr,{itemParent:t}),o.jsx(Rr,{itemParent:t}),o.jsx(po,{itemParent:t})]})};function qr(e){return fetch(e,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>t.json())}function Yr(){return{downloadFiles:({all:t,ids:r,parentId:s})=>{if(!t&&(r==null?void 0:r.length)===0)return;const n=new URLSearchParams;s&&n.append("parent_id",String(s)),t?n.append("all",t?"1":"0"):r==null||r.forEach(a=>n.append("ids[]",a));const l=route("item.download");qr(`${l}?${n.toString()}`).then(a=>{if(!a.url)return;const i=document.createElement("a");i.download=a.filename,i.href=a.url,i.click()})}}}function Kr({setSelectedRecord:e}){const{data:t,delete:r,processing:s}=X({ids:[]}),{closeModal:n}=P();return{handleDelete:a=>{t.ids=a,r(route("item.delete"),{onSuccess:()=>{n("deleteFiles"),setTimeout(()=>{e([])},100),O.show({message:"Files deleted",color:"green"})},onError:i=>{let c="Error during file deletion. Please try again later.";Object.keys(i).length>0&&(c=i[Object.keys(i)[0]]),O.show({message:c,color:"red"})}})},processing:s}}const Hr=({selectedIds:e,setSelectedRecord:t})=>{const{handleDelete:r,processing:s}=Kr({setSelectedRecord:t}),{modals:n,closeModal:l}=P();return o.jsx(ne,{opened:n.deleteFiles,onClose:()=>l("deleteFiles"),title:o.jsx(I,{fw:"bold",size:"lg",children:"Delete Files"}),size:550,children:o.jsxs("form",{onSubmit:a=>{a.preventDefault(),r(e)},children:[o.jsx(I,{c:"dimmed",children:"Delete selected files?"}),o.jsxs(J,{align:"center",justify:"end",mt:16,children:[o.jsx(F,{variant:"subtle",onClick:()=>l("deleteFiles"),color:"gray",children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:s,color:"red",children:"Delete"})]})]})})};function Gr({setSelectedRecord:e}){const{data:t,setData:r,put:s,processing:n,errors:l,reset:a,clearErrors:i}=X({ids:[],destination_folder_id:""});return{data:t,setData:r,moveDocuments:()=>{s(route("document.move"),{onSuccess:()=>{e([]),O.show({message:"Documents moved successfully",color:"green"}),a()},onError:p=>{O.show({message:"Failed to move documents",color:"red"})},onFinish:()=>{i()}})},processing:n,errors:l,reset:a}}const Vr=({selectedDocumentIds:e,setSelectedRecord:t})=>{const{modals:r,closeModal:s}=P(),n=r.moveModal,[l,a]=f.useState(null),{data:i,loading:c,error:p}=ho(l,n),{data:C,setData:D,moveDocuments:g,processing:h}=Gr({setSelectedRecord:t}),v=j=>{a(j)},u=()=>{i.itemParent&&i.itemParent.parent_id?a(i.itemParent.parent_id):a(null)},x=()=>{if(!l){O.show({message:"Please select a destination folder.",color:"red"});return}C.ids=e,C.destination_folder_id=l,g(),s("moveModal")};return o.jsx(ne,{opened:n,onClose:()=>s("moveModal"),title:"Move Documents",size:"lg",children:o.jsxs(se,{gap:"md",children:[o.jsxs(U,{children:[l&&o.jsx(L,{onClick:u,children:o.jsx(go,{size:16})}),o.jsx(I,{children:"Choose Destination Folder"})]}),c?o.jsx(I,{children:"Loading..."}):p?o.jsx(I,{c:"red",children:p}):o.jsx(se,{gap:"sm",style:{maxHeight:400,overflowY:"auto"},children:i.itemContents.map(j=>o.jsxs(U,{gap:"sm",style:{cursor:"pointer"},onDoubleClick:()=>v(j.item_id),children:[o.jsx(yo,{}),o.jsx(I,{children:j.name})]},j.item_id))}),o.jsxs(U,{justify:"flex-end",mt:"md",children:[o.jsx(F,{variant:"outline",onClick:()=>s("moveModal"),children:"Cancel"}),o.jsx(F,{onClick:x,disabled:!l||h,loading:h,children:"Move Here"})]})]})})},Jr=({setSelectedRecord:e,selectedIds:t,parentId:r})=>{const{downloadFiles:s}=Yr(),{openModal:n}=P();return o.jsxs(U,{h:"50%",px:"md",align:"center",justify:"flex-start",children:[o.jsx(F,{onClick:()=>n("deleteFiles"),variant:"subtle",color:"dark.3",leftSection:o.jsx(ge,{size:18}),children:"Delete"}),o.jsx(F,{onClick:()=>s({all:!1,ids:t,parentId:r}),variant:"subtle",color:"dark.3",leftSection:o.jsx(jo,{size:18}),children:"Download"}),o.jsx(F,{onClick:()=>n("moveModal"),variant:"subtle",color:"dark.3",leftSection:o.jsx(Oo,{size:18}),children:"Move"}),o.jsx(Hr,{selectedIds:t,setSelectedRecord:e}),o.jsx(Vr,{selectedDocumentIds:t,setSelectedRecord:e})]})};function Xr(e){const{data:t,post:r,reset:s,clearErrors:n}=X({parent_id:"",files:[]});return{uploadFiles:a=>{t.parent_id=e.item_id,t.files=a.map(i=>({file:i})),r(route("document.store"),{onSuccess:()=>{O.show({message:"Document uploaded",color:"green"})},onError:i=>{let c="";Object.keys(i).length>0?c=i[Object.keys(i)[0]]:c="Error during file upload. Please try again later.",O.show({message:c,color:"red"})},onFinish:()=>{s(),n()}})}}}function Zr(){const[e,t]=f.useState([]),s=(n=>n.map(l=>l.id))(e);return{selectedRecord:e,setSelectedRecord:t,ids:s}}function Qr(){return{openFolder:(t,r)=>{t==="folder"&&Zt.visit(route("folder.show",{id:r}))}}}function es({folderId:e,isOpen:t}){const[r,s]=f.useState([]),[n,l]=f.useState(!1),[a,i]=f.useState(null);return f.useEffect(()=>{e&&t&&(async()=>{l(!0);try{const p=await bt.get(`/folder/${e}/metadata_columns`);s(p.data.metadata_columns),i(null)}catch(p){i("Failed to fetch existing metadata columns."),console.error(p)}finally{l(!1)}})()},[e,t]),{existingMetadataColumns:r,loading:n,error:a}}const ts=({folderId:e})=>{const{modals:t,closeModal:r}=P(),s=t.selectMetadataColumns,{metadataList:n}=wo(),{existingMetadataColumns:l,loading:a,error:i}=es({folderId:e,isOpen:s}),{data:c,setData:p,post:C,processing:D,errors:g,reset:h}=X({metadata_columns:[{id:Date.now(),value:""}],metadata_ids:[]});f.useEffect(()=>{if(l.length>0){const y=l.map(m=>({id:m.metadata_id,value:m.metadata_id.toString()}));p("metadata_columns",y)}},[l]),f.useEffect(()=>{const y=c.metadata_columns.map(m=>parseInt(m.value)).filter(m=>!isNaN(m));p("metadata_ids",y)},[c.metadata_columns]);const v=()=>{p("metadata_columns",[...c.metadata_columns,{id:Date.now(),value:""}])},u=y=>{p("metadata_columns",c.metadata_columns.filter(m=>m.id!==y))},x=(y,m)=>{const S=c.metadata_columns.map(b=>b.id===y?{...b,value:m}:b);p("metadata_columns",S)},j=y=>{y.preventDefault(),c.metadata_columns.map(m=>parseInt(m.value)).filter(m=>!isNaN(m)),C(route("folder.selectMetadataColumn",e),{preserveScroll:!0,onSuccess:()=>{r("selectMetadataColumns"),O.show({title:"Success",message:"Metadata columns selected successfully",color:"green"}),h()},onError:()=>{O.show({title:"Error",message:"Failed to select metadata columns",color:"red"})}})};return o.jsx(ne,{opened:s,onClose:()=>{r("selectMetadataColumns"),h()},title:o.jsx(I,{fw:"bold",size:"lg",children:"Select Metadata Columns"}),size:550,children:a?o.jsx(J,{justify:"center",align:"center",h:"100%",children:o.jsx(yt,{})}):i?o.jsx(vo,{icon:o.jsx(xo,{size:16}),title:"Error",color:"red",children:i}):o.jsxs("form",{onSubmit:j,children:[o.jsxs(se,{gap:16,children:[o.jsx(I,{c:"dimmed",children:"Select the metadata columns you want to display"}),c.metadata_columns.map(y=>o.jsxs(U,{justify:"space-between",align:"flex-end",children:[o.jsx(Ce,{placeholder:"Pick a metadata column",data:n.map(m=>({value:m.metadata_id.toString(),label:m.name})),value:y.value,onChange:m=>x(y.id,m||""),w:"90%",required:!0}),c.metadata_columns.length>1&&o.jsx(L,{color:"red",variant:"subtle",onClick:()=>u(y.id),children:o.jsx(ge,{size:18})})]},y.id)),o.jsx(J,{justify:"flex-start",children:o.jsx(F,{variant:"subtle",color:"blue.5",leftSection:o.jsx(re,{size:18}),onClick:v,children:"Add New Column"})})]}),o.jsxs(J,{align:"center",justify:"end",mt:16,children:[o.jsx(F,{variant:"outline",onClick:()=>{r("selectMetadataColumns"),h()},children:"Cancel"}),o.jsx(F,{ml:12,type:"submit",loading:D,children:"Save"})]})]})})};function zs({itemParent:e,itemAncestors:t,itemContents:r}){var g;const s=f.useRef(null),{uploadFiles:n}=Xr(e),{selectedRecord:l,setSelectedRecord:a,ids:i}=Zr(),{openFolder:c}=Qr(),{openDocument:p}=bo(),C=(g=e.metadata_columns)==null?void 0:g.map(h=>({accessor:`metadata_${h.metadata_id}`,title:h.name,render:v=>{var x;const u=(x=v.metadata)==null?void 0:x.find(j=>j.metadata_id===h.metadata_id);return u?u.value:null}})),D=[{accessor:"name",render:({mime:h,type:v,name:u,status:x,missing_required_metadata:j})=>o.jsxs(U,{align:"center",gap:12,children:[o.jsx(so,{mime:h??"",isFolder:v==="folder",approvalStatus:x,missingRequiredMetadata:j}),o.jsx("span",{children:u})]})},{accessor:"updated_at",title:"Last Modified"},...C??[]];return o.jsxs(o.Fragment,{children:[o.jsx(Qt,{title:"My Files"}),o.jsx(no,{toolbar:l.length>0?o.jsx(Jr,{setSelectedRecord:a,selectedIds:i,parentId:e.item_id}):o.jsx(Br,{itemParent:e,uploadFileRef:s}),children:o.jsx(zr,{onDrop:n,openRef:s,children:o.jsxs(se,{px:8,gap:24,py:8,style:{pointerEvents:"all"},children:[o.jsx(ao,{ancestors:t}),r.length?o.jsx(eo,{textSelectionDisabled:!0,columns:D,records:r,customRowAttributes:({type:h,id:v})=>({onDoubleClick:u=>{u.button===0&&(h==="folder"?c(h,v):h==="document"&&p(v))}}),highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",selectedRecords:l,onSelectedRecordsChange:a}):o.jsx(I,{size:"lg",c:"gray.5",children:"This folder is empty"})]})})}),o.jsx(ts,{folderId:e.item_id})]})}export{zs as default};
