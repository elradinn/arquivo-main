import{b as z,W as V,n as k,j as e,M as W,c as Q,Y as ee,B as se,P as te,a as re}from"./app-o_n_Q1_4.js";import{u as F,a as G,b as P,T as oe,A as le}from"./Authenticated-Cec13kwc.js";import{Y as ne}from"./index-D6ebzEKS.js";import{I as ae}from"./ItemBreadcrumbs-BRG66SY9.js";import{u as H,R as M,a as ce,I as K,b as ie}from"./use-fetch-users-C9pMgBkp.js";import{T as _,F as q}from"./OfficeLogo-Cx0EXCVw.js";import{S as N}from"./Stack-CedQLgvk.js";import{G as E,A as B,S as X,c as de}from"./NotificationMenu-D2gMmxnP.js";import{T as J}from"./Textarea-AYMrpB1M.js";import{S as Y}from"./Select-BW0R6EY3.js";import{B as S}from"./Button-QcSAzscX.js";import{G as L}from"./Grid-C3o69jJ_.js";import{c as ue}from"./IconUser-BqmWWyqY.js";import{I as pe}from"./IconEye-CycpB_e6.js";import"./TextInput-Yso5tBj3.js";import"./InputBase-CTp7OGFz.js";import"./Popover-CjVYgpjS.js";import"./use-uncontrolled-CloXekY7.js";import"./get-sorted-breakpoints-6caYqVKE.js";import"./Checkbox-BRedaS4F.js";import"./CheckIcon-z59qNQSx.js";import"./Anchor-o9Y3yiSS.js";import"./Combobox-D5pGux-b.js";import"./get-base-value-JqT_q0U7.js";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var me=ue("outline","pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]);function he({documentId:s,isOpen:l}){const[r,c]=z.useState("approval"),{closeModal:o,modals:a}=F(),n=H(r,l),{data:j,setData:D,post:w,processing:R,errors:h,reset:C}=V({document_id:"",resolution:"",destination:"",type:"approval",users:[]}),[U,i]=z.useState([]),u=n.length;z.useEffect(()=>{l&&i([])},[r,n,l]);const y=g=>{g.preventDefault();const b=U.map(t=>parseInt(t.selectedUser)).filter(t=>!isNaN(t));j.document_id=s??"",j.users=b.map(t=>({user_id:t.toString()})),w(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentApproval"),k.show({message:"Document approval process created",color:"green"})},onError:()=>{k.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},d=()=>{U.length<u&&i([...U,{selectedUser:""}])},A=()=>{const g=U.map(p=>p.selectedUser),t=n.filter(p=>!g.includes(p.id.toString())).map(p=>({selectedUser:p.id.toString()}));i([...U,...t])},v=g=>{const b=[...U];b.splice(g,1),i(b)},f=(g,b)=>{const t=[...U];t[g].selectedUser=b||"",i(t)},I=U.map(g=>g.selectedUser).filter(g=>g!=="");return{data:j,setData:D,createApprovalSubmit:y,processing:R,errors:h,users:U,setDocumentApprovalType:c,addUser:d,removeUser:v,handleUserChange:f,addAllUsers:A,maxUsers:u,selectedUserIds:I,fetchedUsers:n}}const ve=({document:s})=>{const{modals:l,closeModal:r}=F(),c=l.createDocumentApproval,{data:o,setData:a,createApprovalSubmit:n,processing:j,errors:D,users:w,setDocumentApprovalType:R,addUser:h,removeUser:C,handleUserChange:U,addAllUsers:i,maxUsers:u,selectedUserIds:y,fetchedUsers:d}=he({documentId:s==null?void 0:s.item_id,isOpen:c}),A=v=>d.filter(f=>!y.includes(f.id.toString())||f.id.toString()===w[v].selectedUser).map(f=>({value:f.id.toString(),label:`${f.name} (${f.email})`}));return e.jsx(W,{opened:l.createDocumentApproval,onClose:()=>r("createDocumentApproval"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(N,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:v=>{a("type",v),R(v)},hidden:!0,children:e.jsxs(E,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:v=>a("resolution",v.target.value),error:D.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(_,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),w.map((v,f)=>e.jsxs(E,{justify:"space-between",align:"flex-end",children:[e.jsx(Y,{placeholder:"Select a user",data:A(f),value:v.selectedUser,onChange:I=>U(f,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(B,{color:"red",onClick:()=>C(f),title:"Remove User",children:e.jsx(G,{size:18})})]},f)),e.jsxs(E,{children:[w.length<u&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:h,disabled:w.length>=u,children:"Add User"}),y.length<u&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:i,disabled:w.length>=u,children:"Add All Users"})]})]}),e.jsxs(q,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>r("createDocumentApproval"),children:"Cancel"}),e.jsx(S,{ml:12,type:"submit",loading:j,children:"Create"})]})]})})};function Z({documentApprovalId:s,isOpen:l}){const[r,c]=z.useState(null);z.useEffect(()=>{s&&l&&o(s)},[s,l]);const o=async a=>{try{const n=await Q.get(`/document_approval/${a}/update`);c(n.data)}catch(n){console.error("Error fetching document approval",n)}};return r}function fe({documentApprovalId:s,isOpen:l}){const[r,c]=z.useState(""),o=Z({documentApprovalId:s,isOpen:l}),a=H(r,l),{closeModal:n}=F(),{data:j,setData:D,put:w,processing:R,errors:h,reset:C,clearErrors:U}=V({resolution:"",type:"",users:[]}),[i,u]=z.useState([]),y=a.length;z.useEffect(()=>{o&&(c(o.type),u((o.document_user_approvals||[]).map(t=>({selectedUser:t.user_id.toString()}))),D({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(t=>({user_id:t.user_id}))}))},[o,l,r]),z.useEffect(()=>{l||u([])},[r]);const d=()=>{n("viewDocumentApproval"),C(),U()},A=t=>{t.preventDefault(),j.users=i.map(p=>parseInt(p.selectedUser)).filter(p=>!isNaN(p)).map(p=>({user_id:p.toString()})),w(route("document_approvals.update",s),{onSuccess:()=>{d(),k.show({message:"Document approval updated successfully",color:"green"})},onError:()=>{k.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},v=()=>{i.length<y&&u([...i,{selectedUser:""}])},f=()=>{const t=i.map(x=>x.selectedUser),m=a.filter(x=>!t.includes(x.id.toString())).map(x=>({selectedUser:x.id.toString()}));u([...i,...m])},I=t=>{const p=[...i];p.splice(t,1),u(p)},g=(t,p)=>{const m=[...i];m[t].selectedUser=p||"",u(m)},b=i.map(t=>t.selectedUser).filter(t=>t!=="");return{data:j,setData:D,handleUpdateDocumentApproval:A,processing:R,errors:h,handleClose:d,users:i,documentApproval:o,setDocumentApprovalType:c,addUser:v,removeUser:I,handleUserChange:g,addAllUsers:f,maxUsers:y,selectedUserIds:b,fetchedUsers:a}}function ge({documentApprovalId:s,onDeleteSuccess:l}){const{delete:r,processing:c}=V();return{handleDeleteDocumentApproval:()=>{if(!s){k.show({message:"Document Approval ID is missing.",color:"red"});return}r(route("document_approvals.cancel",s),{onSuccess:()=>{k.show({message:"Document Approval deleted successfully.",color:"green"}),l()},onError:a=>{let n="Failed to delete document approval.";a&&Object.keys(a).length>0&&(n=a[Object.keys(a)[0]]),k.show({message:n,color:"red"})}})},processing:c}}const je=({documentApprovalId:s})=>{const{modals:l,closeModal:r,openModal:c}=F(),o=l.confirmDeleteDocumentApproval,{handleDeleteDocumentApproval:a,processing:n}=ge({documentApprovalId:s,onDeleteSuccess:()=>{r("confirmDeleteDocumentApproval"),r("viewDocumentApproval")}});return e.jsxs(W,{opened:o,onClose:()=>r("confirmDeleteDocumentApproval"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(_,{c:"gray.8",children:"Are you sure you want to cancel this document approval? This action cannot be undone."}),e.jsxs(q,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>{r("confirmDeleteDocumentApproval"),c("viewDocumentApproval")},children:"Cancel"}),e.jsx(S,{color:"red",ml:12,onClick:a,loading:n,children:"Delete"})]})]})},xe=({document:s})=>{var t,p;const{modals:l,closeModal:r,openModal:c}=F(),o=l.viewDocumentApproval,a=(p=(t=s==null?void 0:s.document_approval_ids)==null?void 0:t.find(m=>m.type==="approval"))==null?void 0:p.id,{data:n,setData:j,handleUpdateDocumentApproval:D,processing:w,errors:R,users:h,setDocumentApprovalType:C,addUser:U,removeUser:i,handleUserChange:u,addAllUsers:y,documentApproval:d,maxUsers:A,selectedUserIds:v,fetchedUsers:f}=fe({documentApprovalId:a,isOpen:o}),I=m=>f.filter(x=>!v.includes(x.id.toString())||x.id.toString()===h[m].selectedUser).map(x=>({value:x.id.toString(),label:`${x.name} (${x.email})`})),g=d==null?void 0:d.document_user_approvals.some(m=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(m.user_state)),b=d==null?void 0:d.document_user_approvals.every(m=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(m.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(W,{opened:o,onClose:()=>r("viewDocumentApproval"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Document Approval Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(N,{gap:16,children:[e.jsx(_,{size:"sm",children:"View the document workflow process for this document"}),!g&&e.jsx(M.Group,{name:"status",value:n.type,onChange:m=>{j("type",m),C(m)},hidden:!0,children:e.jsxs(E,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:n.resolution??"",onChange:m=>j("resolution",m.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:g}),e.jsx(_,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),h.map((m,x)=>{const T=d==null?void 0:d.document_user_approvals.find(O=>O.user_id.toString()===m.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(E,{justify:"space-between",align:"flex-end",children:[e.jsx(E,{children:e.jsx(X,{state:T==null?void 0:T.user_state})}),e.jsx(Y,{placeholder:"Select a user",data:I(x),value:m.selectedUser,onChange:O=>u(x,O),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(B,{color:"red",onClick:()=>i(x),title:"Remove User",children:e.jsx(G,{size:18})})]},x)}),!b&&e.jsxs(E,{children:[h.length<A&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:U,disabled:h.length>=A,children:"Add User"}),v.length<A&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:y,disabled:h.length>=A,children:"Add All Users"})]})]}),e.jsxs(q,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>r("viewDocumentApproval"),children:b?"Close":"Cancel"}),!b&&e.jsxs(e.Fragment,{children:[e.jsx(S,{ml:12,type:"submit",loading:w,children:"Update"}),e.jsx(B,{variant:"transparent",color:"red",onClick:()=>{r("viewDocumentApproval"),c("confirmDeleteDocumentApproval")},title:"Delete Document Approval",ml:12,children:e.jsx(G,{size:18})})]})]})]})}),e.jsx(je,{documentApprovalId:a})]})};function Ue(s){const{data:l,post:r,reset:c,processing:o,errors:a,clearErrors:n}=V({document_item_id:s,file:null});return{uploadVersion:D=>{if(!D){k.show({message:"No file selected.",color:"red"});return}l.file=D,r(`/document/${s}/versions`,{onSuccess:()=>{k.show({message:"Document version uploaded successfully.",color:"green"}),c()},onError:()=>{k.show({message:"Failed to upload document version.",color:"red"})},onFinish:()=>{n()}})},processing:o,errors:a}}function we({documentId:s,isOpen:l}){const[r,c]=z.useState([]),[o,a]=z.useState(!1),[n,j]=z.useState(null);return z.useEffect(()=>{s&&(async()=>{a(!0);try{const w=await Q.get(route("document.fetchSharedUsers",{document:s}));c(w.data),j(null)}catch(w){console.error(w),j("Failed to fetch shared users."),k.show({title:"Error",message:"Unable to fetch shared users.",color:"red"})}finally{a(!1)}})()},[s,l]),{sharedUsers:r,loading:o,error:n}}function De({documentId:s,close:l}){const{modals:r}=F(),c=r.shareDocument,{sharedUsers:o,loading:a,error:n}=we({documentId:s,isOpen:c}),{data:j,setData:D,post:w,processing:R,errors:h,reset:C}=V({users:[]});return z.useEffect(()=>{if(o.length>0){const A=o.map(v=>({email:v.email,role:v.role}));D("users",A)}},[o]),{data:j,submit:()=>{w(route("document.share",{document:s}),{onSuccess:()=>{l(),k.show({message:"Document shared successfully.",color:"green"}),C()},onError:A=>{k.show({message:"Failed to share the document.",color:"red"})}})},processing:R,errors:h,addUser:()=>{D("users",[...j.users,{email:"",role:"viewer"}])},removeUser:A=>{const v=j.users.filter((f,I)=>I!==A);D("users",v)},handleUserChange:(A,v,f)=>{const I=j.users.map((g,b)=>b===A?{...g,[v]:f}:g);D("users",I)},handleAddAllUsers:A=>{D("users",A)}}}const Ae=({documentId:s})=>{const{modals:l,closeModal:r}=F(),{users:c,loading:o,error:a}=ce(),{data:n,submit:j,processing:D,errors:w,addUser:R,removeUser:h,handleUserChange:C,handleAddAllUsers:U}=De({documentId:s,close:()=>r("shareDocument")}),i=()=>{const u=c.map(y=>({email:y.email,role:"viewer"}));U(u)};return e.jsx(W,{opened:l.shareDocument,onClose:()=>r("shareDocument"),title:e.jsx(_,{size:"lg",children:"Share Document"}),size:"600",children:e.jsxs("form",{onSubmit:u=>{u.preventDefault(),j()},children:[e.jsxs(N,{children:[n.users.map((u,y)=>e.jsxs(E,{align:"flex-end",children:[e.jsx(Y,{data:c.map(d=>({value:d.email,label:`${d.name} (${d.email})`})),placeholder:"Select a user",value:u.email,onChange:d=>C(y,"email",d||""),style:{flex:1},required:!0}),e.jsx(Y,{data:[{value:"viewer",label:"Viewer"},{value:"editor",label:"Editor"}],placeholder:"Select role",value:u.role,onChange:d=>C(y,"role",d||"viewer"),style:{width:120},required:!0}),e.jsx(oe,{label:"Remove User",withArrow:!0,children:e.jsx(B,{color:"red",onClick:()=>h(y),children:e.jsx(G,{size:18})})})]},y)),e.jsxs(E,{children:[e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:()=>R(),children:"Add User"}),e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:i,disabled:n.users.length>=c.length,children:"Add All Users"})]})]}),e.jsxs(E,{mt:"md",children:[e.jsx(S,{variant:"outline",onClick:()=>r("shareDocument"),children:"Cancel"}),e.jsx(S,{type:"submit",loading:D,children:"Save"})]})]})})};function be({documentApprovalId:s,isOpen:l}){const[r,c]=z.useState(""),o=Z({documentApprovalId:s,isOpen:l}),a=H(r,l),{closeModal:n}=F(),{data:j,setData:D,put:w,processing:R,errors:h,reset:C,clearErrors:U}=V({resolution:"",type:"",users:[]}),[i,u]=z.useState([]),y=a.length;z.useEffect(()=>{o&&(c(o.type),u((o.document_user_approvals||[]).map(t=>({selectedUser:t.user_id.toString()}))),D({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(t=>({user_id:t.user_id}))}))},[o,l,r]),z.useEffect(()=>{l||u([])},[r]);const d=()=>{n("viewDocumentReview"),C(),U()},A=t=>{t.preventDefault(),j.users=i.map(p=>parseInt(p.selectedUser)).filter(p=>!isNaN(p)).map(p=>({user_id:p.toString()})),w(route("document_approvals.update",s),{onSuccess:()=>{d(),k.show({message:"Document approval updated successfully",color:"green"})},onError:()=>{k.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},v=()=>{i.length<y&&u([...i,{selectedUser:""}])},f=()=>{const t=i.map(x=>x.selectedUser),m=a.filter(x=>!t.includes(x.id.toString())).map(x=>({selectedUser:x.id.toString()}));u([...i,...m])},I=t=>{const p=[...i];p.splice(t,1),u(p)},g=(t,p)=>{const m=[...i];m[t].selectedUser=p||"",u(m)},b=i.map(t=>t.selectedUser).filter(t=>t!=="");return{data:j,setData:D,handleUpdateDocumentApproval:A,processing:R,errors:h,handleClose:d,users:i,documentApproval:o,setDocumentApprovalType:c,addUser:v,removeUser:I,handleUserChange:g,addAllUsers:f,maxUsers:y,selectedUserIds:b,fetchedUsers:a}}function Se({documentReviewId:s,onDeleteSuccess:l}){const{delete:r,processing:c}=V();return{handleDeleteDocumentReview:()=>{if(!s){k.show({message:"Document Review ID is missing.",color:"red"});return}r(route("document_approvals.cancel",s),{onSuccess:()=>{k.show({message:"Document Review deleted successfully.",color:"green"}),l()},onError:a=>{let n="Failed to delete document review.";a&&Object.keys(a).length>0&&(n=a[Object.keys(a)[0]]),k.show({message:n,color:"red"})}})},processing:c}}const ye=({documentReviewId:s})=>{const{modals:l,closeModal:r,openModal:c}=F(),o=l.confirmDeleteDocumentReview,{handleDeleteDocumentReview:a,processing:n}=Se({documentReviewId:s,onDeleteSuccess:()=>{r("confirmDeleteDocumentReview"),r("viewDocumentReview")}});return e.jsxs(W,{opened:o,onClose:()=>r("confirmDeleteDocumentReview"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(_,{c:"gray.8",children:"Are you sure you want to cancel this document review? This action cannot be undone."}),e.jsxs(q,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>{r("confirmDeleteDocumentReview"),c("viewDocumentReview")},children:"Cancel"}),e.jsx(S,{color:"red",ml:12,onClick:a,loading:n,children:"Delete"})]})]})},Ce=({document:s})=>{var t,p;const{modals:l,closeModal:r,openModal:c}=F(),o=l.viewDocumentReview,a=(p=(t=s==null?void 0:s.document_approval_ids)==null?void 0:t.find(m=>m.type==="reviewal"))==null?void 0:p.id,{data:n,setData:j,handleUpdateDocumentApproval:D,processing:w,errors:R,users:h,setDocumentApprovalType:C,addUser:U,removeUser:i,handleUserChange:u,addAllUsers:y,documentApproval:d,maxUsers:A,selectedUserIds:v,fetchedUsers:f}=be({documentApprovalId:a,isOpen:o}),I=m=>f.filter(x=>!v.includes(x.id.toString())||x.id.toString()===h[m].selectedUser).map(x=>({value:x.id.toString(),label:`${x.name} (${x.email})`})),g=d==null?void 0:d.document_user_approvals.some(m=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(m.user_state)),b=d==null?void 0:d.document_user_approvals.every(m=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(m.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(W,{opened:o,onClose:()=>r("viewDocumentReview"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Document Review Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(N,{gap:16,children:[e.jsx(_,{size:"sm",children:"View the document workflow process for this document"}),!g&&e.jsx(M.Group,{name:"status",value:n.type,onChange:m=>{j("type",m),C(m)},hidden:!0,children:e.jsxs(E,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:n.resolution??"",onChange:m=>j("resolution",m.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:g}),e.jsx(_,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),h.map((m,x)=>{const T=d==null?void 0:d.document_user_approvals.find(O=>O.user_id.toString()===m.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(E,{justify:"space-between",align:"flex-end",children:[e.jsx(E,{children:e.jsx(X,{state:T==null?void 0:T.user_state})}),e.jsx(Y,{placeholder:"Select a user",data:I(x),value:m.selectedUser,onChange:O=>u(x,O),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(B,{color:"red",onClick:()=>i(x),title:"Remove User",children:e.jsx(G,{size:18})})]},x)}),!b&&e.jsxs(E,{children:[h.length<A&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:U,disabled:h.length>=A,children:"Add User"}),v.length<A&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:y,disabled:h.length>=A,children:"Add All Users"})]})]}),e.jsxs(q,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>r("viewDocumentReview"),children:b?"Close":"Cancel"}),!b&&e.jsxs(e.Fragment,{children:[e.jsx(S,{ml:12,type:"submit",loading:w,children:"Update"}),e.jsx(B,{variant:"transparent",color:"red",onClick:()=>{r("viewDocumentReview"),c("confirmDeleteDocumentReview")},title:"Delete Document Approval",ml:12,children:e.jsx(G,{size:18})})]})]})]})}),e.jsx(ye,{documentReviewId:a})]})};function Re({documentId:s,isOpen:l}){const[r,c]=z.useState("reviewal"),{closeModal:o,modals:a}=F(),n=H(r,l),{data:j,setData:D,post:w,processing:R,errors:h,reset:C}=V({document_id:"",resolution:"",destination:"",type:"reviewal",users:[]}),[U,i]=z.useState([]),u=n.length;z.useEffect(()=>{l&&i([])},[r,n,l]);const y=g=>{g.preventDefault();const b=U.map(t=>parseInt(t.selectedUser)).filter(t=>!isNaN(t));j.document_id=s??"",j.users=b.map(t=>({user_id:t.toString()})),w(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentReview"),k.show({message:"Document review process created",color:"green"})},onError:()=>{k.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},d=()=>{U.length<u&&i([...U,{selectedUser:""}])},A=()=>{const g=U.map(p=>p.selectedUser),t=n.filter(p=>!g.includes(p.id.toString())).map(p=>({selectedUser:p.id.toString()}));i([...U,...t])},v=g=>{const b=[...U];b.splice(g,1),i(b)},f=(g,b)=>{const t=[...U];t[g].selectedUser=b||"",i(t)},I=U.map(g=>g.selectedUser).filter(g=>g!=="");return{data:j,setData:D,createApprovalSubmit:y,processing:R,errors:h,users:U,setDocumentApprovalType:c,addUser:d,removeUser:v,handleUserChange:f,addAllUsers:A,maxUsers:u,selectedUserIds:I,fetchedUsers:n}}const _e=({document:s})=>{const{modals:l,closeModal:r}=F(),c=l.createDocumentReview,{data:o,setData:a,createApprovalSubmit:n,processing:j,errors:D,users:w,setDocumentApprovalType:R,addUser:h,removeUser:C,handleUserChange:U,addAllUsers:i,maxUsers:u,selectedUserIds:y,fetchedUsers:d}=Re({documentId:s==null?void 0:s.item_id,isOpen:c}),A=v=>d.filter(f=>!y.includes(f.id.toString())||f.id.toString()===w[v].selectedUser).map(f=>({value:f.id.toString(),label:`${f.name} (${f.email})`}));return e.jsx(W,{opened:l.createDocumentReview,onClose:()=>r("createDocumentReview"),title:e.jsx(_,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(N,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:v=>{a("type",v),R(v)},hidden:!0,children:e.jsxs(E,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:v=>a("resolution",v.target.value),error:D.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(_,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),w.map((v,f)=>e.jsxs(E,{justify:"space-between",align:"flex-end",children:[e.jsx(Y,{placeholder:"Select a user",data:A(f),value:v.selectedUser,onChange:I=>U(f,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(B,{color:"red",onClick:()=>C(f),title:"Remove User",children:e.jsx(G,{size:18})})]},f)),e.jsxs(E,{children:[w.length<u&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:h,disabled:w.length>=u,children:"Add User"}),y.length<u&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:i,disabled:w.length>=u,children:"Add All Users"})]})]}),e.jsxs(q,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>r("createDocumentReview"),children:"Cancel"}),e.jsx(S,{ml:12,type:"submit",loading:j,children:"Create"})]})]})})},es=({document:s,itemAncestors:l,activityLog:r,userRole:c})=>{var w,R;const{openModal:o}=F();Ue(s.item_id);const a=(w=s.document_approval_ids)==null?void 0:w.some(h=>h.type==="reviewal"),n=(R=s.document_approval_ids)==null?void 0:R.some(h=>h.type==="approval"),D=[...[{name:"Document ID",value:s.item_id},{name:"Date",value:s.created_at},{name:"Document Number",value:s.document_number}],...s.metadata.map(h=>({name:h.name,value:h.value||"N/A"}))];return console.log(s),e.jsxs(le,{children:[e.jsx(ee,{title:"Document Properties"}),e.jsx(se,{px:8,py:8,mb:48,children:e.jsx(ae,{ancestors:l})}),e.jsxs(L,{children:[e.jsx(L.Col,{span:8,children:e.jsxs(N,{px:8,py:8,gap:48,mb:48,children:[e.jsxs(E,{children:[e.jsx(de,{mime:s.mime,isFolder:!1,reviewStatus:s.review_status,approvalStatus:s.approval_status}),e.jsx(_,{fw:500,children:s.name})]}),e.jsx(N,{gap:12,mt:24,children:D.length>0?e.jsx(L,{gutter:"lg",children:D.map((h,C)=>e.jsx(L.Col,{span:4,children:e.jsxs(N,{gap:4,children:[e.jsx(_,{size:"sm",fw:"bold",children:h.name}),e.jsx(_,{size:"sm",children:h.value})]})},`${h.name}-${C}`))}):e.jsx(_,{size:"sm",c:"dimmed",children:"No metadata available."})}),e.jsxs(N,{gap:12,children:[e.jsx(_,{size:"sm",fw:"bold",children:"Audit Log"}),e.jsx(ne,{textSelectionDisabled:!0,columns:[{accessor:"date"},{accessor:"time"},{accessor:"user_name",title:"User"},{accessor:"description",title:"Action"}],records:r,highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",withTableBorder:!0})]})]})}),e.jsx(L.Col,{span:3,offset:1,children:e.jsxs(te,{withBorder:!0,p:20,children:[e.jsx(_,{c:"dimmed",fw:500,children:"Options"}),(c==="editor"||c==="admin")&&e.jsx(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(me,{size:18}),fullWidth:!0,justify:"left",component:re,href:route("document.edit",{document:s.item_id}),children:"Edit Document"}),(c==="editor"||c==="admin")&&e.jsxs(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(a?"viewDocumentReview":"createDocumentReview")},children:[a?"View":"Start"," Review Process"]}),(c==="editor"||c==="admin")&&e.jsxs(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(n?"viewDocumentApproval":"createDocumentApproval")},children:[n?"View":"Start"," Approval Process"]}),e.jsx(S,{variant:"subtle",component:"a",href:route("document.view",{document:s.item_id}),target:"_blank",color:"blue.5",leftSection:e.jsx(pe,{size:18}),justify:"left",fullWidth:!0,children:"View Document"}),(c==="editor"||c==="admin")&&e.jsx(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(ie,{size:18}),fullWidth:!0,justify:"left",onClick:()=>o("shareDocument"),children:"Share Document"})]})})]}),e.jsx(ve,{document:s}),e.jsx(_e,{document:s}),e.jsx(xe,{document:s}),e.jsx(Ce,{document:s}),e.jsx(Ae,{documentId:s.item_id})]})};export{es as default};
