import{W as k,n as w,b as x,j as e,M as A,Y as T,y as I}from"./app-DlxKuYZb.js";import{Y as E}from"./index-DTmPIedb.js";import{u as R,A as F}from"./Authenticated-DheR4sxi.js";import{u as O,a as G}from"./use-search-datatable-C6g5kSM5.js";import{I as z,u as B}from"./use-generate-report-mCtMMqeC.js";import{S as v}from"./Stack-L1pcLF8o.js";import{T as D,F as Y}from"./OfficeLogo-DbkgrjPw.js";import{C as q}from"./Checkbox-BKToS-RO.js";import{G as f,d as H}from"./NotificationMenu-Ce37Wr51.js";import{B as j}from"./Button-Dfv1i1zu.js";import{S as L}from"./StateBadge-DcKDHK1I.js";import{u as N}from"./use-document-properties-CGQbzGyn.js";import{S as V}from"./Select-nPdKmNfd.js";import{D as W}from"./DatePickerInput-CSXbxaM7.js";import{I as $}from"./IconDownload-B8tpnwxA.js";import"./Popover-DtfI_0xr.js";import"./use-uncontrolled-CAowUEhF.js";import"./IconUser-Une0tFzg.js";import"./TextInput-RGh6OL0q.js";import"./InputBase-Dv4EAKYT.js";import"./get-sorted-breakpoints-D-XbkWVB.js";import"./CheckIcon-Cer5X6RL.js";import"./Badge-B2L46iXP.js";import"./Combobox-BF7Om7To.js";function J({folderId:n,closeModal:o}){const{data:d,setData:p,post:l,processing:r,errors:i,reset:a}=k({metadata_ids:[]});return{data:d,setData:p,handleSubmit:()=>{l(route("dashboard.selectMetadataColumn",n),{onSuccess:()=>{w.show({title:"Success",message:"Metadata columns updated successfully",color:"green"}),o(),a()},onError:()=>{w.show({title:"Error",message:"Failed to update metadata columns",color:"red"})}})},processing:r,errors:i}}const K=({folderId:n,availableMetadata:o,existingMetadataIds:d})=>{const{modals:p,closeModal:l}=R(),r=p.selectDashboardMetadataColumns,{data:i,setData:a,handleSubmit:h,processing:S,errors:g}=J({folderId:n,closeModal:()=>l("selectDashboardMetadataColumns")});x.useEffect(()=>{a("metadata_ids",d)},[d]);const C=s=>{const u=i.metadata_ids;u.includes(s)?a("metadata_ids",u.filter(_=>_!==s)):a("metadata_ids",[...u,s])};return e.jsx(A,{opened:r,onClose:()=>l("selectDashboardMetadataColumns"),title:"Select Metadata Columns",children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),h()},children:e.jsxs(v,{children:[e.jsx(D,{children:"Select the metadata columns you want to display in the dashboard report:"}),o.map(s=>e.jsx(q,{label:s.name,checked:i.metadata_ids.includes(s.id),onChange:()=>C(s.id)},s.id)),g.metadata_ids&&e.jsx(D,{c:"red",children:g.metadata_ids}),e.jsxs(f,{gap:"md",mt:"md",children:[e.jsx(j,{variant:"outline",onClick:()=>l("selectDashboardMetadataColumns"),children:"Cancel"}),e.jsx(j,{type:"submit",loading:S,children:"Save"})]})]})})})};function Se({documents:n,filters:o,selectedMetadata:d,availableMetadata:p,existingMetadataIds:l}){const[r,i]=x.useState(o.document_status),[a,h]=x.useState([o.start_date?new Date(o.start_date):null,o.end_date?new Date(o.end_date):null]),{openDocument:S}=N();O("","/dashboard/reports");const{page:g,setPage:C,handlePageChange:s}=G(n.current_page),{generateDashboardReport:u}=B(),{openModal:_}=R(),y=()=>{const t={};r&&(t.document_status=r),a[0]&&a[1]&&(t.start_date=a[0].toISOString().split("T")[0],t.end_date=a[1].toISOString().split("T")[0]),I.get("/dashboard/reports",t,{replace:!0,preserveState:!0})};x.useEffect(()=>{y()},[r,a]);const M=()=>{const t={document_status:r,start_date:a[0]?a[0].toISOString().split("T")[0]:null,end_date:a[1]?a[1].toISOString().split("T")[0]:null,metadata_ids:l};u(t)};return e.jsxs(F,{children:[e.jsx(T,{title:"Dashboard Report"}),e.jsxs(v,{px:8,gap:24,py:8,children:[e.jsx(f,{children:e.jsx(D,{component:"h2",size:"xl",fw:600,c:"gray.8",children:"Dashboard Report"})}),e.jsxs(v,{children:[e.jsxs(f,{justify:"space-between",children:[e.jsxs(Y,{gap:"md",justify:"flex-start",align:"flex-end",direction:"row",wrap:"wrap",children:[e.jsx(V,{placeholder:"Select document status",value:r,onChange:i,data:[{value:"reviewal_accepted",label:"Review Accepted"},{value:"reviewal_rejected",label:"Review Rejected"},{value:"reviewal_pending",label:"Review Pending"},{value:"approval_accepted",label:"Approval Accepted"},{value:"approval_rejected",label:"Approval Rejected"},{value:"approval_pending",label:"Approval Pending"}],style:{width:200}}),e.jsx(W,{type:"range",placeholder:"Select date range",value:a,onChange:h,style:{width:300}}),e.jsx(j,{onClick:()=>_("selectDashboardMetadataColumns"),leftSection:e.jsx(z,{size:16}),variant:"subtle",color:"dark.5",children:"Columns"})]}),e.jsx(j,{onClick:M,leftSection:e.jsx($,{size:16}),color:"blue",variant:"subtle",children:"Generate Report"})]}),e.jsx(K,{folderId:"your-folder-item-id",availableMetadata:p,existingMetadataIds:l}),e.jsx(E,{columns:[{accessor:"name",render:({mime:t,type:m,name:c,missing_required_metadata:b})=>e.jsxs(f,{align:"center",gap:12,children:[e.jsx(H,{mime:t??"",isFolder:m==="folder",missingRequiredMetadata:b}),e.jsx("span",{children:c})]})},{accessor:"updated_at",title:"Last Modified"},{accessor:"status",render:({status:t})=>e.jsx(L,{state:t})},...d.map(t=>({accessor:`metadata_${t.metadata_id}`,title:t.name,render:m=>{var b;const c=(b=m.metadata)==null?void 0:b.find(P=>P.metadata_id===t.metadata_id);return c?c.value:"N/A"}}))],records:n.data,totalRecords:n.total,recordsPerPage:n.per_page,page:g,onPageChange:()=>{},highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",customRowAttributes:({type:t,id:m})=>({onDoubleClick:c=>{c.button===0&&S(m)}})})]})]})]})}export{Se as default};
