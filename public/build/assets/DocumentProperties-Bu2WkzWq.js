import{a as z,u as oe,i as le,j as e,k as ne,W as N,n as _,M as W,b as Q,Y as ae,B as ce,P as ie,c as de}from"./app-CGxvGAM1.js";import{u as E,a as O,b as P,T as ue,A as pe,c as me}from"./Authenticated-BM-HvEcH.js";import{Y as X}from"./index-CbBGt6-f.js";import{I as he}from"./ItemBreadcrumbs-CTVVg5AY.js";import{u as L,R as M,a as ve,I as fe,b as K}from"./use-fetch-users-2fdIc2RB.js";import{T as k,F as Y}from"./OfficeLogo-Ei--AZU7.js";import{S as B}from"./Stack-ln4g7GYx.js";import{G as F,A as V,S as Z,c as ee}from"./NotificationMenu-D5SqgbTn.js";import{T as J}from"./Textarea-Ds_7vBbQ.js";import{S as q}from"./Select-BjHhz6di.js";import{B as S}from"./Button-Bl7kfwvE.js";import{c as se}from"./IconUser-CqDa0PVn.js";import{I as ge}from"./IconDownload-lhMm_WmO.js";import{G as H}from"./Grid-D7yno0zP.js";import{I as je}from"./IconEye-CXwLMOhv.js";import"./TextInput-5pqGPHQ7.js";import"./InputBase-QTu-g5X8.js";import"./Popover-CLWfF2EQ.js";import"./use-uncontrolled-BIgloZcw.js";import"./get-sorted-breakpoints-BejK4YDM.js";import"./Checkbox-BP2ZstwZ.js";import"./CheckIcon-DXgJ84kg.js";import"./Anchor-DyvbySGt.js";import"./OptionsDropdown-C5Zz8uUU.js";import"./Combobox-BABC9p8O.js";import"./get-base-value-JqT_q0U7.js";const xe={multiple:!1},te=z.forwardRef((s,a)=>{const{onChange:t,children:r,multiple:o,accept:c,name:i,form:g,resetRef:w,disabled:x,capture:R,inputProps:D,...C}=oe("FileButton",xe,s),p=z.useRef(),u=()=>{var d;!x&&((d=p.current)==null||d.click())},l=d=>{t(o?Array.from(d.currentTarget.files):d.currentTarget.files[0]||null)};return le(w,()=>{p.current.value=""}),e.jsxs(e.Fragment,{children:[r({onClick:u,...C}),e.jsx("input",{style:{display:"none"},type:"file",accept:c,multiple:o,onChange:l,ref:ne(a,p),name:i,form:g,capture:R,...D})]})});te.displayName="@mantine/core/FileButton";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ue=se("outline","pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var we=se("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);function De({documentId:s,isOpen:a}){const[t,r]=z.useState("approval"),{closeModal:o,modals:c}=E(),i=L(t,a),{data:g,setData:w,post:x,processing:R,errors:D,reset:C}=N({document_id:"",resolution:"",destination:"",type:"approval",users:[]}),[p,u]=z.useState([]),l=i.length;z.useEffect(()=>{a&&u([])},[t,i,a]);const b=j=>{j.preventDefault();const y=p.map(n=>parseInt(n.selectedUser)).filter(n=>!isNaN(n));g.document_id=s??"",g.users=y.map(n=>({user_id:n.toString()})),x(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentApproval"),_.show({message:"Document approval process created",color:"green"})},onError:()=>{_.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},d=()=>{p.length<l&&u([...p,{selectedUser:""}])},A=()=>{const j=p.map(m=>m.selectedUser),n=i.filter(m=>!j.includes(m.id.toString())).map(m=>({selectedUser:m.id.toString()}));u([...p,...n])},v=j=>{const y=[...p];y.splice(j,1),u(y)},f=(j,y)=>{const n=[...p];n[j].selectedUser=y||"",u(n)},I=p.map(j=>j.selectedUser).filter(j=>j!=="");return{data:g,setData:w,createApprovalSubmit:b,processing:R,errors:D,users:p,setDocumentApprovalType:r,addUser:d,removeUser:v,handleUserChange:f,addAllUsers:A,maxUsers:l,selectedUserIds:I,fetchedUsers:i}}const be=({document:s})=>{const{modals:a,closeModal:t}=E(),r=a.createDocumentApproval,{data:o,setData:c,createApprovalSubmit:i,processing:g,errors:w,users:x,setDocumentApprovalType:R,addUser:D,removeUser:C,handleUserChange:p,addAllUsers:u,maxUsers:l,selectedUserIds:b,fetchedUsers:d}=De({documentId:s==null?void 0:s.item_id,isOpen:r}),A=v=>d.filter(f=>!b.includes(f.id.toString())||f.id.toString()===x[v].selectedUser).map(f=>({value:f.id.toString(),label:`${f.name} (${f.email})`}));return e.jsx(W,{opened:a.createDocumentApproval,onClose:()=>t("createDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:i,children:[e.jsxs(B,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:v=>{c("type",v),R(v)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:v=>c("resolution",v.target.value),error:w.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),x.map((v,f)=>e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(q,{placeholder:"Select a user",data:A(f),value:v.selectedUser,onChange:I=>p(f,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(V,{color:"red",onClick:()=>C(f),title:"Remove User",children:e.jsx(O,{size:18})})]},f)),e.jsxs(F,{children:[x.length<l&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:D,disabled:x.length>=l,children:"Add User"}),b.length<l&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:x.length>=l,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>t("createDocumentApproval"),children:"Cancel"}),e.jsx(S,{ml:12,type:"submit",loading:g,children:"Create"})]})]})})};function re({documentApprovalId:s,isOpen:a}){const[t,r]=z.useState(null);z.useEffect(()=>{s&&a&&o(s)},[s,a]);const o=async c=>{try{const i=await Q.get(`/document_approval/${c}/update`);r(i.data)}catch(i){console.error("Error fetching document approval",i)}};return t}function Ae({documentApprovalId:s,isOpen:a}){const[t,r]=z.useState(""),o=re({documentApprovalId:s,isOpen:a}),c=L(t,a),{closeModal:i}=E(),{data:g,setData:w,put:x,processing:R,errors:D,reset:C,clearErrors:p}=N({resolution:"",type:"",users:[]}),[u,l]=z.useState([]),b=c.length;z.useEffect(()=>{o&&(r(o.type),l((o.document_user_approvals||[]).map(n=>({selectedUser:n.user_id.toString()}))),w({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(n=>({user_id:n.user_id}))}))},[o,a,t]),z.useEffect(()=>{a||l([])},[t]);const d=()=>{i("viewDocumentApproval"),C(),p()},A=n=>{n.preventDefault(),g.users=u.map(m=>parseInt(m.selectedUser)).filter(m=>!isNaN(m)).map(m=>({user_id:m.toString()})),x(route("document_approvals.update",s),{onSuccess:()=>{d(),_.show({message:"Document approval updated successfully",color:"green"})},onError:()=>{_.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},v=()=>{u.length<b&&l([...u,{selectedUser:""}])},f=()=>{const n=u.map(U=>U.selectedUser),h=c.filter(U=>!n.includes(U.id.toString())).map(U=>({selectedUser:U.id.toString()}));l([...u,...h])},I=n=>{const m=[...u];m.splice(n,1),l(m)},j=(n,m)=>{const h=[...u];h[n].selectedUser=m||"",l(h)},y=u.map(n=>n.selectedUser).filter(n=>n!=="");return{data:g,setData:w,handleUpdateDocumentApproval:A,processing:R,errors:D,handleClose:d,users:u,documentApproval:o,setDocumentApprovalType:r,addUser:v,removeUser:I,handleUserChange:j,addAllUsers:f,maxUsers:b,selectedUserIds:y,fetchedUsers:c}}function Se({documentApprovalId:s,onDeleteSuccess:a}){const{delete:t,processing:r}=N();return{handleDeleteDocumentApproval:()=>{if(!s){_.show({message:"Document Approval ID is missing.",color:"red"});return}t(route("document_approvals.cancel",s),{onSuccess:()=>{_.show({message:"Document Approval deleted successfully.",color:"green"}),a()},onError:c=>{let i="Failed to delete document approval.";c&&Object.keys(c).length>0&&(i=c[Object.keys(c)[0]]),_.show({message:i,color:"red"})}})},processing:r}}const ye=({documentApprovalId:s})=>{const{modals:a,closeModal:t,openModal:r}=E(),o=a.confirmDeleteDocumentApproval,{handleDeleteDocumentApproval:c,processing:i}=Se({documentApprovalId:s,onDeleteSuccess:()=>{t("confirmDeleteDocumentApproval"),t("viewDocumentApproval")}});return e.jsxs(W,{opened:o,onClose:()=>t("confirmDeleteDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(k,{c:"gray.8",children:"Are you sure you want to cancel this document approval? This action cannot be undone."}),e.jsxs(Y,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>{t("confirmDeleteDocumentApproval"),r("viewDocumentApproval")},children:"Cancel"}),e.jsx(S,{color:"red",ml:12,onClick:c,loading:i,children:"Delete"})]})]})},Ce=({document:s})=>{var n,m;const{modals:a,closeModal:t,openModal:r}=E(),o=a.viewDocumentApproval,c=(m=(n=s==null?void 0:s.document_approval_ids)==null?void 0:n.find(h=>h.type==="approval"))==null?void 0:m.id,{data:i,setData:g,handleUpdateDocumentApproval:w,processing:x,errors:R,users:D,setDocumentApprovalType:C,addUser:p,removeUser:u,handleUserChange:l,addAllUsers:b,documentApproval:d,maxUsers:A,selectedUserIds:v,fetchedUsers:f}=Ae({documentApprovalId:c,isOpen:o}),I=h=>f.filter(U=>!v.includes(U.id.toString())||U.id.toString()===D[h].selectedUser).map(U=>({value:U.id.toString(),label:`${U.name} (${U.email})`})),j=d==null?void 0:d.document_user_approvals.some(h=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(h.user_state)),y=d==null?void 0:d.document_user_approvals.every(h=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(h.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(W,{opened:o,onClose:()=>t("viewDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Document Approval Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:w,children:[e.jsxs(B,{gap:16,children:[e.jsx(k,{size:"sm",children:"View the document workflow process for this document"}),!j&&e.jsx(M.Group,{name:"status",value:i.type,onChange:h=>{g("type",h),C(h)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:i.resolution??"",onChange:h=>g("resolution",h.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:j}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),D.map((h,U)=>{const T=d==null?void 0:d.document_user_approvals.find(G=>G.user_id.toString()===h.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(F,{children:e.jsx(Z,{state:T==null?void 0:T.user_state})}),e.jsx(q,{placeholder:"Select a user",data:I(U),value:h.selectedUser,onChange:G=>l(U,G),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(V,{color:"red",onClick:()=>u(U),title:"Remove User",children:e.jsx(O,{size:18})})]},U)}),!y&&e.jsxs(F,{children:[D.length<A&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:p,disabled:D.length>=A,children:"Add User"}),v.length<A&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:b,disabled:D.length>=A,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>t("viewDocumentApproval"),children:y?"Close":"Cancel"}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(S,{ml:12,type:"submit",loading:x,children:"Update"}),e.jsx(V,{variant:"transparent",color:"red",onClick:()=>{t("viewDocumentApproval"),r("confirmDeleteDocumentApproval")},title:"Delete Document Approval",ml:12,children:e.jsx(O,{size:18})})]})]})]})}),e.jsx(ye,{documentApprovalId:c})]})};function Re(){const{post:s,processing:a}=N();return{restoreVersion:r=>{s(route("document.restore_version",{version:r}),{onSuccess:()=>{_.show({message:"Document version restored successfully.",color:"green"})},onError:()=>{_.show({message:"Failed to restore document version.",color:"red"})}})},processing:a}}function _e(){const{delete:s,processing:a}=N();return{deleteVersion:r=>{s(route("document.delete_version",{version:r}),{onSuccess:()=>{_.show({message:"Document version deleted successfully.",color:"green"})},onError:()=>{_.show({message:"Failed to delete document version.",color:"red"})}})},processing:a}}const ze=({versions:s})=>{const{restoreVersion:a}=Re(),{deleteVersion:t}=_e();return e.jsx(X,{columns:[{accessor:"name",title:"Name",render:({name:r,review_status:o,approval_status:c,mime:i})=>e.jsxs(F,{align:"center",gap:12,children:[e.jsx(ee,{mime:i,isFolder:!1,reviewStatus:o,approvalStatus:c}),e.jsx("span",{children:r})]})},{accessor:"uploaded_at",title:"Uploaded At"},{accessor:"actions",title:"Actions",render:r=>e.jsxs(F,{gap:4,children:[!r.current&&e.jsx(V,{variant:"subtle",onClick:()=>a(r.id),children:e.jsx(we,{size:16})}),!r.current&&e.jsx(V,{variant:"subtle",color:"red",onClick:()=>t(r.id),children:e.jsx(O,{size:16})}),e.jsx("a",{href:r.file_path,download:!0,children:e.jsx(V,{variant:"subtle",children:e.jsx(ge,{size:16})})})]})}],records:s,highlightOnHover:!0,verticalSpacing:"sm",horizontalSpacing:"sm"})};function ke(s){const{data:a,post:t,reset:r,processing:o,errors:c,clearErrors:i}=N({document_item_id:s,file:null});return{uploadVersion:w=>{if(!w){_.show({message:"No file selected.",color:"red"});return}a.file=w,t(`/document/${s}/versions`,{onSuccess:()=>{_.show({message:"Document version uploaded successfully.",color:"green"}),r()},onError:()=>{_.show({message:"Failed to upload document version.",color:"red"})},onFinish:()=>{i()}})},processing:o,errors:c}}function Fe({documentId:s,isOpen:a}){const[t,r]=z.useState([]),[o,c]=z.useState(!1),[i,g]=z.useState(null);return z.useEffect(()=>{s&&(async()=>{c(!0);try{const x=await Q.get(route("document.fetchSharedUsers",{document:s}));r(x.data),g(null)}catch(x){console.error(x),g("Failed to fetch shared users."),_.show({title:"Error",message:"Unable to fetch shared users.",color:"red"})}finally{c(!1)}})()},[s,a]),{sharedUsers:t,loading:o,error:i}}function Ie({documentId:s,close:a}){const{modals:t}=E(),r=t.shareDocument,{sharedUsers:o,loading:c,error:i}=Fe({documentId:s,isOpen:r}),{data:g,setData:w,post:x,processing:R,errors:D,reset:C}=N({users:[]});return z.useEffect(()=>{if(o.length>0){const A=o.map(v=>({email:v.email,role:v.role}));w("users",A)}},[o]),{data:g,submit:()=>{x(route("document.share",{document:s}),{onSuccess:()=>{a(),_.show({message:"Document shared successfully.",color:"green"}),C()},onError:A=>{_.show({message:"Failed to share the document.",color:"red"})}})},processing:R,errors:D,addUser:()=>{w("users",[...g.users,{email:"",role:"viewer"}])},removeUser:A=>{const v=g.users.filter((f,I)=>I!==A);w("users",v)},handleUserChange:(A,v,f)=>{const I=g.users.map((j,y)=>y===A?{...j,[v]:f}:j);w("users",I)},handleAddAllUsers:A=>{w("users",A)}}}const Ee=({documentId:s})=>{const{modals:a,closeModal:t}=E(),{users:r,loading:o,error:c}=ve(),{data:i,submit:g,processing:w,errors:x,addUser:R,removeUser:D,handleUserChange:C,handleAddAllUsers:p}=Ie({documentId:s,close:()=>t("shareDocument")}),u=()=>{const l=r.map(b=>({email:b.email,role:"viewer"}));p(l)};return e.jsx(W,{opened:a.shareDocument,onClose:()=>t("shareDocument"),title:e.jsx(k,{size:"lg",children:"Share Document"}),size:"600",children:e.jsxs("form",{onSubmit:l=>{l.preventDefault(),g()},children:[e.jsxs(B,{children:[i.users.map((l,b)=>e.jsxs(F,{align:"flex-end",children:[e.jsx(q,{data:r.map(d=>({value:d.email,label:`${d.name} (${d.email})`})),placeholder:"Select a user",value:l.email,onChange:d=>C(b,"email",d||""),style:{flex:1},required:!0}),e.jsx(q,{data:[{value:"viewer",label:"Viewer"},{value:"editor",label:"Editor"}],placeholder:"Select role",value:l.role,onChange:d=>C(b,"role",d||"viewer"),style:{width:120},required:!0}),e.jsx(ue,{label:"Remove User",withArrow:!0,children:e.jsx(V,{color:"red",onClick:()=>D(b),children:e.jsx(O,{size:18})})})]},b)),e.jsxs(F,{children:[e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:()=>R(),children:"Add User"}),e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:i.users.length>=r.length,children:"Add All Users"})]})]}),e.jsxs(F,{mt:"md",children:[e.jsx(S,{variant:"outline",onClick:()=>t("shareDocument"),children:"Cancel"}),e.jsx(S,{type:"submit",loading:w,children:"Save"})]})]})})};function Me({documentApprovalId:s,isOpen:a}){const[t,r]=z.useState(""),o=re({documentApprovalId:s,isOpen:a}),c=L(t,a),{closeModal:i}=E(),{data:g,setData:w,put:x,processing:R,errors:D,reset:C,clearErrors:p}=N({resolution:"",type:"",users:[]}),[u,l]=z.useState([]),b=c.length;z.useEffect(()=>{o&&(r(o.type),l((o.document_user_approvals||[]).map(n=>({selectedUser:n.user_id.toString()}))),w({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(n=>({user_id:n.user_id}))}))},[o,a,t]),z.useEffect(()=>{a||l([])},[t]);const d=()=>{i("viewDocumentReview"),C(),p()},A=n=>{n.preventDefault(),g.users=u.map(m=>parseInt(m.selectedUser)).filter(m=>!isNaN(m)).map(m=>({user_id:m.toString()})),x(route("document_approvals.update",s),{onSuccess:()=>{d(),_.show({message:"Document approval updated successfully",color:"green"})},onError:()=>{_.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},v=()=>{u.length<b&&l([...u,{selectedUser:""}])},f=()=>{const n=u.map(U=>U.selectedUser),h=c.filter(U=>!n.includes(U.id.toString())).map(U=>({selectedUser:U.id.toString()}));l([...u,...h])},I=n=>{const m=[...u];m.splice(n,1),l(m)},j=(n,m)=>{const h=[...u];h[n].selectedUser=m||"",l(h)},y=u.map(n=>n.selectedUser).filter(n=>n!=="");return{data:g,setData:w,handleUpdateDocumentApproval:A,processing:R,errors:D,handleClose:d,users:u,documentApproval:o,setDocumentApprovalType:r,addUser:v,removeUser:I,handleUserChange:j,addAllUsers:f,maxUsers:b,selectedUserIds:y,fetchedUsers:c}}function Te({documentReviewId:s,onDeleteSuccess:a}){const{delete:t,processing:r}=N();return{handleDeleteDocumentReview:()=>{if(!s){_.show({message:"Document Review ID is missing.",color:"red"});return}t(route("document_approvals.cancel",s),{onSuccess:()=>{_.show({message:"Document Review deleted successfully.",color:"green"}),a()},onError:c=>{let i="Failed to delete document review.";c&&Object.keys(c).length>0&&(i=c[Object.keys(c)[0]]),_.show({message:i,color:"red"})}})},processing:r}}const Ve=({documentReviewId:s})=>{const{modals:a,closeModal:t,openModal:r}=E(),o=a.confirmDeleteDocumentReview,{handleDeleteDocumentReview:c,processing:i}=Te({documentReviewId:s,onDeleteSuccess:()=>{t("confirmDeleteDocumentReview"),t("viewDocumentReview")}});return e.jsxs(W,{opened:o,onClose:()=>t("confirmDeleteDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(k,{c:"gray.8",children:"Are you sure you want to cancel this document review? This action cannot be undone."}),e.jsxs(Y,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>{t("confirmDeleteDocumentReview"),r("viewDocumentReview")},children:"Cancel"}),e.jsx(S,{color:"red",ml:12,onClick:c,loading:i,children:"Delete"})]})]})},Pe=({document:s})=>{var n,m;const{modals:a,closeModal:t,openModal:r}=E(),o=a.viewDocumentReview,c=(m=(n=s==null?void 0:s.document_approval_ids)==null?void 0:n.find(h=>h.type==="reviewal"))==null?void 0:m.id,{data:i,setData:g,handleUpdateDocumentApproval:w,processing:x,errors:R,users:D,setDocumentApprovalType:C,addUser:p,removeUser:u,handleUserChange:l,addAllUsers:b,documentApproval:d,maxUsers:A,selectedUserIds:v,fetchedUsers:f}=Me({documentApprovalId:c,isOpen:o}),I=h=>f.filter(U=>!v.includes(U.id.toString())||U.id.toString()===D[h].selectedUser).map(U=>({value:U.id.toString(),label:`${U.name} (${U.email})`})),j=d==null?void 0:d.document_user_approvals.some(h=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(h.user_state)),y=d==null?void 0:d.document_user_approvals.every(h=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(h.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(W,{opened:o,onClose:()=>t("viewDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Document Review Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:w,children:[e.jsxs(B,{gap:16,children:[e.jsx(k,{size:"sm",children:"View the document workflow process for this document"}),!j&&e.jsx(M.Group,{name:"status",value:i.type,onChange:h=>{g("type",h),C(h)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:i.resolution??"",onChange:h=>g("resolution",h.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:j}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),D.map((h,U)=>{const T=d==null?void 0:d.document_user_approvals.find(G=>G.user_id.toString()===h.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(F,{children:e.jsx(Z,{state:T==null?void 0:T.user_state})}),e.jsx(q,{placeholder:"Select a user",data:I(U),value:h.selectedUser,onChange:G=>l(U,G),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(V,{color:"red",onClick:()=>u(U),title:"Remove User",children:e.jsx(O,{size:18})})]},U)}),!y&&e.jsxs(F,{children:[D.length<A&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:p,disabled:D.length>=A,children:"Add User"}),v.length<A&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:b,disabled:D.length>=A,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>t("viewDocumentReview"),children:y?"Close":"Cancel"}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(S,{ml:12,type:"submit",loading:x,children:"Update"}),e.jsx(V,{variant:"transparent",color:"red",onClick:()=>{t("viewDocumentReview"),r("confirmDeleteDocumentReview")},title:"Delete Document Approval",ml:12,children:e.jsx(O,{size:18})})]})]})]})}),e.jsx(Ve,{documentReviewId:c})]})};function Ne({documentId:s,isOpen:a}){const[t,r]=z.useState("reviewal"),{closeModal:o,modals:c}=E(),i=L(t,a),{data:g,setData:w,post:x,processing:R,errors:D,reset:C}=N({document_id:"",resolution:"",destination:"",type:"reviewal",users:[]}),[p,u]=z.useState([]),l=i.length;z.useEffect(()=>{a&&u([])},[t,i,a]);const b=j=>{j.preventDefault();const y=p.map(n=>parseInt(n.selectedUser)).filter(n=>!isNaN(n));g.document_id=s??"",g.users=y.map(n=>({user_id:n.toString()})),x(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentReview"),_.show({message:"Document review process created",color:"green"})},onError:()=>{_.show({message:"Something went wrong",color:"red"})},onFinish:()=>C()})},d=()=>{p.length<l&&u([...p,{selectedUser:""}])},A=()=>{const j=p.map(m=>m.selectedUser),n=i.filter(m=>!j.includes(m.id.toString())).map(m=>({selectedUser:m.id.toString()}));u([...p,...n])},v=j=>{const y=[...p];y.splice(j,1),u(y)},f=(j,y)=>{const n=[...p];n[j].selectedUser=y||"",u(n)},I=p.map(j=>j.selectedUser).filter(j=>j!=="");return{data:g,setData:w,createApprovalSubmit:b,processing:R,errors:D,users:p,setDocumentApprovalType:r,addUser:d,removeUser:v,handleUserChange:f,addAllUsers:A,maxUsers:l,selectedUserIds:I,fetchedUsers:i}}const $e=({document:s})=>{const{modals:a,closeModal:t}=E(),r=a.createDocumentReview,{data:o,setData:c,createApprovalSubmit:i,processing:g,errors:w,users:x,setDocumentApprovalType:R,addUser:D,removeUser:C,handleUserChange:p,addAllUsers:u,maxUsers:l,selectedUserIds:b,fetchedUsers:d}=Ne({documentId:s==null?void 0:s.item_id,isOpen:r}),A=v=>d.filter(f=>!b.includes(f.id.toString())||f.id.toString()===x[v].selectedUser).map(f=>({value:f.id.toString(),label:`${f.name} (${f.email})`}));return e.jsx(W,{opened:a.createDocumentReview,onClose:()=>t("createDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:i,children:[e.jsxs(B,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:v=>{c("type",v),R(v)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:v=>c("resolution",v.target.value),error:w.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),x.map((v,f)=>e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(q,{placeholder:"Select a user",data:A(f),value:v.selectedUser,onChange:I=>p(f,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(V,{color:"red",onClick:()=>C(f),title:"Remove User",children:e.jsx(O,{size:18})})]},f)),e.jsxs(F,{children:[x.length<l&&e.jsx(S,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:D,disabled:x.length>=l,children:"Add User"}),b.length<l&&e.jsx(S,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:x.length>=l,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(S,{variant:"light",onClick:()=>t("createDocumentReview"),children:"Cancel"}),e.jsx(S,{ml:12,type:"submit",loading:g,children:"Create"})]})]})})},ms=({document:s,itemAncestors:a,activityLog:t,userRole:r})=>{var p,u;const{openModal:o}=E(),{uploadVersion:c,processing:i,errors:g}=ke(s.item_id),w=l=>{l&&c(l)},x=(p=s.document_approval_ids)==null?void 0:p.some(l=>l.type==="reviewal"),R=(u=s.document_approval_ids)==null?void 0:u.some(l=>l.type==="approval"),C=[...[{name:"Document ID",value:s.item_id},{name:"Date",value:s.created_at},{name:"Document Number",value:s.document_number}],...s.metadata.map(l=>({name:l.name,value:l.value||"N/A"}))];return console.log(s),e.jsxs(pe,{children:[e.jsx(ae,{title:"Document Properties"}),e.jsx(ce,{px:8,py:8,mb:48,children:e.jsx(he,{ancestors:a})}),e.jsxs(H,{children:[e.jsx(H.Col,{span:8,children:e.jsxs(B,{px:8,py:8,gap:48,mb:48,children:[e.jsxs(F,{children:[e.jsx(ee,{mime:s.mime,isFolder:!1,reviewStatus:s.review_status,approvalStatus:s.approval_status}),e.jsx(k,{fw:500,children:s.name})]}),e.jsx(B,{gap:12,mt:24,children:C.length>0?e.jsx(H,{gutter:"lg",children:C.map((l,b)=>e.jsx(H.Col,{span:4,children:e.jsxs(B,{gap:4,children:[e.jsx(k,{size:"sm",fw:"bold",children:l.name}),e.jsx(k,{size:"sm",children:l.value})]})},`${l.name}-${b}`))}):e.jsx(k,{size:"sm",c:"dimmed",children:"No metadata available."})}),e.jsxs(B,{gap:12,children:[s.versions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",fw:"bold",children:"Document Versions"}),e.jsx(ze,{versions:s.versions})]}),e.jsx(k,{size:"sm",fw:"bold",children:"Audit Log"}),e.jsx(X,{textSelectionDisabled:!0,columns:[{accessor:"date"},{accessor:"time"},{accessor:"user_name",title:"User"},{accessor:"description",title:"Action"}],records:t,highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",withTableBorder:!0})]})]})}),e.jsx(H.Col,{span:3,offset:1,children:e.jsxs(ie,{withBorder:!0,p:20,children:[e.jsx(k,{c:"dimmed",fw:500,children:"Options"}),(r==="editor"||r==="admin")&&e.jsx(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(Ue,{size:18}),fullWidth:!0,justify:"left",component:de,href:route("document.edit",{document:s.item_id}),children:"Edit Document"}),(r==="editor"||r==="admin")&&e.jsx(te,{onChange:w,children:l=>e.jsx(S,{...l,variant:"subtle",color:"blue.5",fullWidth:!0,justify:"left",leftSection:e.jsx(fe,{size:18}),children:"Upload New Version"})}),(r==="editor"||r==="admin")&&e.jsxs(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(x?"viewDocumentReview":"createDocumentReview")},children:[x?"View":"Start"," Review Process"]}),(r==="editor"||r==="admin")&&e.jsxs(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(R?"viewDocumentApproval":"createDocumentApproval")},children:[R?"View":"Start"," Approval Process"]}),e.jsx(S,{variant:"subtle",component:"a",href:route("document.view",{document:s.item_id}),target:"_blank",color:"blue.5",leftSection:e.jsx(je,{size:18}),justify:"left",fullWidth:!0,children:"View Document"}),(r==="editor"||r==="admin")&&e.jsx(S,{variant:"subtle",color:"blue.5",leftSection:e.jsx(me,{size:18}),fullWidth:!0,justify:"left",onClick:()=>o("shareDocument"),children:"Share Document"})]})})]}),e.jsx(be,{document:s}),e.jsx($e,{document:s}),e.jsx(Ce,{document:s}),e.jsx(Pe,{document:s}),e.jsx(Ee,{documentId:s.item_id})]})};export{ms as default};
