import{W as P,n as w,b as x,j as e,M as k,Y as A,y as T}from"./app-BdnCQMoe.js";import{Y as I}from"./index-DtTnDeLb.js";import{u as M,A as E}from"./Authenticated-DH2cwoVh.js";import{u as F,a as O}from"./use-search-datatable-B30vNIXT.js";import{u as G}from"./use-generate-report-D68GU4F7.js";import{S as v}from"./Stack-DTzhMRPj.js";import{T as C}from"./Text-B1KWDhCO.js";import{C as z}from"./Checkbox-Ciq8ToDf.js";import{G as m}from"./NotificationMenu-zO2EsVKT.js";import{B as f}from"./Button-CqGaw41V.js";import{I as B}from"./ItemIcon-FRB3J8PR.js";import{S as Y}from"./StateBadge-B1bLEzJT.js";import{F as q}from"./OfficeLogo-C-QaVwdo.js";import{S as H}from"./Select-DBv8bKKJ.js";import{D as L}from"./DatePickerInput-CmD7qgCX.js";import{I as N}from"./IconDownload-gF0nLkwd.js";import"./Popover-N4Nux1XS.js";import"./use-uncontrolled-Dhv18aeG.js";import"./IconUser-BZcs3Nkz.js";import"./ScrollArea-BOCx1bjH.js";import"./TextInput-B5mc4Cd-.js";import"./InputBase-CSJvsNpD.js";import"./get-sorted-breakpoints-CxWlsomb.js";import"./CheckIcon-Dt_iJxQy.js";import"./get-color-status-CoUPVVuO.js";import"./IconPhoto-Cd6s1-S4.js";import"./Badge-CK2IGSnF.js";import"./Combobox-Cj0Cek5w.js";function V({folderId:n,closeModal:s}){const{data:l,setData:c,post:d,processing:o,errors:i,reset:a}=P({metadata_ids:[]});return{data:l,setData:c,handleSubmit:()=>{d(route("dashboard.selectMetadataColumn",n),{onSuccess:()=>{w.show({title:"Success",message:"Metadata columns updated successfully",color:"green"}),s(),a()},onError:()=>{w.show({title:"Error",message:"Failed to update metadata columns",color:"red"})}})},processing:o,errors:i}}const W=({folderId:n,availableMetadata:s,existingMetadataIds:l})=>{const{modals:c,closeModal:d}=M(),o=c.selectDashboardMetadataColumns,{data:i,setData:a,handleSubmit:u,processing:j,errors:S}=V({folderId:n,closeModal:()=>d("selectDashboardMetadataColumns")});x.useEffect(()=>{a("metadata_ids",l)},[l]);const D=r=>{const p=i.metadata_ids;p.includes(r)?a("metadata_ids",p.filter(b=>b!==r)):a("metadata_ids",[...p,r])};return e.jsx(k,{opened:o,onClose:()=>d("selectDashboardMetadataColumns"),title:"Select Metadata Columns",children:e.jsx("form",{onSubmit:r=>{r.preventDefault(),u()},children:e.jsxs(v,{children:[e.jsx(C,{children:"Select the metadata columns you want to display in the dashboard report:"}),s.map(r=>e.jsx(z,{label:r.name,checked:i.metadata_ids.includes(r.id),onChange:()=>D(r.id)},r.id)),S.metadata_ids&&e.jsx(C,{c:"red",children:S.metadata_ids}),e.jsxs(m,{gap:"md",mt:"md",children:[e.jsx(f,{variant:"outline",onClick:()=>d("selectDashboardMetadataColumns"),children:"Cancel"}),e.jsx(f,{type:"submit",loading:j,children:"Save"})]})]})})})};function _e({documents:n,filters:s,selectedMetadata:l,availableMetadata:c,existingMetadataIds:d}){const[o,i]=x.useState(s.document_status),[a,u]=x.useState([s.start_date?new Date(s.start_date):null,s.end_date?new Date(s.end_date):null]);F("","/dashboard/reports");const{page:j,setPage:S,handlePageChange:D}=O(n.current_page),{generateDashboardReport:r}=G(),{openModal:p}=M(),b=()=>{const t={};o&&(t.document_status=o),a[0]&&a[1]&&(t.start_date=a[0].toISOString().split("T")[0],t.end_date=a[1].toISOString().split("T")[0]),T.get("/dashboard/reports",t,{replace:!0,preserveState:!0})};x.useEffect(()=>{b()},[o,a]);const R=()=>{const t={document_status:o,start_date:a[0]?a[0].toISOString().split("T")[0]:null,end_date:a[1]?a[1].toISOString().split("T")[0]:null,metadata_ids:d};r(t)};return e.jsxs(E,{children:[e.jsx(A,{title:"Dashboard Report"}),e.jsxs(v,{px:8,gap:24,py:8,children:[e.jsx(m,{children:e.jsx(C,{component:"h2",size:"xl",fw:600,c:"gray.8",children:"Dashboard Report"})}),e.jsxs(v,{children:[e.jsxs(m,{justify:"space-between",children:[e.jsxs(q,{gap:"md",justify:"flex-start",align:"flex-end",direction:"row",wrap:"wrap",children:[e.jsx(H,{placeholder:"Select document status",value:o,onChange:i,data:[{value:"reviewal_accepted",label:"Review Accepted"},{value:"reviewal_rejected",label:"Review Rejected"},{value:"reviewal_pending",label:"Review Pending"},{value:"approval_accepted",label:"Approval Accepted"},{value:"approval_rejected",label:"Approval Rejected"},{value:"approval_pending",label:"Approval Pending"}],style:{width:200}}),e.jsx(L,{type:"range",placeholder:"Select date range",value:a,onChange:u,style:{width:300}})]}),e.jsx(f,{onClick:R,leftSection:e.jsx(N,{size:16}),color:"green",children:"Generate Report"})]}),e.jsx(m,{children:e.jsx(f,{onClick:()=>p("selectDashboardMetadataColumns"),children:"Select Metadata Columns"})}),e.jsx(W,{folderId:"your-folder-item-id",availableMetadata:c,existingMetadataIds:d}),e.jsx(I,{columns:[{accessor:"name",render:({mime:t,type:_,name:h,missing_required_metadata:g})=>e.jsxs(m,{align:"center",gap:12,children:[e.jsx(B,{mime:t??"",isFolder:_==="folder",missingRequiredMetadata:g}),e.jsx("span",{children:h})]})},{accessor:"updated_at",title:"Last Modified"},{accessor:"status",render:({status:t})=>e.jsx(Y,{state:t})},...l.map(t=>({accessor:`metadata_${t.metadata_id}`,title:t.name,render:_=>{var g;const h=(g=_.metadata)==null?void 0:g.find(y=>y.metadata_id===t.metadata_id);return h?h.value:"N/A"}}))],records:n.data,totalRecords:n.total,recordsPerPage:n.per_page,page:j,onPageChange:()=>{},highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl"})]})]})]})}export{_e as default};
