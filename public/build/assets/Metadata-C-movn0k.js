import{W as w,n as C,j as e,M as D,a as _,Y as B,r as z,B as I}from"./app-CGxvGAM1.js";import{b as P,a as T,u as R,A as F,I as V}from"./Authenticated-BM-HvEcH.js";import{T as j,F as y}from"./OfficeLogo-Ei--AZU7.js";import{S as M}from"./Stack-ln4g7GYx.js";import{T as S}from"./TextInput-5pqGPHQ7.js";import{S as k}from"./Select-BjHhz6di.js";import{B as m}from"./Button-Bl7kfwvE.js";import{G as E,A as b}from"./NotificationMenu-D5SqgbTn.js";import{u as N,a as O}from"./use-search-datatable-CkHI4L8G.js";import{Y as W}from"./index-CbBGt6-f.js";import{I as Y}from"./IconEdit-CrOlNA0d.js";import"./Popover-CLWfF2EQ.js";import"./use-uncontrolled-BIgloZcw.js";import"./IconUser-CqDa0PVn.js";import"./get-sorted-breakpoints-BejK4YDM.js";import"./InputBase-QTu-g5X8.js";import"./OptionsDropdown-C5Zz8uUU.js";import"./CheckIcon-DXgJ84kg.js";import"./Combobox-BABC9p8O.js";import"./Checkbox-BP2ZstwZ.js";function G({close:a}){const{data:r,setData:s,post:t,processing:n,errors:c,reset:o,clearErrors:h}=w({name:"",type:""}),p=()=>{a(),o(),h()};return{data:r,setData:s,handleCreateMetadata:f=>{f.preventDefault(),t(route("metadata.store"),{onSuccess:()=>{p(),C.show({message:"New metadata added successfully",color:"green"})},onFinish:()=>o()})},processing:n,errors:c,handleClose:p}}const H=({isOpened:a,close:r})=>{const{data:s,setData:t,handleCreateMetadata:n,processing:c,errors:o,handleClose:h}=G({close:r});return e.jsx(D,{opened:a,onClose:r,title:e.jsx(j,{size:"lg",children:"Create Metadata"}),size:550,children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(M,{gap:16,children:[e.jsx(S,{id:"name",type:"text",name:"name",value:s.name,label:"Name",onChange:p=>t("name",p.target.value),error:o.name}),e.jsx(k,{label:"Type",placeholder:"Choose Type",value:s.type,onChange:(p,u)=>t("type",u.value),error:o.type,data:["String","Boolean","Datetime"]})]}),e.jsxs(y,{align:"center",justify:"end",mt:16,children:[e.jsx(m,{variant:"outline",onClick:h,children:"Cancel"}),e.jsx(m,{ml:12,type:"submit",loading:c,children:"Save"})]})]})})};function U({metadata:a,close:r}){const{data:s,setData:t,patch:n,processing:c,errors:o,reset:h}=w({name:"",type:"",predefined_values:[]});return _.useEffect(()=>{a&&t({name:a.name,type:a.type,predefined_values:a.predefined_values.map(u=>({id:u.id,predefined_value:u.predefined_value}))})},[a]),{data:s,setData:t,handleEdit:u=>{var d;u.preventDefault();const f=(d=s.predefined_values)==null?void 0:d.filter(i=>i.predefined_value.trim()!=="").map(i=>i.predefined_value.trim());n(route("metadata.update",a==null?void 0:a.metadata_id),{data:{name:s.name,type:s.type,predefined_values:f},onSuccess:()=>{r(),C.show({message:"Metadata edited successfully",color:"green"})}})},processing:c,errors:o}}const q=({isOpened:a,close:r,metadata:s})=>{const{data:t,setData:n,handleEdit:c,processing:o,errors:h}=U({metadata:s,close:r}),p=()=>{n("predefined_values",[...t.predefined_values||[],{id:Date.now(),predefined_value:""}])},u=d=>{var i;n("predefined_values",(i=t.predefined_values)==null?void 0:i.filter(g=>g.id!==d))},f=(d,i)=>{var x;const g=(x=t.predefined_values)==null?void 0:x.map(v=>v.id===d?{...v,predefined_value:i}:v);n("predefined_values",g)};return e.jsx(D,{opened:a,onClose:r,title:e.jsx(j,{size:"lg",children:"Edit Metadata"}),size:550,children:e.jsxs("form",{onSubmit:c,children:[e.jsxs(M,{gap:16,children:[e.jsx(S,{id:"name",type:"text",name:"name",value:t.name,label:"Name",onChange:d=>n("name",d.target.value),error:h.name}),e.jsx(k,{label:"Type",placeholder:"Choose Type",value:t.type,onChange:(d,i)=>n("type",i.value),error:h.type,data:["String","Boolean","Datetime"]}),e.jsxs(M,{children:[e.jsxs(y,{justify:"space-between",align:"center",children:[e.jsx(j,{size:"sm",fw:500,children:"Predefined Values"}),e.jsx(m,{variant:"light",leftSection:e.jsx(P,{size:14}),onClick:p,children:"Add Predefined Value"})]}),t.predefined_values&&t.predefined_values.map(d=>e.jsxs(E,{justify:"space-between",align:"flex-end",children:[e.jsx(S,{placeholder:"Predefined value",value:d.predefined_value,onChange:i=>f(d.id,i.target.value),required:!0,style:{flex:1}}),e.jsx(b,{color:"red",onClick:()=>u(d.id),children:e.jsx(T,{size:16})})]},d.id))]})]}),e.jsxs(y,{align:"center",justify:"end",mt:16,children:[e.jsx(m,{variant:"outline",onClick:r,children:"Cancel"}),e.jsx(m,{ml:12,type:"submit",loading:o,children:"Save"})]})]})})};function L({metadata:a,close:r}){const{processing:s,delete:t,reset:n}=w();return{handleDelete:o=>{o.preventDefault(),t(route("metadata.destroy",a==null?void 0:a.metadata_id),{onSuccess:()=>{r(),C.show({message:"Metadata deleted successfully",color:"red"})},onError:()=>{r(),C.show({message:"Something went wrong",color:"red"})},onFinish:()=>n()})},processing:s}}const J=({isOpened:a,close:r,metadata:s})=>{const{handleDelete:t,processing:n}=L({metadata:s,close:r});return e.jsx(D,{opened:a,onClose:r,title:e.jsx(j,{size:"lg",children:"Delete Metadata"}),size:550,children:e.jsxs("form",{onSubmit:t,children:[e.jsxs(j,{c:"dimmed",mt:4,size:"sm",children:["Delete this metadata ",s==null?void 0:s.name,"?"]}),e.jsxs(y,{align:"center",justify:"end",mt:16,children:[e.jsx(m,{variant:"subtle",color:"gray",onClick:r,children:"Cancel"}),e.jsx(m,{ml:12,type:"submit",loading:n,color:"red",children:"Confirm Delete"})]})]})})};function fe({metadata:a,filters:r}){const[s,t]=_.useState([]),[n,c]=_.useState(),{search:o,setSearch:h,handleSearch:p}=N(r.search||"","/metadata"),{page:u,setPage:f,handlePageChange:d}=O(a.current_page),{modals:i,openModal:g,closeModal:x}=R(),v=l=>{c(l),g("editMetadata")},A=l=>{c(l),g("deleteMetadata")};return e.jsxs(F,{children:[e.jsx(B,{title:"Metadata"}),e.jsxs(M,{px:8,py:8,gap:24,children:[e.jsx(j,{component:"h2",size:"xl",fw:600,c:"gray.8",children:"Tags"}),e.jsxs(y,{justify:"space-between",direction:{base:"column",md:"row"},gap:{base:12,md:0},children:[e.jsx(S,{w:{md:400},placeholder:"Search",leftSection:e.jsx(V,{style:{width:z(16),height:z(16)},stroke:1.5}),value:o,onChange:l=>{h(l.target.value),p(l.target.value)}}),e.jsx(m,{leftSection:e.jsx(P,{size:14}),onClick:()=>g("addMetadata"),children:"Add New Metadata"})]}),e.jsx(W,{pinLastColumn:!0,withTableBorder:!0,shadow:"xs",minHeight:"50vh",borderRadius:"sm",withRowBorders:!1,highlightOnHover:!0,verticalSpacing:"md",totalRecords:a.total,recordsPerPage:a.per_page,page:u,onPageChange:l=>{f(l),d(l,a.links)},columns:[{accessor:"name",noWrap:!0},{accessor:"type",noWrap:!0},{accessor:"actions",title:e.jsx(I,{mr:6,children:"Actions"}),textAlign:"right",render:l=>e.jsxs(E,{gap:8,justify:"right",wrap:"nowrap",children:[e.jsx(b,{size:"sm",variant:"subtle",color:"gray",onClick:()=>v(l),children:e.jsx(Y,{size:48})}),e.jsx(b,{size:"sm",variant:"subtle",color:"red",onClick:()=>A(l),children:e.jsx(T,{size:48})})]})}],records:a.data,selectedRecords:s,onSelectedRecordsChange:t})]}),e.jsx(H,{isOpened:i.addMetadata,close:()=>x("addMetadata")}),e.jsx(q,{isOpened:i.editMetadata,close:()=>x("editMetadata"),metadata:n}),e.jsx(J,{isOpened:i.deleteMetadata,close:()=>x("deleteMetadata"),metadata:n})]})}export{fe as default};
