import{d as b,e as A,W as E,n as S,j as e,M as F,P}from"./app-Be6U1Dc8.js";import{u as D,b as M,a as k}from"./Authenticated-hQH3hORN.js";import{T as g,F as I}from"./OfficeLogo-BgjFk65O.js";import{B as f}from"./Button-D9h5vimS.js";import{S as Y}from"./Stack-zxFT2Oc1.js";import{T as q}from"./TextInput-8_pOHK7P.js";import{S as O,N as U}from"./Switch-TkHE9BII.js";import{G as N}from"./NotificationMenu-DL9b0tvo.js";import{S as z}from"./Select-BTO6iZxa.js";import{A as T}from"./IconUser-BfhP9fWZ.js";function W({numberingSchemeId:t,isOpen:c}){const[n,d]=b.useState(null);b.useEffect(()=>{t&&c&&a(t)},[t,c]);const a=async s=>{try{const i=await A.get(`/numbering-scheme/${s}`);d(i.data)}catch(i){console.error("Error fetching numbering scheme",i)}};return n}function B({itemParent:t,isOpen:c}){const n=W({numberingSchemeId:t==null?void 0:t.numbering_scheme_id,isOpen:c}),{data:d,setData:a,put:s,processing:i,errors:y,reset:j}=E({name:"",prefix:"",next_number:0,reset_frequency:"none",add_if_approved:!1}),{closeModal:x}=D(),[l,m]=b.useState([]);return b.useEffect(()=>{if(n){const u=/(\{[^}]+\}|\[[^\]]+\])/g,o=n.prefix.match(u),h=[];o&&o.forEach(p=>{p.startsWith("{")&&p.endsWith("}")?h.push({id:Date.now()+Math.random(),type:"text",value:p.slice(1,-1)}):p.startsWith("[")&&p.endsWith("]")&&h.push({id:Date.now()+Math.random(),type:"dynamic",value:p.slice(1,-1)})}),m(h),a({name:n.name||"",prefix:n.prefix||"",next_number:n.next_number||0,reset_frequency:n.reset_frequency||"none",add_if_approved:n.add_if_approved||!1})}},[n]),b.useEffect(()=>{const u=l.map(o=>o.type==="text"?`{${o.value}}`:`[${o.value}]`).join(" ");a("prefix",u)},[l]),{data:d,setData:a,handleSubmit:u=>{u.preventDefault(),s(route("numbering-scheme.update",t==null?void 0:t.numbering_scheme_id),{onSuccess:()=>{x("updateNumberingScheme"),S.show({position:"top-center",message:"Numbering scheme updated successfully",color:"green"})},onError:()=>{S.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>j()})},processing:i,errors:y,prefixParts:l,addTextPart:()=>{m([...l,{id:Date.now(),type:"text",value:""}])},addDynamicPart:()=>{m([...l,{id:Date.now(),type:"dynamic",value:""}])},updatePart:(u,o)=>{m(l.map(h=>h.id===u?{...h,value:o}:h))},removePart:u=>{m(l.filter(o=>o.id!==u))}}}function $({numberingSchemeId:t,onDeleteSuccess:c}){const{delete:n,processing:d}=E();return{handleDeleteNumberingScheme:()=>{if(!t){S.show({position:"top-center",message:"Numbering Scheme ID is missing.",color:"red"});return}n(route("numbering-scheme.destroy",t),{onSuccess:()=>{S.show({position:"top-center",message:"Numbering Scheme deleted successfully.",color:"green"}),c()},onError:s=>{let i="Failed to delete numbering scheme.";s&&Object.keys(s).length>0&&(i=s[Object.keys(s)[0]]),S.show({position:"top-center",message:i,color:"red"})}})},processing:d}}const G=({numberingSchemeId:t})=>{const{modals:c,closeModal:n,openModal:d}=D(),a=c.confirmDeleteNumberingScheme,{handleDeleteNumberingScheme:s,processing:i}=$({numberingSchemeId:t,onDeleteSuccess:()=>{n("confirmDeleteNumberingScheme"),n("updateNumberingScheme")}});return e.jsxs(F,{opened:a,onClose:()=>n("confirmDeleteNumberingScheme"),title:e.jsx(g,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",children:[e.jsx(g,{c:"gray.8",children:"Are you sure you want to delete this numbering scheme? This action cannot be undone."}),e.jsxs(I,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(f,{variant:"light",onClick:()=>{n("confirmDeleteNumberingScheme"),d("updateNumberingScheme")},children:"Cancel"}),e.jsx(f,{color:"red",ml:12,onClick:s,loading:i,children:"Delete"})]})]})},ne=({itemParent:t})=>{const{modals:c,closeModal:n,openModal:d}=D(),a=c.updateNumberingScheme,{data:s,setData:i,handleSubmit:y,processing:j,errors:x,prefixParts:l,addTextPart:m,addDynamicPart:_,updatePart:v,removePart:w}=B({itemParent:t,isOpen:a}),C=[{value:"YY",label:"Year"},{value:"MM",label:"Month"},{value:"DD",label:"Day"},{value:"INC",label:"Increment"}];return e.jsxs(e.Fragment,{children:[e.jsx(F,{opened:a,onClose:()=>n("updateNumberingScheme"),title:e.jsx(g,{size:"lg",children:"Update Numbering Scheme"}),size:600,children:e.jsxs("form",{onSubmit:y,children:[e.jsxs(Y,{gap:16,children:[e.jsx(q,{label:"Name",value:s.name,onChange:r=>i("name",r.target.value),error:x.name,required:!0}),e.jsx(O,{label:"Add Number Only If Approved",checked:s.add_if_approved,onChange:r=>i("add_if_approved",r.currentTarget.checked),mt:"md"}),e.jsx(g,{size:"sm",fw:500,children:"Prefix Builder"}),e.jsxs(N,{children:[e.jsx(f,{variant:"subtle",size:"sm",leftSection:e.jsx(M,{size:16}),onClick:m,children:"Add Text"}),e.jsx(f,{variant:"subtle",size:"sm",leftSection:e.jsx(M,{size:16}),onClick:_,children:"Add Dynamic"})]}),l.map((r,u)=>e.jsxs(N,{align:"flex-end",children:[r.type==="text"?e.jsx(q,{placeholder:"Enter text",value:r.value,onChange:o=>v(r.id,o.target.value),required:!0,style:{flex:1}}):e.jsx(z,{placeholder:"Select dynamic part",data:C,value:r.value,onChange:o=>v(r.id,o||""),required:!0,style:{flex:1}}),e.jsx(T,{color:"red",onClick:()=>w(r.id),children:e.jsx(k,{size:16})})]},r.id)),e.jsx(g,{size:"sm",fw:500,children:"Preview:"}),e.jsx(P,{withBorder:!0,p:12,bg:"#f9f9f9",children:e.jsx(g,{children:l.map(r=>{if(r.type==="text")return r.value;switch(r.value){case"YY":return new Date().getFullYear().toString().slice(2);case"MM":return(new Date().getMonth()+1).toString().padStart(2,"0");case"DD":return new Date().getDate().toString().padStart(2,"0");case"INC":return s.next_number.toString().padStart(3,"0");default:return""}}).join(" ").trim()})}),e.jsxs(N,{justify:"space-between",children:[e.jsx(U,{label:"Next Number",value:s.next_number,onChange:r=>i("next_number",Number(r)),min:1,error:x.next_number,required:!0,style:{flex:1}}),e.jsx(z,{label:"Reset Frequency",data:[{value:"none",label:"None"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],value:s.reset_frequency,onChange:r=>i("reset_frequency",r??"none"),error:x.reset_frequency,required:!0})]})]}),e.jsxs(I,{align:"center",justify:"end",mt:24,children:[e.jsx(f,{variant:"light",onClick:()=>n("updateNumberingScheme"),children:"Cancel"}),e.jsx(f,{ml:12,type:"submit",loading:j,children:"Update"}),e.jsx(T,{variant:"transparent",color:"red",onClick:()=>{n("updateNumberingScheme"),d("confirmDeleteNumberingScheme")},title:"Delete Numbering Scheme",ml:12,children:e.jsx(k,{size:18})})]})]})}),e.jsx(G,{numberingSchemeId:t==null?void 0:t.numbering_scheme_id})]})};export{ne as U};
