import{f as N,u as O,d as P,q as U,j as e,B as q,C as $,e as G,g as L,b as D,M as V,W,n as k,Y}from"./app-D_sGyMKs.js";import{u as R,b as z,c as H,d as J,A as K}from"./Authenticated-Bn8-pIpC.js";import{u as Q}from"./use-fetch-metadata-DTjUgtXR.js";import{u as X,C as v}from"./Combobox-C8-r_sxZ.js";import{S as b}from"./Stack-Bu0ZIYtP.js";import{I as Z}from"./InputBase-BsilGFdQ.js";import{G as w}from"./Avatar-XVbTO5AB.js";import{B as g}from"./Button-drh6xeIV.js";import{T as M}from"./TextInput-iaoRy4pl.js";import{T as y}from"./Text-qvb52CaA.js";import{c as ee}from"./createReactComponent-2TRFm2tS.js";import{I as te}from"./IconFile-D5iLsfFi.js";import{I as ae}from"./IconEdit-DNQUJLOX.js";import{T as se}from"./Textarea-DOlrw65J.js";import{F as oe}from"./Flex-DjfWkKlt.js";import"./OfficeLogo-B7X7XOjq.js";import"./Popover-BM-stX1p.js";import"./use-uncontrolled-NDNXXLGG.js";import"./IconUser-BP827BXd.js";import"./get-sorted-breakpoints-Dsh_a-um.js";var B={root:"m_66836ed3",wrapper:"m_a5d60502",body:"m_667c2793",title:"m_6a03f287",label:"m_698f4f23",icon:"m_667f2a6a",message:"m_7fa78076",closeButton:"m_87f54839"};const ne={},re=G((a,{radius:c,color:s,variant:r,autoContrast:l})=>{const d=a.variantColorResolver({color:s||a.primaryColor,theme:a,variant:r||"light",autoContrast:l});return{root:{"--alert-radius":c===void 0?void 0:L(c),"--alert-bg":s||r?d.background:void 0,"--alert-color":d.color,"--alert-bd":s||r?d.border:void 0}}}),S=N((a,c)=>{const s=O("Alert",ne,a),{classNames:r,className:l,style:d,styles:m,unstyled:i,vars:u,radius:p,color:t,title:o,children:n,id:j,icon:x,withCloseButton:f,onClose:E,closeButtonLabel:T,variant:_,autoContrast:me,...F}=s,h=P({name:"Alert",classes:B,props:s,className:l,style:d,classNames:r,styles:m,unstyled:i,vars:u,varsResolver:re}),C=U(j),A=o&&`${C}-title`||void 0,I=`${C}-body`;return e.jsx(q,{id:C,...h("root",{variant:_}),variant:_,ref:c,...F,role:"alert","aria-describedby":I,"aria-labelledby":A,children:e.jsxs("div",{...h("wrapper"),children:[x&&e.jsx("div",{...h("icon"),children:x}),e.jsxs("div",{...h("body"),children:[o&&e.jsx("div",{...h("title"),"data-with-close-button":f||void 0,children:e.jsx("span",{id:A,...h("label"),children:o})}),n&&e.jsx("div",{id:I,...h("message"),"data-variant":_,children:n})]}),f&&e.jsx($,{...h("closeButton"),onClick:E,variant:"transparent",size:16,iconSize:16,"aria-label":T,unstyled:i})]})})});S.classes=B;S.displayName="@mantine/core/Alert";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var de=ee("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);const le=({onAdd:a})=>{const{modals:c,closeModal:s}=R(),r=c.addDocumentMetadata,{metadataList:l}=Q(),[d,m]=D.useState(null),i=X({onDropdownClose:()=>i.resetSelectedOption()}),u=()=>{d&&(a(d),s("addDocumentMetadata"),m(null))},p=l.map(t=>e.jsx(v.Option,{value:t.id.toString(),children:t.name},t.id));return e.jsx(V,{opened:r,onClose:()=>s("addDocumentMetadata"),title:"Add Custom Metadata",children:e.jsxs(b,{gap:16,children:[e.jsxs(v,{store:i,onOptionSubmit:t=>{const o=l.find(n=>n.id.toString()===t)||null;m(o),i.closeDropdown()},children:[e.jsx(v.Target,{children:e.jsx(Z,{component:"button",type:"button",rightSection:e.jsx(v.Chevron,{}),onClick:()=>i.toggleDropdown(),children:d?d.name:"Select Metadata"})}),e.jsx(v.Dropdown,{children:e.jsx(v.Options,{children:p})})]}),e.jsxs(w,{justify:"flex-end",children:[e.jsx(g,{variant:"outline",onClick:()=>s("addDocumentMetadata"),children:"Cancel"}),e.jsx(g,{onClick:u,disabled:!d,children:"Add"})]})]})})},ie=({metadata:a,requiredMetadata:c,onChange:s,onDelete:r})=>{const{openModal:l}=R(),d=t=>{const o=[...a,t];s&&s(o)},m=()=>{l("addDocumentMetadata")},i=t=>{const o=a[t],n=a.filter((j,x)=>x!==t);s&&s(n),r&&o.metadata_id!==0&&r(o.metadata_id)},u=(t,o,n)=>{const j=a.map((x,f)=>f===t?{...x,[o]:n}:x);s&&s(j)},p=D.useMemo(()=>{const t=a.map(o=>o.metadata_id);return c.filter(o=>!t.includes(o.id))},[a,c]);return e.jsxs(b,{children:[a.map((t,o)=>e.jsxs(w,{grow:!0,align:"flex-end",children:[e.jsx(M,{disabled:!0,label:"Name",placeholder:"Metadata name",value:t.name,onChange:n=>u(o,"name",n.target.value)}),e.jsx(M,{label:"Value",placeholder:"Metadata value",value:t.value,onChange:n=>u(o,"value",n.target.value)}),e.jsx(z,{color:"red",onClick:()=>i(o),children:e.jsx(H,{size:16})})]},t.metadata_id||o)),p.length>0&&e.jsxs(b,{gap:"xs",children:[e.jsx(y,{c:"red",size:"sm",children:"Missing Required Metadata:"}),p.map(t=>e.jsx(S,{icon:e.jsx(de,{size:16}),title:`${t.name} is missing`,color:"red",variant:"light"},t.id))]}),e.jsx(g,{variant:"light",onClick:m,leftSection:e.jsx(J,{size:14}),children:"Add Custom Metadata"}),e.jsx(le,{onAdd:t=>d({metadata_id:t.id,name:t.name,value:""})})]})};function ce({document:a,onSuccess:c}){const{data:s,setData:r,put:l,processing:d,errors:m,reset:i,clearErrors:u}=W({name:a.name,document_number:a.document_number||"",description:a.description||"",update_metadata:a.metadata.map(t=>({metadata_id:t.metadata_id,name:t.name,value:t.value})),delete_metadata:[],related_documents:a.related_documents.map(t=>({item_id:t.item_id,name:t.name}))});return{data:s,setData:r,handleUpdateDocument:t=>{t.preventDefault(),l(route("document.save",a.item_id),{onSuccess:()=>{k.show({message:"Document updated successfully",color:"green"})},onError:o=>{k.show({message:"Failed to update document",color:"red"})},onFinish:()=>u()})},processing:d,errors:m,reset:i}}function ze({document:a,itemAncestors:c}){const{data:s,setData:r,handleUpdateDocument:l,processing:d,errors:m,reset:i}=ce({document:a}),[u,p]=D.useState([]),t=n=>{r("update_metadata",n)},o=n=>{p(j=>[...j,n]),r("delete_metadata",[...s.delete_metadata||[],{metadata_id:n}])};return e.jsxs(K,{children:[e.jsx(Y,{title:"Document Properties"}),e.jsxs(b,{px:8,py:8,gap:24,w:550,mb:72,children:[e.jsxs(w,{mt:24,align:"center",children:[e.jsx(te,{size:56,stroke:1.5,color:"gray"}),e.jsx(y,{fw:500,children:s.name}),e.jsx(z,{variant:"subtle",color:"gray",children:e.jsx(ae,{size:24})})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs(b,{gap:12,children:[e.jsx(M,{label:"Document Number",name:"document_number",value:s.document_number,onChange:n=>r("document_number",n.target.value),placeholder:"Enter document number"}),e.jsx(M,{type:"text",label:"Created At",value:a.created_at,disabled:!0}),e.jsx(se,{label:"Description",autosize:!0,minRows:4,maxRows:6,placeholder:"Enter description",value:s.description,onChange:n=>r("description",n.target.value)})]}),e.jsxs(b,{gap:12,children:[e.jsx(y,{size:"sm",fw:500,children:"Custom Metadata Field"}),e.jsx(ie,{metadata:s.update_metadata??[],requiredMetadata:a.required_folder_metadata,onChange:t,onDelete:o})]}),e.jsxs(oe,{align:"center",justify:"end",mt:16,children:[e.jsx(g,{variant:"outline",type:"button",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(g,{ml:12,type:"submit",loading:d,children:"Save"})]})]})]})]})}export{ze as default};
