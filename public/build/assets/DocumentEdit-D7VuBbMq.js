import{f as N,u as O,d as P,q as U,j as e,B as q,C as $,e as G,g as L,b as D,M as V,W,n as k,Y}from"./app-DNXyikm8.js";import{u as R,b as z,c as H,d as J,A as K}from"./Authenticated-n-UZ9Wg0.js";import{u as Q}from"./use-fetch-metadata-fV119OFu.js";import{u as X,C as v}from"./Combobox-CeAKxMF7.js";import{S as b}from"./Stack-_ZpdIiGj.js";import{I as Z}from"./InputBase-DdQXy5fn.js";import{G as w}from"./Avatar-BIPOllA1.js";import{B as g}from"./Button-8JzPEOnx.js";import{T as _}from"./TextInput-CpkAnPyM.js";import{T as y}from"./Text-B_iPcdW5.js";import{c as ee}from"./createReactComponent-DkXyC2OJ.js";import{I as te}from"./IconFile-19ZeR_AL.js";import{I as ae}from"./IconEdit-BVcTwCPU.js";import{T as se}from"./Textarea-BrnFyq_s.js";import{F as oe}from"./Flex-BuuFm4Ek.js";import"./OfficeLogo-DI0023WY.js";import"./Popover-CLW93gnI.js";import"./use-uncontrolled-B5y4jCOb.js";import"./IconUser-Bo1Uf62S.js";import"./get-sorted-breakpoints-DCnJzV-p.js";var B={root:"m_66836ed3",wrapper:"m_a5d60502",body:"m_667c2793",title:"m_6a03f287",label:"m_698f4f23",icon:"m_667f2a6a",message:"m_7fa78076",closeButton:"m_87f54839"};const ne={},de=G((a,{radius:c,color:s,variant:d,autoContrast:l})=>{const r=a.variantColorResolver({color:s||a.primaryColor,theme:a,variant:d||"light",autoContrast:l});return{root:{"--alert-radius":c===void 0?void 0:L(c),"--alert-bg":s||d?r.background:void 0,"--alert-color":r.color,"--alert-bd":s||d?r.border:void 0}}}),S=N((a,c)=>{const s=O("Alert",ne,a),{classNames:d,className:l,style:r,styles:m,unstyled:i,vars:u,radius:p,color:t,title:o,children:n,id:j,icon:x,withCloseButton:f,onClose:E,closeButtonLabel:T,variant:M,autoContrast:me,...F}=s,h=P({name:"Alert",classes:B,props:s,className:l,style:r,classNames:d,styles:m,unstyled:i,vars:u,varsResolver:de}),C=U(j),A=o&&`${C}-title`||void 0,I=`${C}-body`;return e.jsx(q,{id:C,...h("root",{variant:M}),variant:M,ref:c,...F,role:"alert","aria-describedby":I,"aria-labelledby":A,children:e.jsxs("div",{...h("wrapper"),children:[x&&e.jsx("div",{...h("icon"),children:x}),e.jsxs("div",{...h("body"),children:[o&&e.jsx("div",{...h("title"),"data-with-close-button":f||void 0,children:e.jsx("span",{id:A,...h("label"),children:o})}),n&&e.jsx("div",{id:I,...h("message"),"data-variant":M,children:n})]}),f&&e.jsx($,{...h("closeButton"),onClick:E,variant:"transparent",size:16,iconSize:16,"aria-label":T,unstyled:i})]})})});S.classes=B;S.displayName="@mantine/core/Alert";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=ee("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);const le=({onAdd:a})=>{const{modals:c,closeModal:s}=R(),d=c.addDocumentMetadata,{metadataList:l}=Q(),[r,m]=D.useState(null),i=X({onDropdownClose:()=>i.resetSelectedOption()}),u=()=>{r&&(a(r),s("addDocumentMetadata"),m(null))},p=l.map(t=>e.jsx(v.Option,{value:t.metadata_id.toString(),children:t.name},t.metadata_id));return e.jsx(V,{opened:d,onClose:()=>s("addDocumentMetadata"),title:"Add Custom Metadata",children:e.jsxs(b,{gap:16,children:[e.jsxs(v,{store:i,onOptionSubmit:t=>{const o=l.find(n=>n.metadata_id.toString()===t)||null;m(o),i.closeDropdown()},children:[e.jsx(v.Target,{children:e.jsx(Z,{component:"button",type:"button",rightSection:e.jsx(v.Chevron,{}),onClick:()=>i.toggleDropdown(),children:r?r.name:"Select Metadata"})}),e.jsx(v.Dropdown,{children:e.jsx(v.Options,{children:p})})]}),e.jsxs(w,{justify:"flex-end",children:[e.jsx(g,{variant:"outline",onClick:()=>s("addDocumentMetadata"),children:"Cancel"}),e.jsx(g,{onClick:u,disabled:!r,children:"Add"})]})]})})},ie=({metadata:a,requiredMetadata:c,onChange:s,onDelete:d})=>{const{openModal:l}=R(),r=t=>{const o=[...a,t];s&&s(o)},m=()=>{l("addDocumentMetadata")},i=t=>{const o=a[t],n=a.filter((j,x)=>x!==t);s&&s(n),d&&o.metadata_id!==0&&d(o.metadata_id)},u=(t,o,n)=>{const j=a.map((x,f)=>f===t?{...x,[o]:n}:x);s&&s(j)},p=D.useMemo(()=>{const t=a.map(o=>o.metadata_id);return c.filter(o=>!t.includes(o.metadata_id))},[a,c]);return e.jsxs(b,{children:[a.map((t,o)=>e.jsxs(w,{grow:!0,align:"flex-end",children:[e.jsx(_,{disabled:!0,label:"Name",placeholder:"Metadata name",value:t.name,onChange:n=>u(o,"name",n.target.value)}),e.jsx(_,{label:"Value",placeholder:"Metadata value",value:t.value,onChange:n=>u(o,"value",n.target.value)}),e.jsx(z,{color:"red",onClick:()=>i(o),children:e.jsx(H,{size:16})})]},t.metadata_id||o)),p.length>0&&e.jsxs(b,{gap:"xs",children:[e.jsx(y,{c:"red",size:"sm",children:"Missing Required Metadata:"}),p.map(t=>e.jsx(S,{icon:e.jsx(re,{size:16}),title:`${t.name} is missing`,color:"red",variant:"light"},t.metadata_id))]}),e.jsx(g,{variant:"light",onClick:m,leftSection:e.jsx(J,{size:14}),children:"Add Custom Metadata"}),e.jsx(le,{onAdd:t=>r({metadata_id:t.metadata_id,name:t.name,value:""})})]})};function ce({document:a,onSuccess:c}){const{data:s,setData:d,put:l,processing:r,errors:m,reset:i,clearErrors:u}=W({name:a.name,document_number:a.document_number||"",description:a.description||"",update_metadata:a.metadata.map(t=>({metadata_id:t.metadata_id,name:t.name,value:t.value})),delete_metadata:[],related_documents:a.related_documents.map(t=>({item_id:t.item_id,name:t.name}))});return{data:s,setData:d,handleUpdateDocument:t=>{t.preventDefault(),l(route("document.save",a.item_id),{onSuccess:()=>{k.show({message:"Document updated successfully",color:"green"})},onError:o=>{k.show({message:"Failed to update document",color:"red"})},onFinish:()=>u()})},processing:r,errors:m,reset:i}}function ze({document:a,itemAncestors:c}){const{data:s,setData:d,handleUpdateDocument:l,processing:r,errors:m,reset:i}=ce({document:a}),[u,p]=D.useState([]),t=n=>{d("update_metadata",n)},o=n=>{p(j=>[...j,n]),d("delete_metadata",[...s.delete_metadata||[],{metadata_id:n}])};return e.jsxs(K,{children:[e.jsx(Y,{title:"Document Properties"}),e.jsxs(b,{px:8,py:8,gap:24,w:550,mb:72,children:[e.jsxs(w,{mt:24,align:"center",children:[e.jsx(te,{size:56,stroke:1.5,color:"gray"}),e.jsx(y,{fw:500,children:s.name}),e.jsx(z,{variant:"subtle",color:"gray",children:e.jsx(ae,{size:24})})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs(b,{gap:12,children:[e.jsx(_,{label:"Document Number",name:"document_number",value:s.document_number,onChange:n=>d("document_number",n.target.value),placeholder:"Enter document number"}),e.jsx(_,{type:"text",label:"Created At",value:a.created_at,disabled:!0}),e.jsx(se,{label:"Description",autosize:!0,minRows:4,maxRows:6,placeholder:"Enter description",value:s.description,onChange:n=>d("description",n.target.value)})]}),e.jsxs(b,{gap:12,children:[e.jsx(y,{size:"sm",fw:500,children:"Custom Metadata Field"}),e.jsx(ie,{metadata:s.update_metadata??[],requiredMetadata:a.required_folder_metadata,onChange:t,onDelete:o})]}),e.jsxs(oe,{align:"center",justify:"end",mt:16,children:[e.jsx(g,{variant:"outline",type:"button",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(g,{ml:12,type:"submit",loading:r,children:"Save"})]})]})]})]})}export{ze as default};
