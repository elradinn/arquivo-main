import{d as z,u as oe,k as ne,j as e,l as le,W as N,n as _,M as G,e as Q,Y as ae,B as ie,P as ce,h as de}from"./app-Be6U1Dc8.js";import{u as E,a as O,b as P,T as ue,A as pe,c as me}from"./Authenticated-hQH3hORN.js";import{Y as X}from"./index-CQ_tJ28n.js";import{I as he}from"./ItemBreadcrumbs-DoEBBp7D.js";import{u as H,R as M,a as ve,I as fe,b as K}from"./use-fetch-users-BOdMNpqA.js";import{T as k,F as Y}from"./OfficeLogo-BgjFk65O.js";import{S as B}from"./Stack-zxFT2Oc1.js";import{G as F,S as Z,c as ee}from"./NotificationMenu-DL9b0tvo.js";import{T as J}from"./Textarea-D6Scmjm5.js";import{S as q}from"./Select-BTO6iZxa.js";import{c as se,A as V}from"./IconUser-BfhP9fWZ.js";import{B as A}from"./Button-D9h5vimS.js";import{I as ge}from"./IconDownload-BrQLdkbq.js";import{I as je,U as xe}from"./UnarchiveFilesForm-Da9Owu7z.js";import{G as L}from"./Grid-DBIfVUSf.js";import{A as Ue,I as we}from"./IconAlertCircle-GtehlEbF.js";import{I as De}from"./IconEye-BI3rVzUb.js";import"./TextInput-8_pOHK7P.js";import"./InputBase-DUCm8-Wn.js";import"./Popover-DNH91axH.js";import"./use-resolved-styles-api-D7z3oZkW.js";import"./get-sorted-breakpoints-CzoFm_tl.js";import"./Checkbox-CiTPNHD0.js";import"./CheckIcon-RZhGPBCj.js";import"./Anchor-Xqcd2skh.js";import"./OptionsDropdown-C0aY907v.js";import"./Combobox-BzCSAeDM.js";import"./get-base-value-JqT_q0U7.js";const Ae={multiple:!1},te=z.forwardRef((s,l)=>{const{onChange:r,children:t,multiple:o,accept:a,name:i,form:j,resetRef:D,disabled:U,capture:R,inputProps:b,...C}=oe("FileButton",Ae,s),d=z.useRef(),u=()=>{var c;!U&&((c=d.current)==null||c.click())},p=c=>{r(o?Array.from(c.currentTarget.files):c.currentTarget.files[0]||null)};return ne(D,()=>{d.current.value=""}),e.jsxs(e.Fragment,{children:[t({onClick:u,...C}),e.jsx("input",{style:{display:"none"},type:"file",accept:a,multiple:o,onChange:p,ref:le(l,d),name:i,form:j,capture:R,...b})]})});te.displayName="@mantine/core/FileButton";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var be=se("outline","pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Se=se("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);function ye({documentId:s,isOpen:l}){const[r,t]=z.useState("approval"),{closeModal:o,modals:a}=E(),i=H(r,l),{data:j,setData:D,post:U,processing:R,errors:b,reset:C}=N({document_id:"",resolution:"",destination:"",type:"approval",users:[]}),[d,u]=z.useState([]),p=i.length;z.useEffect(()=>{l&&u([])},[r,i,l]);const m=x=>{x.preventDefault();const y=d.map(n=>parseInt(n.selectedUser)).filter(n=>!isNaN(n));j.document_id=s??"",j.users=y.map(n=>({user_id:n.toString()})),U(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentApproval"),_.show({position:"top-center",message:"Document approval process created",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>C()})},c=()=>{d.length<p&&u([...d,{selectedUser:""}])},S=()=>{const x=d.map(h=>h.selectedUser),n=i.filter(h=>!x.includes(h.id.toString())).map(h=>({selectedUser:h.id.toString()}));u([...d,...n])},f=x=>{const y=[...d];y.splice(x,1),u(y)},g=(x,y)=>{const n=[...d];n[x].selectedUser=y||"",u(n)},I=d.map(x=>x.selectedUser).filter(x=>x!=="");return{data:j,setData:D,createApprovalSubmit:m,processing:R,errors:b,users:d,setDocumentApprovalType:t,addUser:c,removeUser:f,handleUserChange:g,addAllUsers:S,maxUsers:p,selectedUserIds:I,fetchedUsers:i}}const Ce=({document:s})=>{const{modals:l,closeModal:r}=E(),t=l.createDocumentApproval,{data:o,setData:a,createApprovalSubmit:i,processing:j,errors:D,users:U,setDocumentApprovalType:R,addUser:b,removeUser:C,handleUserChange:d,addAllUsers:u,maxUsers:p,selectedUserIds:m,fetchedUsers:c}=ye({documentId:s==null?void 0:s.item_id,isOpen:t}),S=f=>c.filter(g=>!m.includes(g.id.toString())||g.id.toString()===U[f].selectedUser).map(g=>({value:g.id.toString(),label:`${g.name} (${g.email})`}));return e.jsx(G,{opened:l.createDocumentApproval,onClose:()=>r("createDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:i,children:[e.jsxs(B,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:f=>{a("type",f),R(f)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:f=>a("resolution",f.target.value),error:D.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),U.map((f,g)=>e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(q,{placeholder:"Select a user",data:S(g),value:f.selectedUser,onChange:I=>d(g,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(V,{color:"red",onClick:()=>C(g),title:"Remove User",children:e.jsx(O,{size:18})})]},g)),e.jsxs(F,{children:[U.length<p&&e.jsx(A,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:b,disabled:U.length>=p,children:"Add User"}),m.length<p&&e.jsx(A,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:U.length>=p,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>r("createDocumentApproval"),children:"Cancel"}),e.jsx(A,{ml:12,type:"submit",loading:j,children:"Create"})]})]})})};function re({documentApprovalId:s,isOpen:l}){const[r,t]=z.useState(null);z.useEffect(()=>{s&&l&&o(s)},[s,l]);const o=async a=>{try{const i=await Q.get(`/document_approval/${a}/update`);t(i.data)}catch(i){console.error("Error fetching document approval",i)}};return r}function Re({documentApprovalId:s,isOpen:l}){const[r,t]=z.useState(""),o=re({documentApprovalId:s,isOpen:l}),a=H(r,l),{closeModal:i}=E(),{data:j,setData:D,put:U,processing:R,errors:b,reset:C,clearErrors:d}=N({resolution:"",type:"",users:[]}),[u,p]=z.useState([]),m=a.length;z.useEffect(()=>{o&&(t(o.type),p((o.document_user_approvals||[]).map(n=>({selectedUser:n.user_id.toString()}))),D({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(n=>({user_id:n.user_id}))}))},[o,l,r]),z.useEffect(()=>{l||p([])},[r]);const c=()=>{i("viewDocumentApproval"),C(),d()},S=n=>{n.preventDefault(),j.users=u.map(h=>parseInt(h.selectedUser)).filter(h=>!isNaN(h)).map(h=>({user_id:h.toString()})),U(route("document_approvals.update",s),{onSuccess:()=>{c(),_.show({position:"top-center",message:"Document approval updated successfully",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>C()})},f=()=>{u.length<m&&p([...u,{selectedUser:""}])},g=()=>{const n=u.map(w=>w.selectedUser),v=a.filter(w=>!n.includes(w.id.toString())).map(w=>({selectedUser:w.id.toString()}));p([...u,...v])},I=n=>{const h=[...u];h.splice(n,1),p(h)},x=(n,h)=>{const v=[...u];v[n].selectedUser=h||"",p(v)},y=u.map(n=>n.selectedUser).filter(n=>n!=="");return{data:j,setData:D,handleUpdateDocumentApproval:S,processing:R,errors:b,handleClose:c,users:u,documentApproval:o,setDocumentApprovalType:t,addUser:f,removeUser:I,handleUserChange:x,addAllUsers:g,maxUsers:m,selectedUserIds:y,fetchedUsers:a}}function _e({documentApprovalId:s,onDeleteSuccess:l}){const{delete:r,processing:t}=N();return{handleDeleteDocumentApproval:()=>{if(!s){_.show({position:"top-center",message:"Document Approval ID is missing.",color:"red"});return}r(route("document_approvals.cancel",s),{onSuccess:()=>{_.show({position:"top-center",message:"Document Approval deleted successfully.",color:"green"}),l()},onError:a=>{let i="Failed to delete document approval.";a&&Object.keys(a).length>0&&(i=a[Object.keys(a)[0]]),_.show({position:"top-center",message:i,color:"red"})}})},processing:t}}const ze=({documentApprovalId:s})=>{const{modals:l,closeModal:r,openModal:t}=E(),o=l.confirmDeleteDocumentApproval,{handleDeleteDocumentApproval:a,processing:i}=_e({documentApprovalId:s,onDeleteSuccess:()=>{r("confirmDeleteDocumentApproval"),r("viewDocumentApproval")}});return e.jsxs(G,{opened:o,onClose:()=>r("confirmDeleteDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(k,{c:"gray.8",children:"Are you sure you want to cancel this document approval? This action cannot be undone."}),e.jsxs(Y,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>{r("confirmDeleteDocumentApproval"),t("viewDocumentApproval")},children:"Cancel"}),e.jsx(A,{color:"red",ml:12,onClick:a,loading:i,children:"Delete"})]})]})},ke=({document:s})=>{var n,h;const{modals:l,closeModal:r,openModal:t}=E(),o=l.viewDocumentApproval,a=(h=(n=s==null?void 0:s.document_approval_ids)==null?void 0:n.find(v=>v.type==="approval"))==null?void 0:h.id,{data:i,setData:j,handleUpdateDocumentApproval:D,processing:U,errors:R,users:b,setDocumentApprovalType:C,addUser:d,removeUser:u,handleUserChange:p,addAllUsers:m,documentApproval:c,maxUsers:S,selectedUserIds:f,fetchedUsers:g}=Re({documentApprovalId:a,isOpen:o}),I=v=>g.filter(w=>!f.includes(w.id.toString())||w.id.toString()===b[v].selectedUser).map(w=>({value:w.id.toString(),label:`${w.name} (${w.email})`})),x=c==null?void 0:c.document_user_approvals.some(v=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(v.user_state)),y=c==null?void 0:c.document_user_approvals.every(v=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(v.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(G,{opened:o,onClose:()=>r("viewDocumentApproval"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Document Approval Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(B,{gap:16,children:[e.jsx(k,{size:"sm",children:"View the document workflow process for this document"}),!x&&e.jsx(M.Group,{name:"status",value:i.type,onChange:v=>{j("type",v),C(v)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:i.resolution??"",onChange:v=>j("resolution",v.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:x}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),b.map((v,w)=>{const T=c==null?void 0:c.document_user_approvals.find(W=>W.user_id.toString()===v.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(F,{children:e.jsx(Z,{state:T==null?void 0:T.user_state})}),e.jsx(q,{placeholder:"Select a user",data:I(w),value:v.selectedUser,onChange:W=>p(w,W),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(V,{color:"red",onClick:()=>u(w),title:"Remove User",children:e.jsx(O,{size:18})})]},w)}),!y&&e.jsxs(F,{children:[b.length<S&&e.jsx(A,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:d,disabled:b.length>=S,children:"Add User"}),f.length<S&&e.jsx(A,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:m,disabled:b.length>=S,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>r("viewDocumentApproval"),children:y?"Close":"Cancel"}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(A,{ml:12,type:"submit",loading:U,children:"Update"}),e.jsx(V,{variant:"transparent",color:"red",onClick:()=>{r("viewDocumentApproval"),t("confirmDeleteDocumentApproval")},title:"Delete Document Approval",ml:12,children:e.jsx(O,{size:18})})]})]})]})}),e.jsx(ze,{documentApprovalId:a})]})};function Fe(){const{post:s,processing:l}=N();return{restoreVersion:t=>{s(route("document.restore_version",{version:t}),{onSuccess:()=>{_.show({position:"top-center",message:"Document version restored successfully.",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Failed to restore document version.",color:"red"})}})},processing:l}}function Ie(){const{delete:s,processing:l}=N();return{deleteVersion:t=>{s(route("document.delete_version",{version:t}),{onSuccess:()=>{_.show({position:"top-center",message:"Document version deleted successfully.",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Failed to delete document version.",color:"red"})}})},processing:l}}const Ee=({versions:s})=>{const{restoreVersion:l}=Fe(),{deleteVersion:r}=Ie();return e.jsx(X,{columns:[{accessor:"name",title:"Name",render:({name:t,review_status:o,approval_status:a,mime:i})=>e.jsxs(F,{align:"center",gap:12,children:[e.jsx(ee,{mime:i,isFolder:!1,reviewStatus:o,approvalStatus:a}),e.jsx("span",{children:t})]})},{accessor:"uploaded_at",title:"Uploaded At"},{accessor:"actions",title:"Actions",render:t=>e.jsxs(F,{gap:4,children:[!t.current&&e.jsx(V,{variant:"subtle",onClick:()=>l(t.id),children:e.jsx(Se,{size:16})}),!t.current&&e.jsx(V,{variant:"subtle",color:"red",onClick:()=>r(t.id),children:e.jsx(O,{size:16})}),e.jsx("a",{href:t.file_path,download:!0,children:e.jsx(V,{variant:"subtle",children:e.jsx(ge,{size:16})})})]})}],records:s,highlightOnHover:!0,verticalSpacing:"sm",horizontalSpacing:"sm"})};function Me(s){const{data:l,post:r,reset:t,processing:o,errors:a,clearErrors:i}=N({document_item_id:s,file:null});return{uploadVersion:D=>{if(!D){_.show({position:"top-center",message:"No file selected.",color:"red"});return}l.file=D,r(`/document/${s}/versions`,{onSuccess:()=>{_.show({position:"top-center",message:"Document version uploaded successfully.",color:"green"}),t()},onError:()=>{_.show({position:"top-center",message:"Failed to upload document version.",color:"red"})},onFinish:()=>{i()}})},processing:o,errors:a}}function Te({documentId:s,isOpen:l}){const[r,t]=z.useState([]),[o,a]=z.useState(!1),[i,j]=z.useState(null);return z.useEffect(()=>{s&&(async()=>{a(!0);try{const U=await Q.get(route("document.fetchSharedUsers",{document:s}));t(U.data),j(null)}catch(U){console.error(U),j("Failed to fetch shared users."),_.show({position:"top-center",title:"Error",message:"Unable to fetch shared users.",color:"red"})}finally{a(!1)}})()},[s,l]),{sharedUsers:r,loading:o,error:i}}function Ve({documentId:s,close:l}){const{modals:r}=E(),t=r.shareDocument,{sharedUsers:o,loading:a,error:i}=Te({documentId:s,isOpen:t}),{data:j,setData:D,post:U,processing:R,errors:b,reset:C}=N({users:[]});return z.useEffect(()=>{if(o.length>0){const S=o.map(f=>({email:f.email,role:f.role}));D("users",S)}},[o]),{data:j,submit:()=>{U(route("document.share",{document:s}),{onSuccess:()=>{l(),_.show({position:"top-center",message:"Document shared successfully.",color:"green"}),C()},onError:S=>{_.show({position:"top-center",message:"Failed to share the document.",color:"red"})}})},processing:R,errors:b,addUser:()=>{D("users",[...j.users,{email:"",role:"viewer"}])},removeUser:S=>{const f=j.users.filter((g,I)=>I!==S);D("users",f)},handleUserChange:(S,f,g)=>{const I=j.users.map((x,y)=>y===S?{...x,[f]:g}:x);D("users",I)},handleAddAllUsers:S=>{D("users",S)}}}const Pe=({documentId:s})=>{const{modals:l,closeModal:r}=E(),{users:t,loading:o,error:a}=ve(),{data:i,submit:j,processing:D,errors:U,addUser:R,removeUser:b,handleUserChange:C,handleAddAllUsers:d}=Ve({documentId:s,close:()=>r("shareDocument")}),u=()=>{const p=t.map(m=>({email:m.email,role:"viewer"}));d(p)};return e.jsx(G,{opened:l.shareDocument,onClose:()=>r("shareDocument"),title:e.jsx(k,{size:"lg",children:"Share Document"}),size:"600",children:e.jsxs("form",{onSubmit:p=>{p.preventDefault(),j()},children:[e.jsxs(B,{children:[i.users.map((p,m)=>e.jsxs(F,{align:"flex-end",children:[e.jsx(q,{data:t.map(c=>({value:c.email,label:`${c.name} (${c.email})`})),placeholder:"Select a user",value:p.email,onChange:c=>C(m,"email",c||""),style:{flex:1},required:!0}),e.jsx(q,{data:[{value:"viewer",label:"Viewer"},{value:"editor",label:"Editor"}],placeholder:"Select role",value:p.role,onChange:c=>C(m,"role",c||"viewer"),style:{width:120},required:!0}),e.jsx(ue,{label:"Remove User",withArrow:!0,children:e.jsx(V,{color:"red",onClick:()=>b(m),children:e.jsx(O,{size:18})})})]},m)),e.jsxs(F,{children:[e.jsx(A,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:()=>R(),children:"Add User"}),e.jsx(A,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:i.users.length>=t.length,children:"Add All Users"})]})]}),e.jsxs(F,{mt:"md",children:[e.jsx(A,{variant:"outline",onClick:()=>r("shareDocument"),children:"Cancel"}),e.jsx(A,{type:"submit",loading:D,children:"Save"})]})]})})};function Ne({documentApprovalId:s,isOpen:l}){const[r,t]=z.useState(""),o=re({documentApprovalId:s,isOpen:l}),a=H(r,l),{closeModal:i}=E(),{data:j,setData:D,put:U,processing:R,errors:b,reset:C,clearErrors:d}=N({resolution:"",type:"",users:[]}),[u,p]=z.useState([]),m=a.length;z.useEffect(()=>{o&&(t(o.type),p((o.document_user_approvals||[]).map(n=>({selectedUser:n.user_id.toString()}))),D({resolution:o.resolution||"",type:o.type||"",users:(o.document_user_approvals||[]).map(n=>({user_id:n.user_id}))}))},[o,l,r]),z.useEffect(()=>{l||p([])},[r]);const c=()=>{i("viewDocumentReview"),C(),d()},S=n=>{n.preventDefault(),j.users=u.map(h=>parseInt(h.selectedUser)).filter(h=>!isNaN(h)).map(h=>({user_id:h.toString()})),U(route("document_approvals.update",s),{onSuccess:()=>{c(),_.show({position:"top-center",message:"Document approval updated successfully",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>C()})},f=()=>{u.length<m&&p([...u,{selectedUser:""}])},g=()=>{const n=u.map(w=>w.selectedUser),v=a.filter(w=>!n.includes(w.id.toString())).map(w=>({selectedUser:w.id.toString()}));p([...u,...v])},I=n=>{const h=[...u];h.splice(n,1),p(h)},x=(n,h)=>{const v=[...u];v[n].selectedUser=h||"",p(v)},y=u.map(n=>n.selectedUser).filter(n=>n!=="");return{data:j,setData:D,handleUpdateDocumentApproval:S,processing:R,errors:b,handleClose:c,users:u,documentApproval:o,setDocumentApprovalType:t,addUser:f,removeUser:I,handleUserChange:x,addAllUsers:g,maxUsers:m,selectedUserIds:y,fetchedUsers:a}}function $e({documentReviewId:s,onDeleteSuccess:l}){const{delete:r,processing:t}=N();return{handleDeleteDocumentReview:()=>{if(!s){_.show({position:"top-center",message:"Document Review ID is missing.",color:"red"});return}r(route("document_approvals.cancel",s),{onSuccess:()=>{_.show({position:"top-center",message:"Document Review deleted successfully.",color:"green"}),l()},onError:a=>{let i="Failed to delete document review.";a&&Object.keys(a).length>0&&(i=a[Object.keys(a)[0]]),_.show({position:"top-center",message:i,color:"red"})}})},processing:t}}const Be=({documentReviewId:s})=>{const{modals:l,closeModal:r,openModal:t}=E(),o=l.confirmDeleteDocumentReview,{handleDeleteDocumentReview:a,processing:i}=$e({documentReviewId:s,onDeleteSuccess:()=>{r("confirmDeleteDocumentReview"),r("viewDocumentReview")}});return e.jsxs(G,{opened:o,onClose:()=>r("confirmDeleteDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(k,{c:"gray.8",children:"Are you sure you want to cancel this document review? This action cannot be undone."}),e.jsxs(Y,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>{r("confirmDeleteDocumentReview"),t("viewDocumentReview")},children:"Cancel"}),e.jsx(A,{color:"red",ml:12,onClick:a,loading:i,children:"Delete"})]})]})},Oe=({document:s})=>{var n,h;const{modals:l,closeModal:r,openModal:t}=E(),o=l.viewDocumentReview,a=(h=(n=s==null?void 0:s.document_approval_ids)==null?void 0:n.find(v=>v.type==="reviewal"))==null?void 0:h.id,{data:i,setData:j,handleUpdateDocumentApproval:D,processing:U,errors:R,users:b,setDocumentApprovalType:C,addUser:d,removeUser:u,handleUserChange:p,addAllUsers:m,documentApproval:c,maxUsers:S,selectedUserIds:f,fetchedUsers:g}=Ne({documentApprovalId:a,isOpen:o}),I=v=>g.filter(w=>!f.includes(w.id.toString())||w.id.toString()===b[v].selectedUser).map(w=>({value:w.id.toString(),label:`${w.name} (${w.email})`})),x=c==null?void 0:c.document_user_approvals.some(v=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(v.user_state)),y=c==null?void 0:c.document_user_approvals.every(v=>["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(v.user_state));return e.jsxs(e.Fragment,{children:[e.jsx(G,{opened:o,onClose:()=>r("viewDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Document Review Workflow Process"}),size:550,children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(B,{gap:16,children:[e.jsx(k,{size:"sm",children:"View the document workflow process for this document"}),!x&&e.jsx(M.Group,{name:"status",value:i.type,onChange:v=>{j("type",v),C(v)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:i.resolution??"",onChange:v=>j("resolution",v.target.value),error:R.resolution,autosize:!0,minRows:2,maxRows:4,readOnly:x}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),b.map((v,w)=>{const T=c==null?void 0:c.document_user_approvals.find(W=>W.user_id.toString()===v.selectedUser),$=T&&["Reviewal Accepted","Reviewal Rejected","Approval Accepted","Approval Rejected"].includes(T.user_state);return e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(F,{children:e.jsx(Z,{state:T==null?void 0:T.user_state})}),e.jsx(q,{placeholder:"Select a user",data:I(w),value:v.selectedUser,onChange:W=>p(w,W),required:!$,style:{flex:1},allowDeselect:!$,readOnly:$}),!$&&e.jsx(V,{color:"red",onClick:()=>u(w),title:"Remove User",children:e.jsx(O,{size:18})})]},w)}),!y&&e.jsxs(F,{children:[b.length<S&&e.jsx(A,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:d,disabled:b.length>=S,children:"Add User"}),f.length<S&&e.jsx(A,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:m,disabled:b.length>=S,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>r("viewDocumentReview"),children:y?"Close":"Cancel"}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(A,{ml:12,type:"submit",loading:U,children:"Update"}),e.jsx(V,{variant:"transparent",color:"red",onClick:()=>{r("viewDocumentReview"),t("confirmDeleteDocumentReview")},title:"Delete Document Approval",ml:12,children:e.jsx(O,{size:18})})]})]})]})}),e.jsx(Be,{documentReviewId:a})]})};function We({documentId:s,isOpen:l}){const[r,t]=z.useState("reviewal"),{closeModal:o,modals:a}=E(),i=H(r,l),{data:j,setData:D,post:U,processing:R,errors:b,reset:C}=N({document_id:"",resolution:"",destination:"",type:"reviewal",users:[]}),[d,u]=z.useState([]),p=i.length;z.useEffect(()=>{l&&u([])},[r,i,l]);const m=x=>{x.preventDefault();const y=d.map(n=>parseInt(n.selectedUser)).filter(n=>!isNaN(n));j.document_id=s??"",j.users=y.map(n=>({user_id:n.toString()})),U(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{o("createDocumentReview"),_.show({position:"top-center",message:"Document review process created",color:"green"})},onError:()=>{_.show({position:"top-center",message:"Something went wrong",color:"red"})},onFinish:()=>C()})},c=()=>{d.length<p&&u([...d,{selectedUser:""}])},S=()=>{const x=d.map(h=>h.selectedUser),n=i.filter(h=>!x.includes(h.id.toString())).map(h=>({selectedUser:h.id.toString()}));u([...d,...n])},f=x=>{const y=[...d];y.splice(x,1),u(y)},g=(x,y)=>{const n=[...d];n[x].selectedUser=y||"",u(n)},I=d.map(x=>x.selectedUser).filter(x=>x!=="");return{data:j,setData:D,createApprovalSubmit:m,processing:R,errors:b,users:d,setDocumentApprovalType:t,addUser:c,removeUser:f,handleUserChange:g,addAllUsers:S,maxUsers:p,selectedUserIds:I,fetchedUsers:i}}const Ge=({document:s})=>{const{modals:l,closeModal:r}=E(),t=l.createDocumentReview,{data:o,setData:a,createApprovalSubmit:i,processing:j,errors:D,users:U,setDocumentApprovalType:R,addUser:b,removeUser:C,handleUserChange:d,addAllUsers:u,maxUsers:p,selectedUserIds:m,fetchedUsers:c}=We({documentId:s==null?void 0:s.item_id,isOpen:t}),S=f=>c.filter(g=>!m.includes(g.id.toString())||g.id.toString()===U[f].selectedUser).map(g=>({value:g.id.toString(),label:`${g.name} (${g.email})`}));return e.jsx(G,{opened:l.createDocumentReview,onClose:()=>r("createDocumentReview"),title:e.jsx(k,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:i,children:[e.jsxs(B,{gap:16,children:[e.jsx(M.Group,{name:"status",value:o.type,onChange:f=>{a("type",f),R(f)},hidden:!0,children:e.jsxs(F,{mt:"xs",children:[e.jsx(M,{value:"reviewal",label:"Review"}),e.jsx(M,{value:"approval",label:"Approval"})]})}),e.jsx(J,{label:"Resolution",placeholder:"Your resolution for this approval",value:o.resolution??"",onChange:f=>a("resolution",f.target.value),error:D.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(k,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),U.map((f,g)=>e.jsxs(F,{justify:"space-between",align:"flex-end",children:[e.jsx(q,{placeholder:"Select a user",data:S(g),value:f.selectedUser,onChange:I=>d(g,I),required:!0,style:{flex:1},allowDeselect:!1}),e.jsx(V,{color:"red",onClick:()=>C(g),title:"Remove User",children:e.jsx(O,{size:18})})]},g)),e.jsxs(F,{children:[U.length<p&&e.jsx(A,{variant:"subtle",color:"green",leftSection:e.jsx(P,{size:16}),onClick:b,disabled:U.length>=p,children:"Add User"}),m.length<p&&e.jsx(A,{variant:"subtle",color:"blue",leftSection:e.jsx(P,{size:16}),onClick:u,disabled:U.length>=p,children:"Add All Users"})]})]}),e.jsxs(Y,{align:"center",justify:"end",mt:16,children:[e.jsx(A,{variant:"light",onClick:()=>r("createDocumentReview"),children:"Cancel"}),e.jsx(A,{ml:12,type:"submit",loading:j,children:"Create"})]})]})})},xs=({document:s,itemAncestors:l,activityLog:r,userRole:t})=>{var u,p;const{openModal:o}=E(),{uploadVersion:a,processing:i,errors:j}=Me(s.item_id),D=m=>{m&&a(m)},U=(u=s.document_approval_ids)==null?void 0:u.some(m=>m.type==="reviewal"),R=(p=s.document_approval_ids)==null?void 0:p.some(m=>m.type==="approval"),C=[...[{name:"Date",value:s.created_at},{name:"Document Number",value:s.document_number}],...s.metadata.map(m=>({name:m.name,value:m.value||"N/A"}))],d=!!s.archived_at;return console.log(s),e.jsxs(pe,{children:[e.jsx(ae,{title:"Document Properties"}),e.jsx(ie,{px:8,py:8,mb:48,children:e.jsx(he,{ancestors:l})}),e.jsxs(L,{children:[e.jsx(L.Col,{span:8,children:e.jsxs(B,{px:8,py:8,gap:48,mb:48,children:[e.jsxs(F,{children:[e.jsx(ee,{mime:s.mime,isFolder:!1,reviewStatus:s.review_status,approvalStatus:s.approval_status}),e.jsx(k,{fw:500,children:s.name})]}),d&&e.jsx(Ue,{icon:e.jsx(we,{size:16}),title:"Archived Document",color:"yellow",children:"This document is archived and is read-only."}),e.jsx(B,{gap:12,mt:24,children:C.length>0?e.jsx(L,{gutter:"lg",children:C.map((m,c)=>e.jsx(L.Col,{span:4,children:e.jsxs(B,{gap:4,children:[e.jsx(k,{size:"sm",fw:"bold",children:m.name}),e.jsx(k,{size:"sm",children:m.value})]})},`${m.name}-${c}`))}):e.jsx(k,{size:"sm",color:"dimmed",children:"No metadata available."})}),e.jsxs(B,{gap:12,children:[!d&&s.versions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",fw:"bold",children:"Document Versions"}),e.jsx(Ee,{versions:s.versions})]}),e.jsx(k,{size:"sm",fw:"bold",children:"Audit Log"}),e.jsx(X,{textSelectionDisabled:!0,columns:[{accessor:"date"},{accessor:"time"},{accessor:"user_name",title:"User"},{accessor:"description",title:"Action"}],records:r,verticalSpacing:"lg",horizontalSpacing:"xl",withTableBorder:!0})]})]})}),e.jsx(L.Col,{span:3,offset:1,children:e.jsxs(ce,{withBorder:!0,p:20,children:[e.jsx(k,{color:"dimmed",fw:500,children:"Options"}),!d&&(t==="editor"||t==="admin")&&e.jsx(A,{variant:"subtle",color:"blue.5",leftSection:e.jsx(be,{size:18}),fullWidth:!0,justify:"left",component:de,href:route("document.edit",{document:s.item_id}),children:"Edit Document"}),!d&&(t==="editor"||t==="admin")&&e.jsx(te,{onChange:D,children:m=>e.jsx(A,{...m,variant:"subtle",color:"blue.5",fullWidth:!0,justify:"left",leftSection:e.jsx(fe,{size:18}),children:"Upload New Version"})}),!d&&(t==="editor"||t==="admin")&&e.jsxs(A,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(U?"viewDocumentReview":"createDocumentReview")},children:[U?"View":"Start"," Review Process"]}),!d&&(t==="editor"||t==="admin")&&e.jsxs(A,{variant:"subtle",color:"blue.5",leftSection:e.jsx(K,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{o(R?"viewDocumentApproval":"createDocumentApproval")},children:[R?"View":"Start"," Approval Process"]}),e.jsx(A,{variant:"subtle",component:"a",href:route("document.view",{document:s.item_id}),target:"_blank",color:"blue.5",leftSection:e.jsx(De,{size:18}),justify:"left",fullWidth:!0,children:"View Document"}),!d&&(t==="editor"||t==="admin")&&e.jsx(A,{variant:"subtle",color:"blue.5",leftSection:e.jsx(me,{size:18}),fullWidth:!0,justify:"left",onClick:()=>o("shareDocument"),children:"Share Document"}),d&&(t==="editor"||t==="admin")&&e.jsx(A,{variant:"subtle",color:"green.5",leftSection:e.jsx(je,{size:18}),fullWidth:!0,justify:"left",onClick:()=>o("unarchiveFiles"),children:"Unarchive"})]})})]}),e.jsx(Ce,{document:s}),e.jsx(Ge,{document:s}),e.jsx(ke,{document:s}),e.jsx(Oe,{document:s}),e.jsx(Pe,{documentId:s.item_id}),e.jsx(xe,{restoreIds:[s.item_id]})]})};export{xs as default};
