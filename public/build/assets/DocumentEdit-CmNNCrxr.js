import{b,j as e,M as A,W as R,n as w,Y as z,B as E,y as T}from"./app-o_n_Q1_4.js";import{u as I,a as y,b as k,A as B}from"./Authenticated-Cec13kwc.js";import{I as O}from"./ItemBreadcrumbs-BRG66SY9.js";import{u as P}from"./use-fetch-metadata-D8elXZqZ.js";import{u as U,C as M}from"./Combobox-D5pGux-b.js";import{S as h}from"./Stack-CedQLgvk.js";import{I as L}from"./InputBase-CTp7OGFz.js";import{G as D,A as S,c as q}from"./NotificationMenu-D2gMmxnP.js";import{B as v}from"./Button-QcSAzscX.js";import{T as C}from"./TextInput-Yso5tBj3.js";import{T as _,F as G}from"./OfficeLogo-Cx0EXCVw.js";import{A as N,I as Y}from"./IconAlertCircle-MpziT5DX.js";import{u as H,I as V}from"./use-show-items-for-moving-hqSPb_fk.js";import{I as W}from"./IconFolder-BHogNRf_.js";import{I as $}from"./IconFile-ClOcoubh.js";import{I as J}from"./IconEdit-DSSGRITm.js";import{T as K}from"./Textarea-AYMrpB1M.js";import{D as Q}from"./DatePickerInput-CGvRqrsI.js";import"./Popover-CjVYgpjS.js";import"./use-uncontrolled-CloXekY7.js";import"./IconUser-BqmWWyqY.js";import"./get-sorted-breakpoints-6caYqVKE.js";import"./Anchor-o9Y3yiSS.js";import"./clamp-DTmYCdls.js";const X=({onAdd:a})=>{const{modals:c,closeModal:n}=I(),r=c.addDocumentMetadata,{metadataList:m}=P(),[s,l]=b.useState(null),u=U({onDropdownClose:()=>u.resetSelectedOption()}),p=()=>{s&&(a(s),n("addDocumentMetadata"),l(null))},g=m.map(d=>e.jsx(M.Option,{value:d.metadata_id.toString(),children:d.name},d.metadata_id));return e.jsx(A,{opened:r,onClose:()=>n("addDocumentMetadata"),title:"Add Custom Metadata",children:e.jsxs(h,{gap:16,children:[e.jsxs(M,{store:u,onOptionSubmit:d=>{const x=m.find(t=>t.metadata_id.toString()===d)||null;l(x),u.closeDropdown()},children:[e.jsx(M.Target,{children:e.jsx(L,{component:"button",type:"button",rightSection:e.jsx(M.Chevron,{}),onClick:()=>u.toggleDropdown(),children:s?s.name:"Select Metadata"})}),e.jsx(M.Dropdown,{children:e.jsx(M.Options,{children:g})})]}),e.jsxs(D,{justify:"flex-end",children:[e.jsx(v,{variant:"outline",onClick:()=>n("addDocumentMetadata"),children:"Cancel"}),e.jsx(v,{onClick:p,disabled:!s,children:"Add"})]})]})})},Z=({metadata:a,requiredMetadata:c,onAdd:n,onUpdate:r,onChange:m,onDelete:s})=>{const{openModal:l}=I(),u=t=>{n&&n(t)},p=()=>{l("addDocumentMetadata")},g=t=>{const i=a[t],j=a.filter((o,f)=>f!==t);r&&r(j),s&&i.metadata_id!==0&&s(i.metadata_id)},d=(t,i,j)=>{const o=a.map((f,F)=>F===t?{...f,[i]:j}:f);m&&m(o)},x=b.useMemo(()=>{const t=a.map(i=>i.metadata_id);return c.filter(i=>!t.includes(i.metadata_id))},[a,c]);return e.jsxs(h,{children:[a.map((t,i)=>e.jsxs(D,{grow:!0,align:"flex-end",children:[e.jsx(C,{disabled:!0,label:"Name",placeholder:"Metadata name",value:t.name,onChange:j=>d(i,"name",j.target.value)}),e.jsx(C,{label:"Value",placeholder:"Metadata value",value:t.value,onChange:j=>d(i,"value",j.target.value)}),e.jsx(S,{color:"red",onClick:()=>g(i),children:e.jsx(y,{size:16})})]},t.metadata_id||i)),x.length>0&&e.jsxs(h,{gap:"xs",children:[e.jsx(_,{c:"red",size:"sm",children:"Missing Required Metadata:"}),x.map(t=>e.jsx(N,{icon:e.jsx(Y,{size:16}),title:`${t.name} is missing`,color:"red",variant:"light"},t.metadata_id))]}),e.jsx(v,{variant:"light",onClick:p,leftSection:e.jsx(k,{size:14}),children:"Add Custom Metadata"}),e.jsx(X,{onAdd:t=>u({metadata_id:t.metadata_id,name:t.name,value:""})})]})},ee=({onAdd:a})=>{const{modals:c,closeModal:n}=I(),r=c.relatedDocumentModal,[m,s]=b.useState(null),{data:l,loading:u,error:p}=H(m,r),g=t=>{s(t)},d=()=>{l.itemParent&&l.itemParent.parent_id?s(l.itemParent.parent_id):s(null)},x=t=>{a(t),n("relatedDocumentModal"),s(null)};return e.jsx(A,{opened:r,onClose:()=>n("relatedDocumentModal"),title:"Select Related Document",size:"lg",children:e.jsxs(h,{gap:"md",children:[e.jsxs(D,{children:[m&&e.jsx(S,{onClick:d,children:e.jsx(V,{size:16})}),e.jsx(_,{children:"Select a document to relate"})]}),u?e.jsx(_,{children:"Loading..."}):p?e.jsx(_,{c:"red",children:p}):e.jsx(h,{style:{maxHeight:400,overflowY:"auto"},children:l.itemContents.map(t=>e.jsxs(D,{style:{cursor:"pointer"},onClick:()=>{t.type==="folder"?g(t.item_id):x({item_id:t.item_id,name:t.name})},children:[t.type==="folder"?e.jsx(W,{}):e.jsx($,{}),e.jsx(_,{children:t.name})]},t.item_id))})]})})},te=({relatedDocuments:a,onChange:c})=>{const{openModal:n}=I(),r=s=>{const l=[...a,s];c&&c(l)},m=s=>{const l=a.filter((u,p)=>p!==s);c&&c(l)};return e.jsxs(h,{children:[a.map((s,l)=>e.jsxs(D,{grow:!0,align:"center",children:[e.jsx(_,{children:s.name}),e.jsx(S,{color:"red",onClick:()=>m(l),children:e.jsx(y,{size:16})})]},s.item_id)),e.jsx(ee,{onAdd:r}),e.jsx(v,{variant:"light",onClick:()=>n("relatedDocumentModal"),leftSection:e.jsx(k,{size:14}),children:"Add Related Document"})]})};function ae({document:a,onSuccess:c}){const{data:n,setData:r,put:m,processing:s,errors:l,reset:u,clearErrors:p}=R({name:a.name,document_number:a.document_number||"",description:a.description||"",due_date:a.due_date||"",update_metadata:a.metadata.map(d=>({metadata_id:d.metadata_id,name:d.name,value:d.value})),delete_metadata:[],related_documents:a.related_documents.map(d=>({item_id:d.item_id,name:d.name}))});return{data:n,setData:r,handleUpdateDocument:d=>{d.preventDefault(),m(route("document.save",a.item_id),{onSuccess:()=>{w.show({message:"Document updated successfully",color:"green"})},onError:x=>{w.show({message:"Failed to update document",color:"red"})},onFinish:()=>p()})},processing:s,errors:l,reset:u}}function we({document:a,itemAncestors:c}){const{data:n,setData:r,handleUpdateDocument:m,processing:s,errors:l,reset:u}=ae({document:a}),[p,g]=b.useState([]),d=o=>{r("update_metadata",[...n.update_metadata||[],o])},x=o=>{n.update_metadata=o},t=o=>{r("update_metadata",o)},i=o=>{g(f=>[...f,o]),r("delete_metadata",[...n.delete_metadata||[],{metadata_id:o}])},j=o=>{r("related_documents",o)};return e.jsxs(B,{children:[e.jsx(z,{title:"Document Properties"}),e.jsx(E,{px:8,py:8,children:e.jsx(O,{ancestors:c})}),e.jsxs(h,{px:8,py:8,gap:24,w:550,mb:72,children:[e.jsxs(D,{mt:24,align:"center",children:[e.jsx(q,{mime:a.mime,isFolder:!1,reviewStatus:a.review_status,approvalStatus:a.approval_status}),e.jsx(_,{fw:500,children:n.name}),e.jsx(S,{variant:"subtle",color:"gray",children:e.jsx(J,{size:24})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs(h,{gap:12,children:[e.jsx(C,{label:"Document Number",name:"document_number",value:n.document_number,onChange:o=>r("document_number",o.target.value),placeholder:"Enter document number"}),e.jsx(C,{type:"text",label:"Created At",value:a.created_at,disabled:!0}),e.jsx(K,{label:"Description",autosize:!0,minRows:4,maxRows:6,placeholder:"Enter description",value:n.description,onChange:o=>r("description",o.target.value)}),e.jsx(Q,{label:"Due Date",placeholder:"Select due date",value:n.due_date?new Date(n.due_date):void 0,onChange:o=>r("due_date",(o==null?void 0:o.toISOString())??void 0)})]}),e.jsxs(h,{gap:12,mt:16,children:[e.jsx(_,{size:"sm",fw:500,children:"Custom Metadata Field"}),e.jsx(Z,{metadata:n.update_metadata??[],requiredMetadata:a.required_folder_metadata,onAdd:d,onUpdate:x,onChange:t,onDelete:i})]}),e.jsxs(h,{gap:12,mt:16,children:[e.jsx(_,{size:"sm",fw:500,children:"Related Documents"}),e.jsx(te,{relatedDocuments:n.related_documents||[],onChange:j})]}),e.jsxs(G,{align:"center",justify:"end",mt:16,children:[e.jsx(v,{variant:"light",onClick:()=>T.visit(route("document.show",{document:a.item_id})),children:"Cancel"}),e.jsx(v,{ml:12,type:"submit",loading:s,children:"Save Changes"})]})]})]})]})}export{we as default};
