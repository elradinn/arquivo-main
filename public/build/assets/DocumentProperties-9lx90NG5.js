import{b as D,u as P,s as G,j as e,t as N,W as b,n as u,M as R,P as F,c as O,Y,B as W}from"./app-B1t0nWF2.js";import{u as z,b as _,c as T,A as H}from"./Authenticated-Cn6MVLYw.js";import{Y as V}from"./index-Dt4V_hbn.js";import{I as $}from"./ItemBreadcrumbs-CjJsyex6.js";import{u as M,I as q,a as L}from"./use-fetch-users-approval-role-Dc96mWPm.js";import{T as i}from"./Text-CTq1jRaK.js";import{S as y}from"./Stack-DzZL_UtP.js";import{R as w}from"./Radio-Ba0OcqTt.js";import{G as A,A as B}from"./Avatar-DhTNpjzT.js";import{T as E}from"./Textarea-Dd19YroK.js";import{F as U}from"./Flex-vxGNn1YY.js";import{B as v}from"./Button-HaXgOpsJ.js";import{c as J}from"./createReactComponent-CvUE1uel.js";import{I as K}from"./IconDownload-Ctt3HoT8.js";import{G as S}from"./Grid-Dqe7rrCf.js";import{I as Q}from"./IconFile-BJEDmDVU.js";import"./OfficeLogo-CnZm09Bf.js";import"./TextInput-C5DBO-eL.js";import"./InputBase-wHy3O5_x.js";import"./Popover-CNN9VJPa.js";import"./use-uncontrolled-DXGPZ-HS.js";import"./IconUser-DH80TIA7.js";import"./get-sorted-breakpoints-QhZfIvBG.js";import"./Checkbox-Bs46OKoO.js";import"./CheckIcon-CXwCS6ms.js";import"./ScrollArea-BzIzn8kk.js";import"./Anchor-DmK4caIo.js";import"./get-base-value-JqT_q0U7.js";const X={multiple:!1},I=D.forwardRef((s,t)=>{const{onChange:r,children:n,multiple:o,accept:l,name:a,form:m,resetRef:c,disabled:h,capture:p,inputProps:x,...d}=P("FileButton",X,s),f=D.useRef(),j=()=>{var g;!h&&((g=f.current)==null||g.click())},k=g=>{r(o?Array.from(g.currentTarget.files):g.currentTarget.files[0]||null)};return G(c,()=>{f.current.value=""}),e.jsxs(e.Fragment,{children:[n({onClick:j,...d}),e.jsx("input",{style:{display:"none"},type:"file",accept:l,multiple:o,onChange:k,ref:N(t,f),name:a,form:m,capture:p,...x})]})});I.displayName="@mantine/core/FileButton";/**
 * @license @tabler/icons-react v3.11.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Z=J("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);function ee({documentId:s}){const[t,r]=D.useState("reviewal"),{closeModal:n,modals:o}=z(),l=M(t,o.createDocumentApproval),{data:a,setData:m,post:c,processing:h,errors:p,reset:x}=b({document_id:"",resolution:"",destination:"",type:"reviewal",users:[]});return{data:a,setData:m,createApprovalSubmit:f=>{f.preventDefault(),a.document_id=s??"",a.users=l.map(j=>({user_id:j.id.toString()})),c(route("document_approvals.store"),{preserveScroll:!0,onSuccess:()=>{n("createDocumentApproval"),u.show({message:"Document approval process created",color:"green"})},onError:j=>{u.show({message:"Something went wrong",color:"red"})},onFinish:()=>x()})},processing:h,errors:p,users:l,setDocumentApprovalType:r}}const se=({document:s})=>{const{data:t,setData:r,createApprovalSubmit:n,processing:o,errors:l,users:a,setDocumentApprovalType:m}=ee({documentId:s==null?void 0:s.item_id}),{modals:c,closeModal:h}=z();return e.jsx(R,{opened:c.createDocumentApproval,onClose:()=>h("createDocumentApproval"),title:e.jsx(i,{fw:"bold",size:"lg",children:"Create Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(y,{gap:16,children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined document approval process"}),e.jsx(w.Group,{name:"status",value:t.type,onChange:p=>{r("type",p),m(p)},children:e.jsxs(A,{mt:"xs",children:[e.jsx(w,{value:"reviewal",label:"Review"}),e.jsx(w,{value:"approval",label:"Approval"})]})}),e.jsx(E,{label:"Resolution",placeholder:"Your resolution for this approval",value:t.resolution??"",onChange:p=>r("resolution",p.target.value),error:l.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(i,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),a.map(p=>e.jsx(F,{withBorder:!0,radius:"md",py:16,px:10,children:e.jsxs(A,{children:[e.jsx(B,{}),e.jsxs(y,{gap:8,children:[e.jsx(i,{size:"sm",children:p.name}),e.jsx(i,{size:"sm",children:p.email})]})]})},p.id))]}),e.jsxs(U,{align:"center",justify:"end",mt:16,children:[e.jsx(v,{variant:"light",onClick:()=>h("createDocumentApproval"),children:"Cancel"}),e.jsx(v,{ml:12,type:"submit",loading:o,children:"Create"})]})]})})};function oe({documentApprovalId:s,isOpen:t}){const[r,n]=D.useState(null);D.useEffect(()=>{s&&t&&o(s)},[s,t]);const o=async l=>{try{const a=await O.get(`/document_approval/${l}/update`);n(a.data)}catch(a){console.error("Error fetching document approval",a)}};return r}function re({documentApprovalId:s,isOpen:t}){const[r,n]=D.useState("reviewal"),o=oe({documentApprovalId:s,isOpen:t}),l=M(r,t),{closeModal:a}=z(),{data:m,setData:c,put:h,processing:p,errors:x,reset:d,clearErrors:f}=b({resolution:"",type:"",users:[]});D.useEffect(()=>{c({resolution:(o==null?void 0:o.resolution)||"",type:(o==null?void 0:o.type)||"",users:((o==null?void 0:o.document_user_approvals)||[]).map(C=>({user_id:C.user_id}))}),n((o==null?void 0:o.type)||"")},[o]);const j=()=>{a("updateDocumentApproval"),d(),f()};return{data:m,setData:c,handleUpdateDocumentApproval:C=>{C.preventDefault(),m.users=l.map(g=>({user_id:g.id.toString()})),h(route("document_approvals.update",s),{onSuccess:()=>{j(),u.show({message:"Document approval updated successfully",color:"green"})},onError:()=>{u.show({message:"Something went wrong",color:"red"})},onFinish:()=>d()})},processing:p,errors:x,handleClose:j,fetchedUsers:l,setDocumentApprovalType:n,documentApproval:o}}function te({documentApprovalId:s,onDeleteSuccess:t}){const{delete:r,processing:n}=b();return{handleDeleteDocumentApproval:()=>{if(!s){u.show({message:"Document Approval ID is missing.",color:"red"});return}r(route("document_approvals.cancel",s),{onSuccess:()=>{u.show({message:"Document Approval deleted successfully.",color:"green"}),t()},onError:l=>{let a="Failed to delete document approval.";l&&Object.keys(l).length>0&&(a=l[Object.keys(l)[0]]),u.show({message:a,color:"red"})}})},processing:n}}const ne=({documentApprovalId:s})=>{const{modals:t,closeModal:r,openModal:n}=z(),o=t.confirmDeleteDocumentApproval,{handleDeleteDocumentApproval:l,processing:a}=te({documentApprovalId:s,onDeleteSuccess:()=>{r("confirmDeleteDocumentApproval"),r("updateDocumentApproval")}});return e.jsxs(R,{opened:o,onClose:()=>r("confirmDeleteDocumentApproval"),title:e.jsx(i,{fw:"bold",size:"lg",children:"Confirm Delete"}),size:"sm",centered:!0,children:[e.jsx(i,{c:"gray.8",children:"Are you sure you want to cancel this document approval? This action cannot be undone."}),e.jsxs(U,{align:"center",justify:"flex-end",mt:16,children:[e.jsx(v,{variant:"light",onClick:()=>{r("confirmDeleteDocumentApproval"),n("updateDocumentApproval")},children:"Cancel"}),e.jsx(v,{color:"red",ml:12,onClick:l,loading:a,children:"Delete"})]})]})},le=({document:s})=>{const{modals:t,closeModal:r,openModal:n}=z(),o=t.updateDocumentApproval,{data:l,setData:a,handleUpdateDocumentApproval:m,processing:c,fetchedUsers:h,setDocumentApprovalType:p,errors:x}=re({documentApprovalId:s==null?void 0:s.document_approval_id,isOpen:o});return e.jsxs(e.Fragment,{children:[e.jsx(R,{opened:t.updateDocumentApproval,onClose:()=>r("updateDocumentApproval"),title:e.jsx(i,{fw:"bold",size:"lg",children:"Update Document Approval Process"}),size:550,children:e.jsxs("form",{onSubmit:m,children:[e.jsxs(y,{gap:16,children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Routinely directs any uploaded file in this folder through a predefined document approval process"}),e.jsx(w.Group,{name:"status",value:l.type,onChange:d=>{a("type",d),p(d)},children:e.jsxs(A,{mt:"xs",children:[e.jsx(w,{value:"reviewal",label:"Review"}),e.jsx(w,{value:"approval",label:"Approval"})]})}),e.jsx(E,{label:"Resolution",placeholder:"Your resolution for this approval",value:l.resolution??"",onChange:d=>a("resolution",d.target.value),error:x.resolution,autosize:!0,minRows:2,maxRows:4}),e.jsx(i,{size:"sm",fw:500,mb:-8,children:"Users in this document approval"}),h.map(d=>e.jsx(F,{withBorder:!0,radius:"md",py:16,px:10,children:e.jsxs(A,{children:[e.jsx(B,{}),e.jsxs(y,{gap:8,children:[e.jsx(i,{size:"sm",children:d.name}),e.jsx(i,{size:"sm",children:d.email})]})]})},d.id))]}),e.jsxs(U,{align:"center",justify:"end",mt:16,children:[e.jsx(v,{variant:"light",onClick:()=>r("updateDocumentApproval"),children:"Cancel"}),e.jsx(v,{ml:12,type:"submit",loading:c,children:"Update"}),e.jsx(_,{variant:"transparent",color:"red",onClick:()=>{r("updateDocumentApproval"),n("confirmDeleteDocumentApproval")},title:"Delete Document Approval",ml:12,children:e.jsx(T,{size:18})})]})]})}),e.jsx(ne,{documentApprovalId:s==null?void 0:s.document_approval_id})]})};function ae(){const{post:s,processing:t}=b();return{restoreVersion:n=>{s(route("document.restore_version",{version:n}),{onSuccess:()=>{u.show({message:"Document version restored successfully.",color:"green"})},onError:()=>{u.show({message:"Failed to restore document version.",color:"red"})}})},processing:t}}function ie(){const{delete:s,processing:t}=b();return{deleteVersion:n=>{s(route("document.delete_version",{version:n}),{onSuccess:()=>{u.show({message:"Document version deleted successfully.",color:"green"})},onError:()=>{u.show({message:"Failed to delete document version.",color:"red"})}})},processing:t}}const ce=({versions:s})=>{const{restoreVersion:t}=ae(),{deleteVersion:r}=ie();return e.jsx(V,{columns:[{accessor:"name",title:"Name"},{accessor:"uploaded_at",title:"Uploaded At"},{accessor:"actions",title:"Actions",render:n=>e.jsxs(A,{gap:4,children:[e.jsx(_,{variant:"subtle",onClick:()=>t(n.id),children:e.jsx(Z,{size:16})}),e.jsx(_,{variant:"subtle",color:"red",onClick:()=>r(n.id),children:e.jsx(T,{size:16})}),e.jsx("a",{href:n.file_path,download:!0,children:e.jsx(_,{variant:"subtle",children:e.jsx(K,{size:16})})})]})}],records:s,highlightOnHover:!0,verticalSpacing:"sm",horizontalSpacing:"sm"})};function pe(s){const{data:t,post:r,reset:n,processing:o,errors:l,clearErrors:a}=b({document_item_id:s,file:null});return{uploadVersion:c=>{if(!c){u.show({message:"No file selected.",color:"red"});return}t.file=c,r(`/document/${s}/versions`,{onSuccess:()=>{u.show({message:"Document version uploaded successfully.",color:"green"}),n()},onError:()=>{u.show({message:"Failed to upload document version.",color:"red"})},onFinish:()=>{a()}})},processing:o,errors:l}}const Pe=({document:s,itemAncestors:t,activityLog:r})=>{const{openModal:n}=z(),{uploadVersion:o,processing:l,errors:a}=pe(s.item_id),m=c=>{c&&o(c)};return e.jsxs(H,{children:[e.jsx(Y,{title:"Document Properties"}),e.jsx(W,{px:8,py:8,mb:48,children:e.jsx($,{ancestors:t})}),e.jsxs(S,{children:[e.jsx(S.Col,{span:8,children:e.jsxs(y,{px:8,py:8,gap:48,mb:48,children:[e.jsxs(A,{children:[e.jsx(Q,{size:56,stroke:1,color:"gray"}),e.jsx(i,{fw:500,children:s.name})]}),e.jsxs(A,{justify:"space-between",w:700,children:[e.jsxs("div",{children:[e.jsx(i,{size:"sm",fw:"bold",children:"Document ID"}),e.jsx(i,{size:"sm",children:s.item_id})]}),e.jsxs("div",{children:[e.jsx(i,{size:"sm",fw:"bold",children:"Date"}),e.jsx(i,{size:"sm",children:s.created_at})]}),e.jsxs("div",{children:[e.jsx(i,{size:"sm",fw:"bold",children:"Document Number"}),e.jsx(i,{size:"sm",children:s.document_number})]})]}),e.jsxs(y,{gap:12,children:[s.versions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"sm",fw:"bold",children:"Document Versions"}),e.jsx(ce,{versions:s.versions})]}),e.jsx(i,{size:"sm",fw:"bold",children:"Audit Log"}),e.jsx(V,{textSelectionDisabled:!0,columns:[{accessor:"date"},{accessor:"time"},{accessor:"user_name",title:"User"},{accessor:"description",title:"Action"}],records:r,highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",withTableBorder:!0})]})]})}),e.jsx(S.Col,{span:3,offset:1,children:e.jsxs(F,{withBorder:!0,p:20,children:[e.jsx(i,{c:"dimmed",fw:500,children:"Options"}),e.jsx(I,{onChange:m,children:c=>e.jsx(v,{...c,variant:"subtle",color:"blue.5",fullWidth:!0,justify:"left",leftSection:e.jsx(q,{size:18}),children:"Upload New Version"})}),e.jsxs(v,{variant:"subtle",color:"blue.5",leftSection:e.jsx(L,{size:18}),fullWidth:!0,justify:"left",onClick:()=>{n(s.document_approval_id?"updateDocumentApproval":"createDocumentApproval")},children:[s.document_approval_id?"View":"Start"," Approval Process"]})]})})]}),e.jsx(se,{document:s}),e.jsx(le,{document:s})]})};export{Pe as default};
