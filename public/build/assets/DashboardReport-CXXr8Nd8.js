import{c as y,W as O,n as R,b as C,j as e,M as z,Y as F,y as G}from"./app-C6XG0cSQ.js";import{Y as L}from"./index-CJtmCG7w.js";import{u as w,A as B}from"./Authenticated-BorpHiS6.js";import{u as N,a as Y}from"./use-search-datatable-D3qAaeqG.js";import{S as v}from"./Stack-wBeQs2Pj.js";import{T as m,F as $}from"./OfficeLogo-BNt4QIGX.js";import{C as q}from"./Checkbox-B-DJHyjb.js";import{G as x,c as U}from"./NotificationMenu-DAmqaZtC.js";import{B as S}from"./Button-8-aGwO0w.js";import{S as H}from"./StateBadge-BCAL-Cd_.js";import{u as V}from"./use-document-properties-ReRMtYd0.js";import{S as W}from"./Select-CTVverg_.js";import{D as J}from"./DatePickerInput-BO1zAAKx.js";import{I as K}from"./IconTable-D7rv8pGh.js";import{I as Q}from"./IconDownload-T2Sefgho.js";import"./Popover-BCpZ3lUS.js";import"./use-uncontrolled-BOMjDmSw.js";import"./IconUser-IBy9KAJ3.js";import"./TextInput-yth6IhRc.js";import"./InputBase-B0vbIfZ1.js";import"./get-sorted-breakpoints-Dm45VJPx.js";import"./CheckIcon-FTcshgDl.js";import"./Badge-DYNcIMTY.js";import"./Combobox-BgJjN5zh.js";import"./clamp-DTmYCdls.js";function X(){return{generateReport:async u=>{var n;try{const o=await y.post(route("report.generate"),{folder_item_id:u}),{url:s,filename:c}=o.data;if(s){const t=document.createElement("a");t.href=s,t.download=c,document.body.appendChild(t),t.click(),document.body.removeChild(t)}else console.error("No URL returned for the report.")}catch(o){console.error("Error generating report:",((n=o.response)==null?void 0:n.data)||o.message)}},generateDashboardReport:async u=>{var n;try{const o=await y.post(route("report.generateDashboard"),u),{url:s,filename:c}=o.data;if(s){const t=document.createElement("a");t.href=s,t.download=c,document.body.appendChild(t),t.click(),document.body.removeChild(t)}else console.error("No URL returned for the dashboard report.")}catch(o){console.error("Error generating dashboard report:",((n=o.response)==null?void 0:n.data)||o.message)}}}}function Z({closeModal:p}){const{data:l,setData:u,post:n,processing:o,errors:s,reset:c}=O({metadata_ids:[]});return{data:l,setData:u,handleSubmit:()=>{n(route("dashboard.selectMetadataColumn"),{onSuccess:()=>{R.show({title:"Success",message:"Metadata columns updated successfully",color:"green"}),p(),c()},onError:()=>{R.show({title:"Error",message:"Failed to update metadata columns",color:"red"})}})},processing:o,errors:s}}const ee=({availableMetadata:p,existingMetadataIds:l})=>{const{modals:u,closeModal:n}=w(),o=u.selectDashboardMetadataColumns,{data:s,setData:c,handleSubmit:t,processing:j,errors:h}=Z({closeModal:()=>n("selectDashboardMetadataColumns")});C.useEffect(()=>{c("metadata_ids",l)},[l]);const g=d=>{const b=s.metadata_ids;b.includes(d)?c("metadata_ids",b.filter(_=>_!==d)):c("metadata_ids",[...b,d])};return e.jsx(z,{opened:o,onClose:()=>n("selectDashboardMetadataColumns"),title:"Select Metadata Columns",children:e.jsx("form",{onSubmit:d=>{d.preventDefault(),t()},children:e.jsxs(v,{children:[e.jsx(m,{children:"Select the metadata columns you want to display in the dashboard report:"}),p.map(d=>e.jsx(q,{label:d.name,checked:s.metadata_ids.includes(d.metadata_id),onChange:()=>g(d.metadata_id)},d.metadata_id)),h.metadata_ids&&e.jsx(m,{c:"red",children:h.metadata_ids}),e.jsxs(x,{gap:"md",mt:"md",children:[e.jsx(S,{variant:"outline",onClick:()=>n("selectDashboardMetadataColumns"),children:"Cancel"}),e.jsx(S,{type:"submit",loading:j,children:"Save"})]})]})})})};function Re({documents:p,filters:l,selectedMetadata:u,availableMetadata:n,existingMetadataIds:o}){const[s,c]=C.useState(l.document_status),[t,j]=C.useState([l.start_date?new Date(l.start_date):null,l.end_date?new Date(l.end_date):null]),{openDocument:h}=V();N("","/dashboard/reports");const{page:g,setPage:d,handlePageChange:b}=Y(p.current_page),{generateDashboardReport:_}=X(),{openModal:M}=w(),D=a=>{const r={document_status:s,start_date:t[0]?t[0].toISOString().split("T")[0]:null,end_date:t[1]?t[1].toISOString().split("T")[0]:null,page:g||void 0,...a};Object.keys(r).forEach(i=>{(r[i]===null||r[i]===void 0)&&delete r[i]}),G.get(route("dashboard.reports"),r,{replace:!0,preserveState:!0})},k=a=>{c(a),D({document_status:a,page:1})},P=a=>{j(a),D({start_date:a[0]?a[0].toISOString().split("T")[0]:null,end_date:a[1]?a[1].toISOString().split("T")[0]:null,page:1})},T=a=>{d(a),D({page:a})},E=()=>{const a={document_status:s,start_date:t[0]?t[0].toISOString().split("T")[0]:null,end_date:t[1]?t[1].toISOString().split("T")[0]:null,metadata_ids:o};_(a)},I=()=>u.map(a=>a.name.toLowerCase()==="status"?{accessor:"status",title:"Status",render:({status:r})=>e.jsx(H,{state:r})}:a.name.toLowerCase()==="due_in"?{accessor:"due_in",title:"Due in",render:({due_in:r})=>r!=null?r<0?e.jsxs(m,{color:"red",size:"sm",children:[Math.abs(r)," days overdue"]}):e.jsx(m,{size:"sm",children:`${r} day${r!==1?"s":""} remaining`}):"Deadline not set"}:{accessor:`metadata_${a.metadata_id}`,title:a.name,render:r=>{var f;const i=(f=r.metadata)==null?void 0:f.find(A=>A.metadata_id===a.metadata_id);return i?i.value:"N/A"}});return e.jsxs(B,{children:[e.jsx(F,{title:"Dashboard Report"}),e.jsxs(v,{px:8,gap:24,py:8,children:[e.jsx(x,{children:e.jsx(m,{component:"h2",size:"xl",c:"gray.8",children:"Dashboard Report"})}),e.jsxs(v,{children:[e.jsxs(x,{gap:"md",children:[e.jsxs($,{gap:"md",justify:"flex-start",align:"flex-end",direction:"row",wrap:"wrap",children:[e.jsx(W,{placeholder:"Select document status",value:s,onChange:k,data:[{value:"reviewal_accepted",label:"Review Accepted"},{value:"reviewal_rejected",label:"Review Rejected"},{value:"reviewal_pending",label:"Review Pending"},{value:"approval_accepted",label:"Approval Accepted"},{value:"approval_rejected",label:"Approval Rejected"},{value:"approval_pending",label:"Approval Pending"}],style:{width:200}}),e.jsx(J,{type:"range",placeholder:"Select date range",value:t,onChange:P,style:{width:300}}),e.jsx(S,{onClick:()=>M("selectDashboardMetadataColumns"),leftSection:e.jsx(K,{size:16}),variant:"subtle",color:"dark.5",children:"Columns"})]}),e.jsx(S,{onClick:E,leftSection:e.jsx(Q,{size:16}),color:"blue",variant:"subtle",children:"Generate Report"})]}),e.jsx(ee,{availableMetadata:n,existingMetadataIds:o}),e.jsx(L,{columns:[{accessor:"name",render:({mime:a,type:r,name:i,missing_required_metadata:f})=>e.jsxs(x,{align:"center",gap:12,children:[e.jsx(U,{mime:a??"",isFolder:r==="folder",missingRequiredMetadata:f}),e.jsx("span",{children:i})]})},{accessor:"updated_at",title:"Last Modified"},...I()],records:p.data,totalRecords:p.total,recordsPerPage:p.per_page,page:g,onPageChange:T,highlightOnHover:!0,verticalSpacing:"lg",horizontalSpacing:"xl",customRowAttributes:({type:a,id:r})=>({onDoubleClick:i=>{i.button===0&&h(r)}})})]})]})]})}export{Re as default};
